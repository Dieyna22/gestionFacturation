<app-navbar></app-navbar>
<app-sidebar></app-sidebar>
<div class="zoneSearch container mb-4 mt-4">
  <div class="input-group">
      <input type="search" class="form-control" aria-label="Recipient's username" placeholder="type, num√©ro,nom,prenom" [(ngModel)]="filterValue" (input)="onSearch()">
      <button class="btn btnSearch" type="button" id="button-addon2"><i class="bi bi-search"></i></button>
    </div>          
</div>


 <!-- Contenu dashbord  -->
 <div class="container mb-5">
  <div class="header mb-4 d-grid gap-2 d-md-flex justify-content-md-end">
    <ul class="nav">
        <li><a [ngClass]="{'currentItemNav': boutonActif === 1}" (click)="showTypeDocument('Facture')" (click)="boutonActif = 1">Ventes</a></li>
        <li><a  [ngClass]="{'currentItemNav': boutonActif === 2}" (click)="showTypeDocument('Devis')" (click)="boutonActif = 2">Devis</a></li>
        <li><a  [ngClass]="{'currentItemNav': boutonActif === 3}" (click)="showTypeDocument('Bon de commande')" (click)="boutonActif = 3">Bon de commande</a></li>
        <li><a  [ngClass]="{'currentItemNav': boutonActif === 4}" (click)="showTypeDocument('Bon de Livraison')" (click)="boutonActif = 4">Bon de Livraison</a></li>
        <li><a  [ngClass]="{'currentItemNav': boutonActif === 5}" (click)="showTypeDocument('Bon d&#x2019;achat')" (click)="boutonActif = 5">Bon d'achat</a></li>
    </ul>
  </div>

<div class="contenu">

  <!-- Tableau Facture -->
  <div class="col-md-12 px-4" id="Facture" *ngIf="currentDoc==='Facture'">
    <div class="card mb-4 px-4 py-2 pt-4 rounded-4">
      <div  class="dropdown me-5 mt-4 col-2 mb-3">
        <button type="button" class="btn ajouter" data-bs-toggle="modal" data-bs-target="#facture" (click)="removeLocalStorage()">
          Ajouter Vente
       </button>
        <div class="dropdown col-2 ">
            <span style="cursor: pointer;" class="dropdown-toggle"></span>
        <div class="dropdown-content">
          <a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#FactureAvoir">Facture Avoir</a>
          <a class="dropdown-item">Facture recurrente</a>
        </div>		
      </div>
      </div>

    
      
        <div class="row sectionEspace ligneReseauSearch mb-3">
            <div class="col-md-5">
                <h3 class="fw-bold">Listes Facture</h3>
            </div>
              <div class="col-md-7 header mb-4 d-grid gap-2 d-md-flex justify-content-md-end">
                <ul class="nav">
                    <li><a [ngClass]="{'currentItemNav': sectionFacture === 1}" (click)="showfactureType('tout')" (click)="sectionFacture = 1" (click)="listeFacture()" >Tout</a></li>
                    <li><a [ngClass]="{'currentItemNav': sectionFacture === 2}" (click)="showfactureType('echeance')" (click)="sectionFacture = 2" (click)="listeFactureEcheance()">Facture d'√©ch√®ance</a></li>
                    <li><a [ngClass]="{'currentItemNav': sectionFacture === 3}" (click)="showfactureType('acompte')" (click)="sectionFacture = 3" (click)="listeFactureAcompte()" >Facture d'acompte</a></li>
                    <li><a [ngClass]="{'currentItemNav': sectionFacture === 4}" (click)="showfactureType('immediat')" (click)="sectionFacture = 4 "  (click)="listeFactureImmediat()">Facture Profromat</a></li>
                </ul>
              </div>
        </div>

        <!-- Le tableau des factures -->
            <!-- tout -->
              <div class="table-responsive" id="tout"  *ngIf="currentfactureType==='tout'" >
                  <table class="table table-hover mb-4">
                      <thead class="mb-2">
                          <tr>
                              <th scope="col">Num√©ro </th>
                              <th scope="col">Date Facture </th>
                              <th scope="col">Type Facture </th>
                              <th scope="col">Client </th>
                              <th scope="col">TotalHT </th>
                              <th scope="col">TotalTTC </th>
                              <th scope="col">Statut </th>
                              <th scope="col">Action </th>
                          </tr>
                      </thead>
                      <tbody *ngFor="let facture of  getItemsPage()">
                      <tr>
                          <td>{{facture.num_fact}}</td>
                          <td>{{facture.date_creation}}</td>
                          <td>{{facture.type_paiement}}</td>
                          <td>{{facture.prenom_client}} {{facture.nom_client}}</td>
                          <td>{{facture.prix_HT}}</td>
                          <td>{{facture.prix_TTC}}</td>
                          <td>{{facture.statut_paiement}}</td>
                          <td>
                              <i class="bi bi-eye me-2" title="details" data-bs-toggle="modal" data-bs-target="#detailFacture" (click)="details(facture.id)"></i>
                              <i class="bi bi-trash3" title="Supprimer" (click)="supprimerFacture(facture.id)" ></i>
                          </td>
                      </tr>
                      </tbody>
                  </table>
              </div>
          <!-- ech√®ance -->
              <div class="table-responsive" id="echeance"  *ngIf="currentfactureType==='echeance'" >
                <table class="table table-hover mb-4">
                    <thead class="mb-2">
                        <tr>
                            <th scope="col">Num√©ro </th>
                            <th scope="col">Date Facture </th>
                            <th scope="col">Type Facture </th>
                            <th scope="col">Client </th>
                            <th scope="col">TotalHT </th>
                            <th scope="col">TotalTTC </th>
                            <th scope="col">Statut </th>
                            <th scope="col">Action </th>
                        </tr>
                    </thead>
                    <tbody *ngFor="let facture of  getItemsPage()">
                    <tr>
                        <td>{{facture.num_fact}}</td>
                        <td>{{facture.date_creation}}</td>
                        <td>{{facture.type_paiement}}</td>
                        <td>{{facture.prenom_client}}</td>
                        <td>{{facture.prix_HT}}</td>
                        <td>{{facture.prix_TTC}}</td>
                        <td>{{facture.statut_paiement}}</td>
                        <td>
                          <i class="bi bi-eye me-2" title="details" data-bs-toggle="modal" data-bs-target="#detailFacture" (click)="details(facture.id)"></i>
                          <i class="bi bi-trash3" title="Supprimer" (click)="supprimerFacture(facture.id)" ></i>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
          <!-- acompte -->
            <div class="table-responsive" id="acompte"  *ngIf="currentfactureType==='acompte'" >
              <table class="table table-hover mb-4">
                  <thead class="mb-2">
                      <tr>
                          <th scope="col">Num√©ro </th>
                          <th scope="col">Date Facture </th>
                          <th scope="col">Type Facture </th>
                          <th scope="col">Client </th>
                          <th scope="col">TotalHT </th>
                          <th scope="col">TotalTTC </th>
                          <th scope="col">Statut </th>
                          <th scope="col">Action </th>
                      </tr>
                  </thead>
                  <tbody *ngFor="let facture of  getItemsPage()">
                  <tr>
                      <td>{{facture.num_fact}}</td>
                      <td>{{facture.date_creation}}</td>
                      <td>{{facture.type_paiement}}</td>
                      <td>{{facture.prenom_client}}</td>
                      <td>{{facture.prix_HT}}</td>
                      <td>{{facture.prix_TTC}}</td>
                      <td>{{facture.statut_paiement}}</td>
                      <td>
                        <i class="bi bi-eye me-2" title="details" data-bs-toggle="modal" data-bs-target="#detailFacture" (click)="details(facture.id)"></i>
                        <i class="bi bi-trash3" title="Supprimer" (click)="supprimerFacture(facture.id)" ></i>
                      </td>
                  </tr>
                  </tbody>
              </table>
          </div>
        <!-- immediat -->
          <div class="table-responsive" id="immediat"  *ngIf="currentfactureType==='immediat'" >
            <table class="table table-hover mb-4">
                <thead class="mb-2">
                    <tr>
                        <th scope="col">Num√©ro </th>
                        <th scope="col">Date Facture </th>
                        <th scope="col">Type Facture </th>
                        <th scope="col">Client </th>
                        <th scope="col">TotalHT </th>
                        <th scope="col">TotalTTC </th>
                        <th scope="col">Statut </th>
                        <th scope="col">Action </th>
                    </tr>
                </thead>
                <tbody *ngFor="let facture of  getItemsPage()">
                <tr>
                    <td>{{facture.num_fact}}</td>
                    <td>{{facture.date_creation}}</td>
                    <td>{{facture.type_paiement}}</td>
                    <td>{{facture.prenom_client}}</td>
                    <td>{{facture.prix_HT}}</td>
                    <td>{{facture.prix_TTC}}</td>
                    <td>{{facture.statut_paiement}}</td>
                    <td>
                      <i class="bi bi-eye me-2" title="details" data-bs-toggle="modal" data-bs-target="#detailFacture" (click)="details(facture.id)"></i>
                      <i class="bi bi-trash3" title="Supprimer" (click)="supprimerFacture(facture.id)" ></i>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination  -->
        <div *ngIf="getItemsPage().length">
          <div class="d-flex justify-content-end mb-2">
              <button class="border border-0 btnColor  mx-2" [disabled]="pageActuelle === 1"
                  (click)="pageActuelle = pageActuelle - 1">
                  <i class="bi bi-arrow-left-circle fs-4"></i>
              </button>
              <button class=" rounded-circle mx-2 page" *ngFor="let page of pages" (click)="pageActuelle = page">
                  <span class="pageActuelle fs-5" *ngIf="page===pageActuelle">{{page}}</span>
                  <span *ngIf="page != pageActuelle">{{page}}</span>
              </button>
              <button class="border border-0 btnColor mx-2" [disabled]="pageActuelle === totalPages"
                  (click)="pageActuelle = pageActuelle + 1">
                  <i class="bi bi-arrow-right-circle fs-4"></i>
              </button>
          </div>
      </div>
    </div>
  </div>
   <!-- Tableau D√©vis -->
   <div class="col-md-12 px-4" id="Devis" *ngIf="currentDoc==='Devis'">
    <div class="card mb-4 px-4 py-2 pt-4 rounded-4">
      <button type="button" class="btn ajouter  col-md-2 mb-3 mt-4" data-bs-toggle="modal" data-bs-target="#devis">
        Ajouter D√©vis
     </button>
        <div class="row sectionEspace ligneReseauSearch mb-3">
            <div class="col-md-5">
                <h3 class="fw-bold">Listes D√©vis</h3>
            </div>
              <div class="col-md-7">
              </div>
        </div>

        <!-- Le tableau des d√©vis -->
        <div class="table-responsive">
            <table class="table table-hover mb-4">
                <thead class="mb-2">
                    <tr>
                        <th scope="col">Num√©ro </th>
                        <th scope="col">Date Facture </th>
                        <th scope="col">Type Facture </th>
                        <th scope="col">Client </th>
                        <th scope="col">TotalHT </th>
                        <th scope="col">TotalTTC </th>
                        <th scope="col">Statut </th>
                        <th scope="col">Action </th>
                    </tr>
                </thead>
                <tbody *ngFor="let facture of  getItemsPage()">
                <tr data-bs-toggle="modal" data-bs-target="#detailFacture">
                    <td>{{facture.num_fact}}</td>
                    <td>{{facture.date_creation}}</td>
                    <td>{{facture.type_paiement}}</td>
                    <td>{{facture.prenom_client}}</td>
                    <td>{{facture.prix_HT}}</td>
                    <td>{{facture.prix_TTC}}</td>
                    <td>{{facture.statut_paiement}}</td>
                    <td>
                        <i class="bi bi-pencil-square me-2" title="modifier" data-bs-toggle="modal" data-bs-target="#ModalModifier"></i>
                        <i class="bi bi-trash3" title="Supprimer" ></i>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination  -->
        <div *ngIf="getItemsPage().length">
          <div class="d-flex justify-content-end mb-2">
              <button class="border border-0 btnColor  mx-2" [disabled]="pageActuelle === 1"
                  (click)="pageActuelle = pageActuelle - 1">
                  <i class="bi bi-arrow-left-circle fs-4"></i>
              </button>
              <button class=" rounded-circle mx-2 page" *ngFor="let page of pages" (click)="pageActuelle = page">
                  <span class="pageActuelle fs-5" *ngIf="page===pageActuelle">{{page}}</span>
                  <span *ngIf="page != pageActuelle">{{page}}</span>
              </button>
              <button class="border border-0 btnColor mx-2" [disabled]="pageActuelle === totalPages"
                  (click)="pageActuelle = pageActuelle + 1">
                  <i class="bi bi-arrow-right-circle fs-4"></i>
              </button>
          </div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- les modals -->

<!-- Modal mod√©l√© document -->
<div class="modal fade mt-5" id="seeMod√©le" tabindex="-1" aria-labelledby="seeMod√©leLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal"  aria-label="Close"></button>
      </div>
      <div class="modal-body container">
        <div class="imprimFact" >
          <i class="bi bi-printer"></i>
        </div>
        <div class="pdfFact" (click)="generatePdf()">
          <i class="bi bi-file-earmark-pdf"></i>
        </div>
        <div class="colorMod√©le">
          <input type="color"  class="form-control form-control-color "  [(ngModel)]="color" (input)="onColorChange()">
        </div>
        <div  class="card px-4 py-2 pt-4 shadow rounded-4 container" id="print-section">
          <div class="invoice container">
            <div class="row">
              <div class="col-7" *ngIf="InfoSup">
                <img src="http://127.0.0.1:8000{{InfoSup.logo}}" class="logo" style="width: 125px; height: 125px;">
                <table>
                  <thead class="thead-custom">
                      <tr>
                        <th> Informations entreprise</th>
                      </tr>
                  </thead>
                  <tbody class="bg-secondary text-dark p-5 bg-opacity-25" >
                    <p class="me-3 ms-3">Nom de l'entreprise :  {{ InfoSup.nom_entreprise }} </p>
                    <p class="me-3 ms-3">Adresse : {{ InfoSup.adress_entreprise}}</p>
                    <p class="me-3 ms-3">T√©l√©phone : {{ InfoSup.tel_entreprise }}</p>
                  </tbody>
                </table>
               
                <h4>{{ currentDate }}</h4>
                
              </div>
              <div class="col-5">
                <div class="invoice-number">
                  <h2>{{titre}}</h2>
                  <p class="fw-bold fs-5 row">
                    <label class="col-3">Num√©ro: </label>
                    <input type="text" id="numero" class="border border-0 col-4" [(ngModel)]="nextNumber" readonly>&nbsp;
                 </p>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-7">
              </div>
              <div class="col-5">
                <table>
                  <thead class="">
                      <tr>
                        <th> Informations client</th>
                      </tr>
                  </thead>
                  <tbody class="bg-secondary text-dark p-5 bg-opacity-25" *ngFor="let clientSelect of currentClient">
                    <p class="me-3 ms-3">Nom : {{clientSelect?.prenom_client}} {{clientSelect?.nom_client}}</p>
                    <p class="me-3 ms-3">Adresse : {{clientSelect?.adress_client}}</p>
                    <p class="me-3 ms-3">T√©l√©phone : {{clientSelect?.tel_client}}</p>
                    <p class="me-3 ms-3">Entreprise : {{clientSelect?.nom_entreprise}}</p>
                  </tbody>
                </table>
              </div>
            </div>
            <br>
            <br>
            <br>
            <table class="table table-bordered">
              <thead  class="thead-custom">
                <tr>
                  <th>Description</th>
                  <th>Quantit√©</th>
                  <th>PU</th>
                  <th>R√©duction</th>
                  <th>TVA</th>
                  <th>Total HT</th>
                  <th>Total TTC</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let row of rows; let i = index">
                  <td>
                    <div class="input-group mb-2 me-2">
                      <select class="form-control border border-0"  [(ngModel)]="row.selectedProduct" (change)="onProductSelect(row)"
                        (change)="listeGrille(row)" (change)="listePriceByArticle(row)" (input)="verifProduitFonction(row)">
                        <option value="0">S√©lectionnez un produit/service</option>
                        <option *ngFor="let product of products" [value]="product.id">{{ product.nom_article }}</option>
                      </select>
                    </div>
                  </td>
                  <td><input class="border border-0"  [(ngModel)]="row.quantity" (input)="calculateTotal(row)"
                      (input)="verifProduitFonction(row)"  (input)="calculateTotalTva(row)" placeholder="Quantit√©"></td>
                  <td>
                    <span *ngIf="row.promotionalPrice; else grillePrice">{{ row.promotionalPrice | number:'1.2-2' }}</span>
                    <ng-template #grillePrice>
                      <span *ngIf="row.grillePrice; else regularPrice">{{ row.grillePrice | number:'1.2-2' }}</span>
                      <ng-template #regularPrice>
                        <span>{{ row.unitPrice | number:'1.2-2' }}</span>
                      </ng-template>
                    </ng-template>
                  </td>
                  <td><input class="border border-0"  [(ngModel)]="row.reductionArticle"
                      (input)="calculateTotal(row)" (input)="calculateTotalTva(row)"  (input)="verifProduitFonction(row)" placeholder="r√©duction"></td>
                  <td><input class="border border-0"  [(ngModel)]="row.tva"
                        (input)="calculateTotalTva(row)" (input)="verifProduitFonction(row)" placeholder="tva"></td>
                  <td><span class="text-right">{{row.total | number:'1.2-2' }}</span></td>
                  <td><span class="text-right">{{row.totalTTC | number:'1.2-2' }}</span></td>
                </tr>
              </tbody>
            </table>
            <div class="row">
              <div class="col-6 mt-5"  >
                <ng-container *ngIf="naturefacture==='echeance'">
                  <h2>√âch√©ances</h2>
                  <table>
                    <thead>
                        <tr>
                            <th>Pr√©vue le :</th>
                            <th>Montant :</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of input; let i = index">
                            <td><input type="date" class="border border-0"  id="echeance1"  [(ngModel)]="item.date" ></td>
                            <td><input type="number" class="border border-0" id="montant1"   [(ngModel)]="item.prix"></td>
                        </tr>
                    </tbody>
                </table>
                </ng-container>
               
              </div>
              <div class="col-6">
                <br>
                <br>
                <table class="table table-sm text-right">
                  <tr>
                    <td><strong>Total HT</strong></td>
                    <td class="text-right"> <span class="font-weight-bold">{{ total | number:'1.2-2' }}</span> FCfa</td>
                  </tr>
                  <tr>
                    <td><strong>TVA</strong></td>
                    <td class="text-right"> <span class="font-weight-bold">{{ totalTVA | number:'1.2-2' }}</span> FCfa</td>
                  </tr>
                  <tr>
                    <td><strong>Total TTC</strong></td>
                    <td class="text-right"> <span class="font-weight-bold">{{ totalTTC | number:'1.2-2' }}</span> FCfa</td>
                  </tr>
                  <tr>
                    <td><strong>Remise</strong></td>
                    <input class="border border-0" name="remise" [(ngModel)]="remise" (input)="calculateGrandTotalAvecRemise()">
                  </tr>
                  <tr>
                    <td><strong>Total net √† payer</strong></td>
                    <td class="text-right"> <span class="font-weight-bold">{{ totalRemise | number:'1.2-2' }}</span> FCfa</td>
                  </tr>
                </table>
              </div>     
          </div>
          <div class="row"  *ngIf="naturefacture==='facture_Accompt'">
            <table  class="table table-bordered">
              <thead class="thead-custom">
                <tr>
                  <th>Facture Acompte</th>
                  <th>Total</th>
              </tr>
              </thead>
               <tbody>
                <tr *ngFor="let acompte of tabAcompte">
                  <td>{{ acompte.titreAccomp }} - Facture N¬∞ {{ acompte.num_facture }} (du {{ acompte.dateEcheance }})</td>
                  <td>{{ acompte.montant | number:'1.2-2' }}</td>
                </tr>
               </tbody>
            </table>
            <p class="total mt-2">Solde: {{totalRemise}}XOF</p>
          </div>
          </div>
         </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal configuration num√©ro -->
<div class="modal fade mt-5" id="setting" tabindex="-1" aria-labelledby="settingLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal"  aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="config">
          <h1>Configurer num√©rotation automatique de ventes</h1>
          
          <div class="option">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="" id="flexCheckIndeterminate" checked>
              <label class="form-check-label" for="flexCheckIndeterminate">
                Champ num√©ro modifiable
              </label>
            </div>
          </div>
          

          <div class="form-check ">
            <input class="form-check-input" type="radio" name="flexRadioDefault" value="par_defaut" [(ngModel)]="numerotation"  id="flexRadioDefault1" (click)="showNumConfig('sansPrefixes')" checked>
            <label class="form-check-label" for="flexRadioDefault1">
              Num√©rotation par d√©faut (incr√©ment√©e de fa√ßon alphanum√©rique)
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" value="avec_prefixe" [(ngModel)]="numerotation" id="flexRadioDefault2" (click)="showNumConfig('avecPrefixes')" >
            <label class="form-check-label" for="flexRadioDefault2">
              Num√©rotation avec pr√©fixe
            </label>
          </div>
          
          <div class="option"  id="avecPrefixes" *ngIf="currentNumConfig==='avecPrefixes'">
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="custom" (change)="updatePrefix()">
                Pr√©fixe personnalis√© : 
                <input type="text" [disabled]="selectedPrefix !== 'custom'" [(ngModel)]="customPrefix" (ngModelChange)="updatePrefix()">
              </label>
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="annee" (change)="updatePrefix()">
                Pr√©fixe avec l'ann√©e en cours
              </label>
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="annee_mois" (change)="updatePrefix()">
                Pr√©fixe avec l'ann√©e et le mois en cours
              </label>
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="annee_mois_jour" (change)="updatePrefix()">
                Pr√©fixe avec l'ann√©e, le mois et le jour en cours
              </label>
            </div>
            <div class="next-number">
              <label>Prochain num√©ro :</label>
              <input type="text" name="nextNumber" [(ngModel)]="nextNumber" readonly>
            </div>
          </div>

          <div  id="sansPrefixes" *ngIf="currentNumConfig==='sansPrefixes'">
            <div class="next-number">
              <label>Prochain num√©ro :</label>
              <input type="text"  [(ngModel)]="nextNumber" readonly>
            </div>
          </div>
          
          
          <button class="save-btn" data-bs-toggle="modal" data-bs-target="#facture" (click)="configurationNumero()">Sauvegarder</button>
      </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Associer client -->
<div class="modal fade mt-5" id="client" tabindex="-1" aria-labelledby="clientLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal"  aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h3>+ Associer un client</h3>
        <div class="input-group mb-5">
          <select class="form-select form-select-lg " id="client-select" [(ngModel)]="selectedClient" (change)="onClientSelected()" (input)="verifClientFonction()">
            <option *ngFor="let client of tabClient" [value]="client.id">{{client.prenom_client}} {{client.nom_client}}</option>
          </select>
          <button type="button" class="btn ajouter" data-bs-toggle="modal" data-bs-target="#exampleModal">
            Ajouter un client
          </button>
        </div>
        <button class="btnAction mx-auto btn mt-3" data-bs-toggle="modal" data-bs-target="#FactureAvoir">Sauvegarder</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal liste facture associer √† un client -->
<div class="modal fade mt-5" id="factureClient" tabindex="-1" aria-labelledby="factureClientLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal"  aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="table-responsive">
          <h3>Associer vente √† cette note de cr√©dit</h3>
          <table class="table table-hover mb-4">
              <thead class="mb-2">
                  <tr>
                      <th scope="col">Num√©ro </th>
                      <th scope="col">Date Facture </th>
                      <th scope="col">Client </th>
                      <th scope="col">TotalTTC </th>
                  </tr>
              </thead>
              <tbody *ngFor="let facture of  getItemsPage()">
              <tr (click)="recupNumeroFacture(facture.num_fact);details(facture.id)" >
                  <td>{{facture.num_fact}}</td>
                  <td>{{facture.date_creation}}</td>
                  <td>{{facture.prenom_client}} {{facture.nom_client}}</td>
                  <td>{{facture.prix_TTC}}</td>
              </tr>
              </tbody>
          </table>
           <!-- Pagination  -->
        <div *ngIf="getItemsPage().length">
          <div class="d-flex justify-content-end mb-2">
              <button class="border border-0 btnColor  mx-2" [disabled]="pageActuelle === 1"
                  (click)="pageActuelle = pageActuelle - 1">
                  <i class="bi bi-arrow-left-circle fs-4"></i>
              </button>
              <button class=" rounded-circle mx-2 page" *ngFor="let page of pages" (click)="pageActuelle = page">
                  <span class="pageActuelle fs-5" *ngIf="page===pageActuelle">{{page}}</span>
                  <span *ngIf="page != pageActuelle">{{page}}</span>
              </button>
              <button class="border border-0 btnColor mx-2" [disabled]="pageActuelle === totalPages"
                  (click)="pageActuelle = pageActuelle + 1">
                  <i class="bi bi-arrow-right-circle fs-4"></i>
              </button>
          </div>
      </div>
      </div>
        <button class="btnAction mx-auto btn mt-3" data-bs-toggle="modal" data-bs-target="#FactureAvoir">Sauvegarder</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal definition solde pour un client -->
<div class="modal fade mt-5" id="solde" tabindex="-1" aria-labelledby="soldeLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal"  aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="solde">
          <h3>Ajouter solde en faveur</h3>
          <form>
              <div class="form-group">
                  <label for="client">Client :</label>
                  <div class="client-input">
                      <div class="client-icon">üë§</div>
                      <input type="text" id="client" value="Aly DIA" readonly>
                  </div>
              </div>
              <p class="info-text">Vous pouvez utiliser ce solde en faveur comme moyen de paiement dans une future vente pour ce client</p>
              <div class="form-group">
                  <label for="montant">Montant :</label>
                  <div class="currency-input">
                      <input type="text" id="montant" value="0,00">
                  </div>
              </div>
              <div class="form-group">
                  <label for="date">Re√ßu le :</label>
                  <input type="date" id="date" value="2024-07-10">
              </div>
              <div class="form-group">
                  <label for="paiement">Moyen paiement :</label>
                  <select id="paiement">
                      <option>Esp√®ces</option>
                  </select>
              </div>
              <div class="form-group">
                  <label for="commentaire">Commentaire :</label>
                  <textarea id="commentaire">Solde en faveur cr√©√© √† partir de la note de cr√©dit du 10/07/2024</textarea>
              </div>
              <div class="button-group">
                  <button type="submit" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#FactureAvoir">Ajouter</button>
              </div>
          </form>
      </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Ajout client -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Ajout Client</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body container">
        <form>
          <div class="row">
            <div class="mb-3 col-md-6 ">
              <label for="validationServer01" class="form-label">Pr√©nom</label>
              <input type="text" class="form-control" id="validationServer01" name="prenom" [(ngModel)]="prenom">
            </div>
            <div class="mb-3 col-md-6 ">
             <label for="validationServer02" class="form-label">Nom</label>
             <input type="text" class="form-control" id="validationServer02" name="nom" [(ngModel)]="nom">
            </div>
          </div>
          <div class="row">
            <div class="mb-3 col-md-6 ">
              <label for="validationServer02" class="form-label">Nom Entreprise</label>
              <input type="text" class="form-control" id="validationServer02" name="nom" [(ngModel)]="entreprise">
             </div>
             <div class="mb-3 col-md-6 ">
              <label for="validationServer02" class="form-label">Adresse</label>
              <input type="text" class="form-control" id="validationServer02" name="nom" [(ngModel)]="adress">
             </div>
          </div>
         <div class="row">
           <div class="mb-3 col-md-6 ">
            <label for="validationServer02" class="form-label">T√©l√©phone</label>
            <input type="text" class="form-control" id="validationServer02" name="nom" [(ngModel)]="telephone">
           </div>
           <div class="mb-3 col-md-6 ">
            <label for="validationServer02" class="form-label">Email</label>
            <input type="text" class="form-control" id="validationServer02" name="nom" [(ngModel)]="mail">
           </div>
          </div>
          <div class="mb-3 ">
              <label for="exampleInputPassword1" class="form-label">Cat√©gorie</label>
            <select class="form-select" aria-label="Default select example" name="role" [(ngModel)]="typeClient">
              <option selected disabled>Choisisez un role</option>
              <option *ngFor="let categorie of tabCategorie" [value]="categorie.id">{{categorie.nom_categorie}}</option>
            </select>
          </div>
      </form>
      </div>
      <div class="modal-footer">
          <button type="button" class="btn btnAction" (click)="ajouterUsers()" data-bs-toggle="modal" data-bs-target="#facture">Ajouter</button>
        <button type="button" class="btn btnClose" data-bs-dismiss="modal">Annuler</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Ajout article -->
<div class="modal fade" id="produit" tabindex="-1" aria-labelledby="produitLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="produitLabel">Ajout Article</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body container">
        <form>
          <div class="row">
            <div class="mb-3 col-6">
              <label for="validationServer01" class="form-label">Nom</label>
              <input type="text" class="form-control" id="validationServer01" name="nom" [(ngModel)]="nom">
            </div>
            <div class="mb-3 col-6">
             <label for="validationServer02" class="form-label">Description</label>
             <input type="text" class="form-control" id="validationServer02" name="desc" [(ngModel)]="desc">
            </div>
          </div>
          <div class="row">
            <div class="mb-3 col-6">
              <label for="validationServer02" class="form-label">Prix d'achat</label>
              <input type="text" class="form-control" id="validationServer02" name="achat" [(ngModel)]="achat">
             </div>
             <div class="mb-3 col-6 ">
              <label for="validationServer02" class="form-label">Prix de vente</label>
              <input type="text" class="form-control" id="validationServer02" name="vente" [(ngModel)]="vente">
             </div>
          </div>
          <div class="row">
            <div class="mb-3 col-6 ">
              <label for="validationServer02" class="form-label">Quantit√©</label>
              <input type="text" class="form-control" id="validationServer02" name="quantite" [(ngModel)]="quantite">
             </div>
             <div class="mb-3 col-6 ">
              <label for="validationServer02" class="form-label">Quantit√© Alerte</label>
              <input type="text" class="form-control" id="validationServer02" name="quantiteAlerte" [(ngModel)]="quantiteAlerte">
             </div>
          </div>
        <div class="form-check form-check-inline" (click)="afficherChamps()">
          <input class="form-check-input" type="checkbox" id="inlineCheckbox1" value="option1">
          <label class="form-check-label" for="inlineCheckbox1">Ajouter Cat√©gorie</label>
        </div>
        <div class="mb-3" *ngIf="showChamps">
            <label for="exampleInputPassword1" class="form-label">Cat√©gorie article</label>
          <select class="form-select" aria-label="Default select example" name="promo" [(ngModel)]="CategorieArticle">
            <option selected disabled>Choisisez une cat√©gorie</option>
            <option *ngFor="let categorieArticle of tabCategorie" [value]="categorieArticle.id">{{categorieArticle.nom_categorie_article}}</option>
          </select>
        </div>
          
      </form>
      </div>
      <div class="modal-footer">
          <button type="button" class="btn btnAction" (click)="ajouterArticle()"  data-bs-toggle="modal" data-bs-target="#facture">Ajouter</button>
        <button type="button" class="btn btnClose" data-bs-dismiss="modal">Annuler</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Ajout service -->
<div class="modal fade" id="service" tabindex="-1" aria-labelledby="serviceLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="serviceLabel">Ajout Service</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body container">
        <form>
            <div class="mb-3">
              <label for="validationServer01" class="form-label">Nom</label>
              <input type="text" class="form-control" id="validationServer01" name="nom" [(ngModel)]="nom">
            </div>
            <div class="mb-3">
             <label for="validationServer02" class="form-label">Description</label>
             <input type="text" class="form-control" id="validationServer02" name="desc" [(ngModel)]="desc">
            </div>
         
          
             <div class="mb-3">
              <label for="validationServer02" class="form-label">Prix de vente</label>
              <input type="text" class="form-control" id="validationServer02" name="vente" [(ngModel)]="vente">
             </div>
        
      </form>
      </div>
      <div class="modal-footer">
          <button type="button" class="btn btnAction" (click)="ajouterService()" data-bs-toggle="modal" data-bs-target="#facture">Ajouter</button>
        <button type="button" class="btn btnClose" data-bs-dismiss="modal">Annuler</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal d√©tail facture -->
<div class="modal fade mt-5" id="detailFacture" tabindex="-1" aria-labelledby="detailFactureLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="detailFactureLabel">D√©tails</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="seeFact" data-bs-toggle="modal" data-bs-target="#pdfModel">
          <i class="bi bi-eye"></i>
        </div>
        <div class="header mb-4 d-grid gap-2 d-md-flex justify-content-md-end">
          <ul class="nav">
              <li><a [ngClass]="{'currentItemNav': boutonActif === 1}" (click)="showDetailFacture('R√©capitulatif')" (click)="boutonActif = 1" >R√©capitulatif</a></li>
              <li><a [ngClass]="{'currentItemNav': boutonActif === 2}" (click)="showDetailFacture('R√©glements')" (click)="boutonActif = 2" *ngIf="detailFacture && detailFacture.type_paiement!='immediat'">R√©glements</a></li>
          </ul>
        </div>
        
        <ng-container *ngIf="detailFacture">
          <div  id="R√©capitulatif"  *ngIf="currentDetail==='R√©capitulatif'" >
            <div class="header">
              <div>
                  <label>Date:</label>
                  <span>{{detailFacture.date_creation | date:'yyyy-MM-dd'}}</span>
              </div>
              <div>
                  <label>Num√©ro:</label>
                  <span>{{detailFacture.numero_facture}}</span>
              </div>
          </div>
      
          <div class="section border p-3" *ngIf=" client">
              <div class="section-title">
                  1. √Ä qui je-vends ? <span class="edit-icon">‚úé</span>
              </div>
              <span>{{client.prenom}} {{client.nom}}</span>
          </div>
      
          <div class="section border p-3" *ngIf="detailFacture.type_paiement==='immediat' || detailFacture.type_paiement==='echeance' ">
              <div class="section-title">
                  2. Quels produits / services ? <span class="edit-icon">‚úé</span>
              </div>
              <table class="detailFacture">
                  <thead>
                      <tr>
                          <th>Produit / Service</th>
                          <th>Quantit√©</th>
                          <th>TVA</th>
                          <th>Prix unitaire</th>
                          <th>Prix Total TTC</th>
                          <th>Total</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr *ngFor="let article of article" >
                        <td>{{article.nom_article}}</td>
                        <td>{{article.quantite_article}}</td>
                        <td>{{article.prix_achat}}</td>
                        <td>{{article.prix_unitaire_article}}</td>
                        <td>{{article.prix_total_tva_article}}</td>
                        <td>{{detailFacture.prix_TTC}}</td>
                      </tr>
                  </tbody>
              </table>
              <p class="total mt-2">Total: {{detailFacture.prix_TTC}} XOF</p>
          </div>
          <div class="section border p-3" *ngIf="detailFacture.type_paiement==='facture_Accompt'">
            <div class="section-title">
              2. Quels produits / services ? 
              <span class="edit-icon">‚úé</span>
          </div>
      
          <table class="acompteTab">
              <thead>
                  <tr>
                    <th>Produit / Service</th>
                    <th>Quantit√©</th>
                    <th>TVA</th>
                    <th>Prix unitaire</th>
                    <th>Prix Total TTC</th>
                    <th>Total</th>
                  </tr>
              </thead>
              <tbody>
                <tr *ngFor="let article of article" >
                  <td>{{article.nom_article}}</td>
                  <td>{{article.quantite_article}}</td>
                  <td>{{article.prix_achat}}</td>
                  <td>{{article.prix_unitaire_article}}</td>
                  <td>{{article.prix_total_tva_article}}</td>
                  <td>{{detailFacture.prix_TTC}}</td>
                </tr>
                  <tr *ngFor="let acompte of acompteFacture">
                      <td colspan="5">{{acompte.titreAccomp}} - Facture N¬∞ {{detailFacture.numero_facture}} (du {{acompte.dateEcheance}})</td>
                      <td>{{acompte.montant}}</td>
                  </tr>
              </tbody>
              <tfoot>
                  <tr class="total-row">
                      <td colspan="5" style="text-align: right;">Total</td>
                      <td>45 000,00 XOF</td>
                  </tr>
              </tfoot>
          </table>
          </div>
  
          <div class="section border p-3" *ngIf="detailFacture.type_paiement==='immediat' ">
            <div class="section-title">
                3. Quand serai-je pay√© ? <span class="edit-icon">‚úé</span>
            </div>
            <div class="payment-schedule">
              <p>
                <span>Type de paiement : {{detailFacture.type_paiement}} </span> <br>
                <span>Moyen de paiement : {{detailFacture.moyen_paiement}}</span>
              </p>
              </div>
        </div> 
          <div class="section border p-3" *ngIf="detailFacture.type_paiement==='echeance' ">
              <div class="section-title">
                  3. Quand serai-je pay√© ? <span class="edit-icon">‚úé</span>
              </div>
              <div class="payment-schedule">
                <p>
                  <span>Combien d'√©ch√©ances : </span>
                  <span>{{detailFacture.nombre_echeance}}</span>
                </p>
                <p *ngFor="let echeance of echeance; let i = index">
                  <span>√âch√©ance {{i+1}}:</span>
                  <span>{{echeance.date_pay_echeance}}</span>
                  <span>{{echeance.montant_echeance}}</span>
                </p>
                </div>
          </div> 
          <div class="section border p-3" *ngIf="detailFacture.type_paiement==='facture_Accompt'">
            <div class="section-title">
              3. Quand serai-je pay√© ? 
              <span class="edit-icon">‚úé</span>
          </div>
      
          <h3>Factures d'acompte :</h3>
          <table class="acompteTab">
              <thead>
                  <tr>
                      <th>Num√©ro</th>
                      <th>Date</th>
                      <th>Montant</th>
                      <th></th>
                  </tr>
              </thead>
              <tbody>
                  <tr *ngFor="let acompte of acompteFacture">
                      <td>000001</td>
                      <td>{{acompte.dateEcheance}}</td>
                      <td>{{acompte.montant}} XOF</td>
                      <td>
                        <span class="status-icon" style="color: red;">‚ö†</span>
                        <span class="status-icon" style="color: green;">‚úì</span>
                      </td>
                  </tr>
              </tbody>
          </table>
          <div class="solde-section">
              <div class="row">
                <div class="col-2">
                  <label for="solde-date">Solde :</label>
                </div>
                  <div class="col-5">
                    <input type="date" id="solde-date" value="2024-07-15">
                  </div>
                  <div class="col-5">
                    <input type="number" value="45000.00" step="0.01">
                  </div>
              </div>
          </div>
          </div>     
          </div>
        </ng-container>
       <ng-container>
        <div  id="R√©glements"  *ngIf="currentDetail==='R√©glements'">
          <div class="totalR√©glements">
            Total: {{detailFacture.prix_TTC}}XOF
        </div>
        
        <div class="payment-section">
            <div class="received-payments ">
                <h3>Paiements re√ßus</h3>
                <table>
                  <thead>
                      <tr>
                          <th>Num√©ro</th>
                          <th>Date</th>
                          <th>Montant</th>
                          <th>Action</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr *ngFor="let paiement of tabPaiementFacture">
                          <td>{{paiement.num_paiement}}</td>
                          <td>{{paiement.date_recu}}</td>
                          <td>{{paiement.montant}}</td>
                          <td class="text-center"> <i class="bi bi-reply" title="transformer en √©ch√®ance" (click)="paymentRecuEnecheance(paiement.id)"></i></td>
                      </tr>
                  </tbody>
              </table>
            </div>
            
            <div class="pending-payments">
                <h3>√âch√©ances en attente</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Pr√©vu</th>
                            <th>Montant</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let echeance of tabEcheanceFacture">
                            <td>{{echeance.date_pay_echeance}}</td>
                            <td>{{echeance.montant_echeance}}</td>
                            <td class="text-center"> <i class="bi bi-wallet-fill" title="Ajouter payement" (click)="chargerInfosEcheance(echeance)" data-bs-toggle="modal" data-bs-target="#EncheanceEnPayement"></i></td>
                        </tr>
                    </tbody>
                </table>
                <a href="#" class="add-link">+ Ajouter une √©ch√©ance</a>
            </div>
        </div>
        
        <div class="reminders">
            <span>‚öô</span> Relances automatiques (d√©sactiv√©)
        </div>
        </div>
       </ng-container>
       
    </div>
      <div class="modal-footer">
        <button type="button" class="btn btnClose" data-bs-dismiss="modal">Fermer</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal pour t√©l√©charger facture -->
<div class="modal fade mt-5" id="pdfModel" tabindex="-1" aria-labelledby="pdfModelLabel" aria-hidden="true" *ngIf="detailFacture">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal"  aria-label="Close"></button>
      </div>
      <div class="modal-body container">
        <div class="imprimFact" >
          <i class="bi bi-printer"></i>
        </div>
        <div class="pdfFact" (click)="generatePdf()">
          <i class="bi bi-file-earmark-pdf"></i>
        </div>
        <div class="colorMod√©le">
          <input type="color"  class="form-control form-control-color "  [(ngModel)]="color" (input)="onColorChange()">
        </div>
        <div  class="card px-4 py-2 pt-4 shadow rounded-4 container" id="print-section">
          <div class="invoice container">
            <div class="row">
              <div class="col-7" *ngIf="InfoSup">
                <img src="http://127.0.0.1:8000{{InfoSup.logo}}" class="logo" style="width: 125px; height: 125px;">
                <table>
                  <thead class="thead-custom">
                      <tr>
                        <th> Informations entreprise</th>
                      </tr>
                  </thead>
                  <tbody class="bg-secondary text-dark p-5 bg-opacity-25" >
                    <p class="me-3 ms-3">Nom de l'entreprise :  {{ InfoSup.nom_entreprise }} </p>
                    <p class="me-3 ms-3">Adresse : {{ InfoSup.adress_entreprise}}</p>
                    <p class="me-3 ms-3">T√©l√©phone : {{ InfoSup.tel_entreprise }}</p>
                  </tbody>
                </table>
               
                <h4 class="mt-5"><span>{{detailFacture.date_creation | date:'yyyy-MM-dd'}}</span></h4>
                
              </div>
              <div class="col-5">
                <div class="invoice-number">
                  <h2>{{titre}}</h2>
                  <p class="fw-bold fs-5 row">
                    <label class="col-3">Num√©ro: </label>
                    <span>{{detailFacture.numero_facture}}</span>&nbsp;
                 </p>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-7">
              </div>
              <div class="col-5">
                <table>
                  <thead class="">
                      <tr>
                        <th> Informations client</th>
                      </tr>
                  </thead>
                  <tbody class="bg-secondary text-dark p-5 bg-opacity-25" *ngIf="client">
                    <span>{{client.prenom}} {{client.nom}}</span>
                  </tbody>
                </table>
              </div>
            </div>
            <br>
            <br>
            <br>
           <ng-container *ngIf="detailFacture.type_paiement==='immediat' || detailFacture.type_paiement==='echeance' ">
            <table class="detailFacture">
              <thead>
                  <tr>
                      <th>Produit / Service</th>
                      <th>Quantit√©</th>
                      <th>TVA</th>
                      <th>Prix unitaire</th>
                      <th>Prix Total TTC</th>
                      <th>Total</th>
                  </tr>
              </thead>
              <tbody>
                  <tr *ngFor="let article of article" >
                    <td>{{article.nom_article}}</td>
                    <td>{{article.quantite_article}}</td>
                    <td>{{article.prix_achat}}</td>
                    <td>{{article.prix_unitaire_article}}</td>
                    <td>{{article.prix_total_tva_article}}</td>
                    <td>{{detailFacture.prix_TTC}}</td>
                  </tr>
              </tbody>
          </table>
          <p class="total mt-2">Total: {{detailFacture.prix_TTC}} XOF</p>
           </ng-container>
           <ng-container  *ngIf="detailFacture.type_paiement==='facture_Accompt'">
            <table class="acompteTab">
              <thead>
                  <tr>
                    <th>Produit / Service</th>
                    <th>Quantit√©</th>
                    <th>TVA</th>
                    <th>Prix unitaire</th>
                    <th>Prix Total TTC</th>
                    <th>Total</th>
                  </tr>
              </thead>
              <tbody>
                <tr *ngFor="let article of article" >
                  <td>{{article.nom_article}}</td>
                  <td>{{article.quantite_article}}</td>
                  <td>{{article.prix_achat}}</td>
                  <td>{{article.prix_unitaire_article}}</td>
                  <td>{{article.prix_total_tva_article}}</td>
                  <td>{{detailFacture.prix_TTC}}</td>
                </tr>
              </tbody>
              <tfoot>
                  <tr class="total-row">
                      <td colspan="5" style="text-align: right;">Total</td>
                      <td>{{detailFacture.prix_TTC}} XOF</td>
                  </tr>
              </tfoot>
          </table>
           </ng-container>
            <div class="row">
              <div class="col-6 mt-5"  >
                <ng-container *ngIf="detailFacture.type_paiement==='echeance'">
                  <h2>√âch√©ances</h2>
                  <table>
                    <thead>
                        <tr>
                            <th>Num√©ro</th>
                            <th>Pr√©vue le :</th>
                            <th>Montant :</th>
                        </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let echeance of echeance; let i = index">
                        <td>{{detailFacture.numero_facture}}-{{i+1}}</td>
                        <td>{{echeance.date_pay_echeance}}</td>
                        <td>{{echeance.montant_echeance}}</td>
                      </tr>
                    </tbody>
                </table>
                </ng-container>
               
              </div>
              <div class="col-6">
              </div>     
          </div>
          <div class="row"  *ngIf="detailFacture.type_paiement==='facture_Accompt'">
            <table  class="table table-bordered">
              <thead class="thead-custom">
                <tr>
                  <th>Facture Acompte</th>
                  <th>Total</th>
              </tr>
              </thead>
               <tbody>
                <tr *ngFor="let acompte of acompteFacture">
                  <td>{{acompte.titreAccomp}} - Facture N¬∞ {{detailFacture.numero_facture}}  (du {{acompte.dateEcheance}})</td>
                  <td>{{acompte.montant}}</td>
              </tr>
               </tbody>
            </table>
            <p class="total mt-2">Solde: {{totalRemise}}XOF</p>
          </div>
          </div>
         </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal facture d'accompte -->
<div class="modal fade" id="echeance" tabindex="-1" aria-labelledby="echeanceLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="echeanceLabel">facture d'acompte</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-2">
        <h2>Ajouter facture d'acompte</h2>
        <form>
            <div class="form-group">
                <label for="intitule">Intitul√© :</label>
                <input type="text" id="intitule" name="intitule" name="acompte" [(ngModel)]="acompte" placeholder="Acompte 1">
            </div>
            <div class="row">
              <div class="col-6">
                <label for="dateDebut">Date d√©but:</label>
                <input type="date" id="dateDebut" name="dateDebut" [(ngModel)]="dateDebut">
              </div>
              <div class="col-6">
                <label for="dateFin">Date fin:</label>
                <input type="date" id="dateFin" name="dateFin" [(ngModel)]="dateFin">
              </div>
            </div>
            <div class="row">
              <div class="col-6">
                <label for="totalHT">Total HT de la vente :</label>
                <div class="currency-input">
                    <input type="number" id="totalHT" name="totalAcompte" [(ngModel)]="totalRemise" step="0.01">
                </div>
              </div>
              <div class="col-6">
                <label for="montant">Montant de l'acompte:</label>
                <div class="currency-input">
                    <input type="number" id="montant" name="montantAcompte" [(ngModel)]="montantAcompte" step="0.01">
                </div>
              </div>
            </div>
            <div class="form-group">
                <label for="commentaire">Commentaire (affich√© dans la facture) :</label>
                <textarea id="commentaire" name="commentaire" [(ngModel)]="commentaire" rows="4"></textarea>
            </div>
            
        </form>
      </div>
      <div class="modal-footer">
        <button type="submit"  class="btn btnAction"  data-bs-toggle="modal" data-bs-target="#facture" (click)="createAcompte()">Ajouter acompte</button>
        <button type="button" class="btn btnClose" data-bs-dismiss="modal">Annuler</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Echeance en payement -->
<div class="modal fade mt-5" id="EncheanceEnPayement" tabindex="-1" aria-labelledby="EncheanceEnPayementLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      <div class="modal-body">
        <div class="containerEcheance">
          <h3>Transformer en paiement re√ßu</h3>
          <form>
            <div class="row">
              <div class="form-group col-6">
                <label for="prevu">Pr√©vu :</label>
                <input type="date" id="prevu" name="datePrevu" [(ngModel)]="datePrevu">
            </div>
            <div class="form-group col-6">
                <label for="recu">Re√ßu le :</label>
                <input type="date" id="recu" name="dateRecu" [(ngModel)]="dateRecu" >
            </div>
            </div>
             <div class="row">
              <div class="form-group">
                <label for="montant">Montant :</label>
                <div class="currency-input">
                    <input type="number" id="montant" step="0.01" name="montantEcheance" [(ngModel)]="montantEcheance">
                </div>
            </div>
            <div class="form-group">
                <label for="moyen">Moyen paiement :</label>
                <select id="moyen" name="moyen" [(ngModel)]="moyen">
                  <option *ngFor="let paye of tabPayement" [value]="paye.id">{{paye.nom_payement}}</option>
                </select>
            </div>
             </div>
              <div class="form-group">
                  <label for="commentaire">Commentaire (affich√© dans le re√ßu) :</label>
                  <textarea id="commentaire" rows="3" name="noteEcheance" [(ngModel)]="noteEcheance"></textarea>
              </div>
              <button *ngIf="detailFacture && detailFacture.type_paiement==='echeance'" type="submit" class="submit-btn" (click)="echeanceEnPayementRecu()" data-bs-toggle="modal" data-bs-target="#detailFacture">Transformer en paiement re√ßu</button>
              <button  *ngIf="detailFacture && detailFacture.type_paiement==='facture_Accompt'" type="submit" class="submit-btn" (click)="echeanceEnPayementRecu()" data-bs-toggle="modal" data-bs-target="#detailFacture">Transformer acompte en paiement re√ßu</button>
          </form>
      </div>
      </div>
    </div>
  </div>
</div>



<!-- Modal creation facture -->
<div class="modal fade mt-5" id="facture" tabindex="-1" aria-labelledby="factureLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered  modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="factureLabel">{{titre}}</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body ">
        <div class="seeFact" data-bs-toggle="modal" data-bs-target="#seeMod√©le">
          <i class="bi bi-eye"></i>
        </div>
        <div class="containerFacture">
          <div class="headerFacture">
              <div class="date-input">
                  <label for="date">Date:&nbsp;</label>
                  <input type="date" id="date" value="2024-07-02">
              </div>
              <div class="numero-input">
                  <label for="numero">Num√©ro :&nbsp;</label>
                  <input type="text" id="numero" name="nextNumber"[(ngModel)]="nextNumber" readonly>&nbsp;
                  <i class="bi bi-gear" data-bs-toggle="modal" data-bs-target="#setting"></i>
              </div>
          </div>
          
          <div class="section">
              <div class="section-title">1. √Ä qui je-vends ?</div>
              <label class="checkbox-label">
                  <input type="checkbox">&nbsp; Ne pas associer un client √† cette vente
              </label>
              <div class="input-group mb-5">
                <select class="form-select form-select-lg " id="client-select" [(ngModel)]="selectedClient" (change)="onClientSelected()" (input)="verifClientFonction()">
                  <option *ngFor="let client of tabClient" [value]="client.id">{{client.prenom_client}} {{client.nom_client}}</option>
                </select>
                <button type="button" class="btn ajouter" data-bs-toggle="modal" data-bs-target="#exampleModal">
                  Ajouter un client
                </button>
              </div>
              <button class="suivant-btn btn mt-3" [disabled]="!exactClient" (click)="showStep('data')">Suivant ‚ñº</button>
          </div>
          
          <div class="section">
              <div class="section-title">2. Quels produits / services ?</div>
              <div class="stepTwo" id="data" *ngIf="currentStep==='data'">
                <table class="table table-bordered border-light">
                  <thead class="thead-custom">
                    <tr>
                      <th>Description</th>
                      <th>Quantit√©</th>
                      <th>PU</th>
                      <th>R√©duction</th>
                      <th>TVA</th>
                      <th>Total HT</th>
                      <th>Total TTC</th>
                      <th *ngIf="!isPreview"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let row of rows; let i = index">
                      <td>
                        <div class="input-group mb-2 me-2">
                          <select class="form-control"  [(ngModel)]="row.selectedProduct" (change)="onProductSelect(row)"
                            (change)="listeGrille(row)" (change)="listePriceByArticle(row)" (input)="verifProduitFonction(row)">
                            <option value="0">S√©lectionnez un produit/service</option>
                            <option *ngFor="let product of products" [value]="product.id">{{ product.nom_article }}</option>
                          </select>
                          <div class="dropdown">
                            <button class="btn ajouter text-white dropdown-toggle" type="button" data-bs-toggle="dropdown"
                              aria-expanded="false">Ajouter</button>
                            <ul class="dropdown-menu">
                              <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#produit">Produit</a></li>
                              <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#service">Service</a></li>
                            </ul>
                          </div>
                        </div>
                      </td>
                      <td><input type="number" class="form-control" [(ngModel)]="row.quantity" (input)="calculateTotal(row)"
                          (input)="verifProduitFonction(row)"  (input)="calculateTotalTva(row)" placeholder="Quantit√©"></td>
                      <td>
                        <span *ngIf="row.promotionalPrice; else grillePrice">{{ row.promotionalPrice | number:'1.2-2' }}</span>
                        <ng-template #grillePrice>
                          <span *ngIf="row.grillePrice; else regularPrice">{{ row.grillePrice | number:'1.2-2' }}</span>
                          <ng-template #regularPrice>
                            <span>{{ row.unitPrice | number:'1.2-2' }}</span>
                          </ng-template>
                        </ng-template>
                      </td>
                      <td><input type="number" class="form-control" [(ngModel)]="row.reductionArticle"
                          (input)="calculateTotal(row)" (input)="calculateTotalTva(row)"  (input)="verifProduitFonction(row)" placeholder="r√©duction"></td>
                      <td><input type="number" class="form-control" [(ngModel)]="row.tva"
                            (input)="calculateTotalTva(row)" (input)="verifProduitFonction(row)" placeholder="tva"></td>
                      <td><span class="text-right">{{row.total | number:'1.2-2' }}</span></td>
                      <td><span class="text-right">{{row.totalTTC | number:'1.2-2' }}</span></td>
                      <td *ngIf="!isPreview"><button class="btn btn-danger btnDelete btn-sm" (click)="deleteRow(i)"><i
                            class="bi bi-trash"></i></button></td>
                    </tr>
                    <!-- liste acompte du factute -->
                    <tr *ngFor="let acompte of tabAcompte" class="mt-3">
                      <td colspan="6" >{{ acompte.titreAccomp }} - Facture N¬∞ {{ acompte.num_facture }} (du {{ acompte.dateEcheance }})</td>
                      <td>{{ acompte.montant | number:'1.2-2' }}</td>
                    </tr>
                  </tbody>
                </table>
                <button class="btn " (click)="addRow()" *ngIf="!isPreview"><i class="bi bi-plus-circle me-1"></i> Ajouter une ligne
                </button>
                <div class="row mb-5">
                  <div class="col-4 mt-5">
                    <div class="form-floating">
                      <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px"
                        name="noteFacture" [(ngModel)]="noteFacture"></textarea>
                      <label for="floatingTextarea2">note</label>
                    </div>
                  </div>
                  <div class="col-8">
                    <br>
                    <br>
                    <table class="table table-sm text-right">
                      <tr>
                        <td><strong>Total HT</strong></td>
                        <td class="text-right"> <span class="font-weight-bold">{{ total | number:'1.2-2' }}</span> FCfa</td>
                      </tr>
                      <tr>
                        <td><strong>TVA</strong></td>
                        <td class="text-right"> <span class="font-weight-bold">{{ totalTVA | number:'1.2-2' }}</span> FCfa</td>
                      </tr>
                      <tr>
                        <td><strong>Total TTC</strong></td>
                        <td class="text-right"> <span class="font-weight-bold">{{ totalTTC | number:'1.2-2' }}</span> FCfa</td>
                      </tr>
                      <tr>
                        <td><strong>Remise</strong></td>
                        <input type="number" name="remise" [(ngModel)]="remise" (input)="calculateGrandTotalAvecRemise()">
                      </tr>
                      <tr>
                        <td><strong>Total net √† payer</strong></td>
                        <td class="text-right"> <span class="font-weight-bold">{{ totalRemise | number:'1.2-2' }}</span> FCfa</td>
                      </tr>
                    </table>
                  </div>
                </div>
                <button class="suivant-btn btn mt-3" type="button" [disabled]="!exactData" (click)="showStep('prix')">Suivant ‚ñº</button>
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                  <button class="btn btnClose me-md-2" type="button" (click)="showStep('client')">Pr√©c√©dent ‚ñ≤ </button>
                </div>
              </div>
          </div>
          
          <div class="section">
              <div class="section-title">3. Quand serai-je pay√© ?</div>
              <div class="stepThree" id="prix" *ngIf="currentStep==='prix'">
                <div class="section mx-auto mb-5">
                  <div class="section-content radio-group">
                    <div class="-title">Type de paiement :</div>
                      <label><input type="radio" name="type-paiement" (click)="showComponant('factOne')" value="immediat" [(ngModel)]="typePaiement"> Immediat</label>
                      <label><input type="radio" name="type-paiement" (click)="showComponant('factTwo')" value="echeance" [(ngModel)]="typePaiement"> Une ou plusieurs √©ch√©ances</label>
                      <label><input type="radio" name="type-paiement" (click)="showComponant('factThree')" value="facture_Accompt" [(ngModel)]="typePaiement"> Une ou plusieurs factures d'acompte</label>
                  </div>
                  <div class="section factures" id="factOne" *ngIf="currentContent==='factOne'">
                    <div class="row g-3 align-items-center">
                      <div class="col-auto">
                        <label for="inputPassword6" class="col-form-label">Moyen de paiement</label>
                        <select class="form-select form-select-lg" id="client-select" placeholder="Type de paiement..." [(ngModel)]="moyenPayement">
                          <option *ngFor="let paye of tabPayement" [value]="paye.id">{{paye.nom_payement}}</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="section √âch√©ance text-center w-75 mx-auto p-2" id="factTwo" *ngIf="currentContent==='factTwo'" >
                    <span class="font-weight-bold"> <strong>Total net √† payer</strong>  {{ totalRemise | number:'1.2-2' }}</span> FCfa <br>
                    <div class="row">
                      <ng-container class="mb-2" *ngFor="let item of input; let i = index">
                        <div class="col-2"><label for="echeance1" class="me-1">√âch√©ance {{i+1}}: </label></div>
                        <div class="col-4"><input type="date"  id="echeance1" class="me-2" value="" [(ngModel)]="item.date" ></div>
                        <div class="col-4"><input type="number" id="montant1"  class="me-2" value="" [(ngModel)]="item.prix"> </div>
                        <div class="col-2"><i class="bi bi-x-lg" style="color: red; cursor: pointer;" (click)="deleteInput(i)"></i></div>
                      </ng-container >
                      <span (click)="addInput()" style="cursor: pointer;"><i class="bi bi-plus-circle me-2"></i>ajouter</span>
                    </div>
                  </div>
                  <div class="section factures w-75 mx-auto p-2" id="factThree" *ngIf="currentContent==='factThree'" >
                    <div class="section-title">Factures d'acompte :</div>
                    <table>
                        <tr>
                            <th>Num√©ro</th>
                            <th>Date</th>
                            <th>Montant</th>
                        </tr>
                        <tr *ngFor="let acompte of tabAcompte" class="mt-3">
                          <td>{{ acompte.titreAccomp }} - Facture N¬∞ {{ acompte.num_facture }} (du {{ acompte.dateEcheance }})</td>
                          <td>{{ acompte.dateEcheance }}</td>
                          <td>{{ acompte.montant | number:'1.2-2' }}</td>
                        </tr>
                    </table>
                    <div class="section-content mt-2 mb-2">
                       <!-- Button trigger modal -->
                      <button type="button" class="btn btn-primary " data-bs-toggle="modal" data-bs-target="#echeance">
                        Ajouter Facture d'accompte
                      </button>
                    </div>
                </div>
                </div>
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                  <button class="btn btnClose me-md-2" type="button" (click)="showStep('data')">Pr√©c√©dent ‚ñ≤ </button>
                  <button class="btn btnAction" type="button" [disabled]="!exactData" (click)="createFacture()">Sauvegarder</button>
                </div>
          </div>
      </div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- Modal facture d'avoir -->
<div class="modal fade mt-5" id="FactureAvoir" tabindex="-1" aria-labelledby="FactureAvoirLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="FactureAvoirLabel">Facture Avoir</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="invoice-form containerFacture">
          <div class="headerFacture">
            <div class="date-input">
                <label for="date">Date:&nbsp;</label>
                <input type="date" id="date">
            </div>
            <div class="numero-input">
                <label for="numero">Num√©ro :&nbsp;</label>
                <input type="text" id="numero" name="nextNumber"[(ngModel)]="nextNumber" readonly>&nbsp;
                <i class="bi bi-gear" data-bs-toggle="modal" data-bs-target="#setting"></i>
            </div>
        </div>
        
          <div class="client-section">
            <button class="associate-client" data-bs-toggle="modal" data-bs-target="#client" *ngIf="!currentClient">+ Associer Client</button>

            <div class="client-info"  *ngFor="let clientSelect of currentClient">
              <input type="text" value="{{clientSelect?.prenom_client}} {{clientSelect?.nom_client}}" readonly>
              <div class="client-details">
                <p class="me-3 ms-3">Adresse : {{clientSelect?.adress_client}}</p>
                <p class="me-3 ms-3">T√©l√©phone : {{clientSelect?.tel_client}}</p>
                <p class="me-3 ms-3">Entreprise : {{clientSelect?.nom_entreprise}}</p>
              </div>
            </div>
          </div>
        
          <div class="title-section" data-bs-toggle="modal" data-bs-target="#factureClient" *ngIf="!numeroFacture" >
            <a style="cursor:pointer;">+ Associer une vente de ce client √† cette note de cr√©dit</a>
          </div>

          <div class="factureAssocier mb-5" *ngIf="numeroFacture">
            <input type="text" class="border border-0 mx-auto p-2 ms-3 mt-2" placeholder="Titre">
            <hr>
            <span class="p-2">Note de cr√©dit associ√©e √† la Vente/Facture N¬∞ {{numeroFacture}}</span>
          </div>
        
          <table class="table table-bordered border-light">
            <thead class="thead-custom">
              <tr>
                <th>Description</th>
                <th>Quantit√©</th>
                <th>PU</th>
                <th>R√©duction</th>
                <th>TVA</th>
                <th>Total HT</th>
                <th>Total TTC</th>
                <th *ngIf="!isPreview"></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let article of article" >
                <td>{{article.nom_article}}</td>
                <td>{{article.quantite_article}}</td>
                <td>{{article.prix_unitaire_article}}</td>
                <td>Reemise</td>
                <td>Tva</td>
                <td>{{article.prix_achat}}</td>
                <td>{{article.prix_unitaire_article}}</td>
                <td>{{article.prix_total_tva_article}}</td>
                <td>{{detailFacture.prix_TTC}}</td>
                <td>{{article.quantite_article}}</td>
              </tr>
            </tbody>
          </table>
          <button class="btn " (click)="addRow()" *ngIf="!isPreview"><i class="bi bi-plus-circle me-1"></i> Ajouter une ligne
          </button>
        
          <div class="total-section">
            <span>Total</span>
            <span>{{ totalTTC | number:'1.2-2' }} FCfa</span> 
          </div>
        
          <div class="comment-section">
            <textarea placeholder="Commentaire (affich√© dans la facture) :"></textarea>
            <textarea placeholder="Note interne :"></textarea>
          </div>

          <a style="cursor:pointer;" data-bs-toggle="modal" data-bs-target="#solde"> + Cr√©er un solde en faveur du client correspondant √† cette note de cr√©dit</a>
      
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btnAction">Ajouter</button>
        <button type="button" class="btn btnClose" data-bs-dismiss="modal">Annuler</button>
      </div>
    </div>
  </div>
</div>



<!-- Modal creation D√©vis -->
<div class="modal fade" id="devis" tabindex="-1" aria-labelledby="devisLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered  modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="factureLabel">{{titre}}</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body ">
        <div class="seeFact" data-bs-toggle="modal" data-bs-target="#seeMod√©le">
          <i class="bi bi-eye"></i>
        </div>
        <div class="containerFacture">
          <div class="headerFacture">
            <div class="date-inputs">
              <div class="date-input">
                  <label for="date-devis">Date du devis :</label>
                  <input type="date" id="date-devis" value="05/07/2024">
              </div>
              <div class="date-input">
                  <label for="date-validite">Valable jusqu'au :</label>
                  <input type="date" id="date-validite">
              </div>
          </div>
              <div class="numero-input">
                  <label for="numero">Num√©ro :&nbsp;</label>
                  <input type="text" id="numero" [(ngModel)]="nextNumber" readonly>&nbsp;
                  <i class="bi bi-gear" data-bs-toggle="modal" data-bs-target="#setting"></i>
              </div>
          </div>
          
          <div class="section">
              <div class="section-title">1. √Ä qui je-vends ?</div>
              <label class="checkbox-label">
                  <input type="checkbox">&nbsp; Ne pas associer un client √† cette vente
              </label>
              <div class="input-group mb-5">
                <select class="form-select form-select-lg " id="client-select" [(ngModel)]="selectedClient" (change)="onClientSelected()" (input)="verifClientFonction()">
                  <option *ngFor="let client of tabClient" [value]="client.id">{{client.prenom_client}} {{client.nom_client}}</option>
                </select>
                <button type="button" class="btn ajouter" data-bs-toggle="modal" data-bs-target="#exampleModal">
                  Ajouter un client
                </button>
              </div>
              <button class="suivant-btn btn mt-3" [disabled]="!exactClient" (click)="showStep('data')">Suivant ‚ñº</button>
          </div>
          
          <div class="section">
              <div class="section-title">2. Quels produits / services ?</div>
              <div class="stepTwo" id="data" *ngIf="currentStep==='data'">
                <table class="table table-bordered border-light">
                  <thead class="thead-custom">
                    <tr>
                      <th>Description</th>
                      <th>Quantit√©</th>
                      <th>PU</th>
                      <th>R√©duction</th>
                      <th>TVA</th>
                      <th>Total HT</th>
                      <th>Total TTC</th>
                      <th *ngIf="!isPreview"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let row of rows; let i = index">
                      <td>
                        <div class="input-group mb-2 me-2">
                          <select class="form-control"  [(ngModel)]="row.selectedProduct" (change)="onProductSelect(row)"
                            (change)="listeGrille(row)" (change)="listePriceByArticle(row)" (input)="verifProduitFonction(row)">
                            <option value="0">S√©lectionnez un produit/service</option>
                            <option *ngFor="let product of products" [value]="product.id">{{ product.nom_article }}</option>
                          </select>
                          <div class="dropdown">
                            <button class="btn ajouter text-white dropdown-toggle" type="button" data-bs-toggle="dropdown"
                              aria-expanded="false">Ajouter</button>
                            <ul class="dropdown-menu">
                              <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#produit">Produit</a></li>
                              <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#service">Service</a></li>
                            </ul>
                          </div>
                        </div>
                      </td>
                      <td><input type="number" class="form-control" [(ngModel)]="row.quantity" (input)="calculateTotal(row)"
                          (input)="verifProduitFonction(row)"  (input)="calculateTotalTva(row)" placeholder="Quantit√©"></td>
                      <td>
                        <span *ngIf="row.promotionalPrice; else grillePrice">{{ row.promotionalPrice | number:'1.2-2' }}</span>
                        <ng-template #grillePrice>
                          <span *ngIf="row.grillePrice; else regularPrice">{{ row.grillePrice | number:'1.2-2' }}</span>
                          <ng-template #regularPrice>
                            <span>{{ row.unitPrice | number:'1.2-2' }}</span>
                          </ng-template>
                        </ng-template>
                      </td>
                      <td><input type="number" class="form-control" [(ngModel)]="row.reductionArticle"
                          (input)="calculateTotal(row)" (input)="calculateTotalTva(row)"  (input)="verifProduitFonction(row)" placeholder="r√©duction"></td>
                      <td><input type="number" class="form-control" [(ngModel)]="row.tva"
                            (input)="calculateTotalTva(row)" (input)="verifProduitFonction(row)" placeholder="tva"></td>
                      <td><span class="text-right">{{row.total | number:'1.2-2' }}</span></td>
                      <td><span class="text-right">{{row.totalTTC | number:'1.2-2' }}</span></td>
                      <td *ngIf="!isPreview"><button class="btn btn-danger btnDelete btn-sm" (click)="deleteRow(i)"><i
                            class="bi bi-trash"></i></button></td>
                    </tr>
                  </tbody>
                </table>
                <button class="btn " (click)="addRow()" *ngIf="!isPreview"><i class="bi bi-plus-circle me-1"></i> Ajouter une ligne
                </button>
                <div class="row mb-5">
                  <div class="col-4 mt-5">
                    <div class="form-floating">
                      <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px"
                        name="noteFacture" [(ngModel)]="noteFacture"></textarea>
                      <label for="floatingTextarea2">note</label>
                    </div>
                  </div>
                  <div class="col-8">
                    <br>
                    <br>
                    <table class="table table-sm text-right">
                      <tr>
                        <td><strong>Total HT</strong></td>
                        <td class="text-right"> <span class="font-weight-bold">{{ total | number:'1.2-2' }}</span> FCfa</td>
                      </tr>
                      <tr>
                        <td><strong>TVA</strong></td>
                        <td class="text-right"> <span class="font-weight-bold">{{ totalTVA | number:'1.2-2' }}</span> FCfa</td>
                      </tr>
                      <tr>
                        <td><strong>Total TTC</strong></td>
                        <td class="text-right"> <span class="font-weight-bold">{{ totalTTC | number:'1.2-2' }}</span> FCfa</td>
                      </tr>
                      <tr>
                        <td><strong>Remise</strong></td>
                        <input type="number" name="remise" [(ngModel)]="remise" (input)="calculateGrandTotalAvecRemise()">
                      </tr>
                      <tr>
                        <td><strong>Total net √† payer</strong></td>
                        <td class="text-right"> <span class="font-weight-bold">{{ totalRemise | number:'1.2-2' }}</span> FCfa</td>
                      </tr>
                    </table>
                  </div>
                </div>
                <button class="suivant-btn btn mt-3" type="button" [disabled]="!exactData" (click)="showStep('prix')">Suivant ‚ñº</button>
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                  <button class="btn btnClose me-md-2" type="button" (click)="showStep('client')">Pr√©c√©dent ‚ñ≤ </button>
                </div>
              </div>
          </div>
          
          <div class="section" id="prix" *ngIf="currentStep==='prix'">
            <div class="actions">
              <a href="#">Associer un √©ch√©ancier</a>
              <a href="#">Associer une facture d'acompte</a>
          </div>
          <div class="buttons">
              <button class="btn btn-primary">Valider devis</button>
              <button class="btn btn-success">Transformer en vente</button>
              <button class="btn btn-secondary">Transformer en commande</button>
              <button class="btn btn-Annuler">Annuler ce devis</button>
          </div>
          <button class="btn suivant-btn mt-3" type="button" (click)="showStep('data')">Pr√©c√©dent ‚ñ≤ </button>
      </div>
      </div>
    </div>
  </div>
</div>
</div>