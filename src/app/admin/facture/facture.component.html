<app-navbar></app-navbar>
<app-sidebar></app-sidebar>
<div class="zoneSearch mb-2 mt-4">
  <div class="input-group">
    <input type="search" class="form-control" aria-label="Recipient's username" placeholder="type, numéro,nom,prenom"
      [(ngModel)]="filterValue" (input)="onSearch()">
    <button class="btn btnSearch" type="button" id="button-addon2"><i class="bi bi-search"></i></button>
  </div>
  <div class="d-flex filtre">
    <button type="button" class="btn btnOutline">Sauf annulées</button>
    <button type="button" class="btn btnOutline">Brouillon</button>
    <button type="button" class="btn btnOutline">Payées</button>
    <button type="button" class="btn btnOutline">Impayées</button>
    <button type="button" class="btn btnOutline">Paiements à venir</button>
    <button type="button" class="btn btnOutline">Notes de crédit</button>
    <button type="button" class="btn btnOutline">Annulées</button>		
    <button type="button" class="btn btnOutline">Etiquette</button>
  </div>
</div>


<!-- Contenu dashbord  -->
<div class="mb-5">
  <div class="contenu">
    <div class="header d-grid gap-2 d-md-flex justify-content-md-end">
      <ul class="nav">
        <li><a [ngClass]="{'currentItemNav': boutonActif === 1}" (click)="showTypeDocument('Facture')"
            (click)="boutonActif = 1" (click)="listeFacture()">Ventes</a></li>
        <li><a [ngClass]="{'currentItemNav': boutonActif === 2}" (click)="showTypeDocument('Devis')"
            (click)="boutonActif = 2" (click)="listeDevis()">Devis</a></li>
        <li><a [ngClass]="{'currentItemNav': boutonActif === 3}" (click)="showTypeDocument('Bon de commande')"
            (click)="boutonActif = 3" (click)=" listeBonCommande()">Bon de commande</a></li>
        <li><a [ngClass]="{'currentItemNav': boutonActif === 4}" (click)="showTypeDocument('Bon de Livraison')"
            (click)="boutonActif = 4" (click)=" listeBonLivraison()">Bon de Livraison</a></li>
        <!-- <li><a  [ngClass]="{'currentItemNav': boutonActif === 5}" (click)="showTypeDocument('Bon d&#x2019;achat')" (click)="boutonActif = 5">Bon d'achat</a></li> -->
      </ul>
    </div>
    <div class="paramPagination d-flex justify-content-end  mb-2" data-bs-toggle="modal" data-bs-target="#pagination"><i class="bi bi-gear"></i></div>
    <!-- Tableau Facture -->
    <div class="col-md-12" id="Facture" *ngIf="currentDoc==='Facture'">
      <div class="card mb-4 px-2 py-2 pt-4 rounded-4">
        <div class="me-5 mb-2 d-md-flex justify-content-md-end">
          <div class="btn-group ajouterVente">
            <button type="button" class="btn text-light" data-bs-toggle="modal" data-bs-target="#facture"
              (click)="removeLocalStorage()">Ajouter vente</button>
            <button type="button" class="btn ajouter dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown"
              aria-expanded="false">
              <span class="visually-hidden">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li>
                <a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#FactureAvoir">Facture Avoir</a>
                <a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#FactureRecurrente"
                  (click)="removeLocalStorage()">Facture recurrente</a>
              </li>
            </ul>
          </div>
        </div>



        <div class="row sectionEspace ligneReseauSearch mb-3">
          <div class="col-md-5">
            <h3 class="fw-bold">Listes Facture</h3>
          </div>

        </div>

        <!-- Le tableau des factures -->
        <!-- tout -->
        <div class="table-responsive" id="tout" *ngIf="currentfactureType==='tout'">
          <table class="table table-hover mb-4">
            <thead class="mb-2">
              <tr>
                <th scope="col">Numéro </th>
                <th scope="col">Date Facture </th>
                <th scope="col">Type Facture </th>
                <th scope="col">Client </th>
                <th scope="col">TotalHT </th>
                <th scope="col">TotalTTC </th>
                <th scope="col">Statut </th>
                <th scope="col">Action </th>
              </tr>
            </thead>
            <tbody *ngFor="let facture of  getItemsPage()">
              <tr data-bs-toggle="modal" data-bs-target="#detailFacture"
              (click)="details(facture.numero)">
                <td>{{facture.numero}}</td>
                <td>{{facture.date}}</td>
                <td>{{facture.type_facture}}</td>
                <td>{{facture.prenom_client}} {{facture.nom_client}}</td>
                <td>{{facture.prix_HT}}</td>
                <td>{{facture.prix_TTC}}</td>
                <td>{{facture.statut_paiement}}</td>
                <td>
                  <i class="bi bi-eye me-2" title="details" data-bs-toggle="modal" data-bs-target="#detailFacture"
                    (click)="details(facture.numero)"></i>
                  <i class="bi bi-trash3" title="Supprimer" (click)="supprimerFacture(facture.numero)"></i>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination  -->
        <div *ngIf="getItemsPage().length">
          <div class="d-flex justify-content-end mb-2">
            <button class="border border-0 btnColor  mx-2" [disabled]="pageActuelle === 1"
              (click)="pageActuelle = pageActuelle - 1">
              <i class="bi bi-arrow-left-circle fs-4"></i>
            </button>
            <button class=" rounded-circle mx-2 page" *ngFor="let page of pages" (click)="pageActuelle = page">
              <span class="pageActuelle fs-5" *ngIf="page===pageActuelle">{{page}}</span>
              <span *ngIf="page != pageActuelle">{{page}}</span>
            </button>
            <button class="border border-0 btnColor mx-2" [disabled]="pageActuelle === totalPages"
              (click)="pageActuelle = pageActuelle + 1">
              <i class="bi bi-arrow-right-circle fs-4"></i>
            </button>
          </div>
        </div>
      </div>
      <!-- btn exporter vente -->
      <div (click)="exportExcel()" class="mt-5">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0,0,256,256"
          width="30px" height="30px">
          <g fill-opacity="0.32941" fill="#000000" fill-rule="nonzero" stroke="none" stroke-width="1"
            stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray=""
            stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none"
            style="mix-blend-mode: normal">
            <g transform="scale(5.12,5.12)">
              <path
                d="M28.875,0c-0.01953,0.00781 -0.04297,0.01953 -0.0625,0.03125l-28,5.3125c-0.47656,0.08984 -0.82031,0.51172 -0.8125,1v37.3125c-0.00781,0.48828 0.33594,0.91016 0.8125,1l28,5.3125c0.28906,0.05469 0.58984,-0.01953 0.82031,-0.20703c0.22656,-0.1875 0.36328,-0.46484 0.36719,-0.76172v-5h17c1.09375,0 2,-0.90625 2,-2v-34c0,-1.09375 -0.90625,-2 -2,-2h-17v-5c0.00391,-0.28906 -0.12109,-0.5625 -0.33594,-0.75391c-0.21484,-0.19141 -0.50391,-0.28125 -0.78906,-0.24609zM28,2.1875v4.34375c-0.13281,0.27734 -0.13281,0.59766 0,0.875v35.40625c-0.02734,0.13281 -0.02734,0.27344 0,0.40625v4.59375l-26,-4.96875v-35.6875zM30,8h17v34h-17v-5h4v-2h-4v-6h4v-2h-4v-5h4v-2h-4v-5h4v-2h-4zM36,13v2h8v-2zM6.6875,15.6875l5.46875,9.34375l-5.96875,9.34375h5l3.25,-6.03125c0.22656,-0.58203 0.375,-1.02734 0.4375,-1.3125h0.03125c0.12891,0.60938 0.25391,1.02344 0.375,1.25l3.25,6.09375h4.96875l-5.75,-9.4375l5.59375,-9.25h-4.6875l-2.96875,5.53125c-0.28516,0.72266 -0.48828,1.29297 -0.59375,1.65625h-0.03125c-0.16406,-0.60937 -0.35156,-1.15234 -0.5625,-1.59375l-2.6875,-5.59375zM36,20v2h8v-2zM36,27v2h8v-2zM36,35v2h8v-2z">
              </path>
            </g>
          </g>
        </svg>
      </div>
    </div>
    <!-- Tableau Dévis -->
    <div class="col-md-12" id="Devis" *ngIf="currentDoc==='Devis'">
      <div class="card mb-4 px-2 py-2 pt-4 rounded-4">
        <div class="d-grid gap-2  mb-4 d-md-flex justify-content-md-end">
          <button type="button" class="btn ajouter mb-2" data-bs-toggle="modal" data-bs-target="#devis"
          (click)="removeLocalStorage()">
          Ajouter Dévis
        </button>
        </div>
        <div class="row sectionEspace ligneReseauSearch mb-3">
          <div class="col-md-5">
            <h3 class="fw-bold">Listes Dévis</h3>
          </div>
          <div class="col-md-7">
          </div>
        </div>

        <!-- Le tableau des dévis -->
        <div class="table-responsive">
          <table class="table table-hover mb-4">
            <thead class="mb-2">
              <tr>
                <th scope="col">Numéro </th>
                <th scope="col">Date limite </th>
                <th scope="col">Client </th>
                <th scope="col">TotalHT </th>
                <th scope="col">TotalTTC </th>
                <th scope="col">Statut </th>
                <th scope="col">Action </th>
              </tr>
            </thead>
            <tbody *ngFor="let devi of  getItemsPage()">
              <tr (click)="detailDevis(devi.id)" data-bs-toggle="modal"
              data-bs-target="#detailDevis">
                <td>{{devi.num_devi}}</td>
                <td>{{devi.date_limite}}</td>
                <td>{{devi.prenom_client}} {{devi.nom_client}}</td>
                <td>{{devi.prix_Ht}}</td>
                <td>{{devi.prix_Ttc}}</td>
                <td>{{devi.statut_devi}}</td>
                <td>
                  <i class="bi bi-eye me-2" title="details" (click)="detailDevis(devi.id)" data-bs-toggle="modal"
                    data-bs-target="#detailDevis"></i>
                  <i class="bi bi-trash3" title="Supprimer" (click)="deletedevis(devi.id)"></i>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination  -->
        <div *ngIf="getItemsPage().length">
          <div class="d-flex justify-content-end mb-2">
            <button class="border border-0 btnColor  mx-2" [disabled]="pageActuelle === 1"
              (click)="pageActuelle = pageActuelle - 1">
              <i class="bi bi-arrow-left-circle fs-4"></i>
            </button>
            <button class=" rounded-circle mx-2 page" *ngFor="let page of pages" (click)="pageActuelle = page">
              <span class="pageActuelle fs-5" *ngIf="page===pageActuelle">{{page}}</span>
              <span *ngIf="page != pageActuelle">{{page}}</span>
            </button>
            <button class="border border-0 btnColor mx-2" [disabled]="pageActuelle === totalPages"
              (click)="pageActuelle = pageActuelle + 1">
              <i class="bi bi-arrow-right-circle fs-4"></i>
            </button>
          </div>
        </div>
      </div>
      <!-- btn exporter devis -->
      <div (click)="exportDeviExcel()" class="mt-5">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0,0,256,256"
          width="30px" height="30px">
          <g fill-opacity="0.32941" fill="#000000" fill-rule="nonzero" stroke="none" stroke-width="1"
            stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray=""
            stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none"
            style="mix-blend-mode: normal">
            <g transform="scale(5.12,5.12)">
              <path
                d="M28.875,0c-0.01953,0.00781 -0.04297,0.01953 -0.0625,0.03125l-28,5.3125c-0.47656,0.08984 -0.82031,0.51172 -0.8125,1v37.3125c-0.00781,0.48828 0.33594,0.91016 0.8125,1l28,5.3125c0.28906,0.05469 0.58984,-0.01953 0.82031,-0.20703c0.22656,-0.1875 0.36328,-0.46484 0.36719,-0.76172v-5h17c1.09375,0 2,-0.90625 2,-2v-34c0,-1.09375 -0.90625,-2 -2,-2h-17v-5c0.00391,-0.28906 -0.12109,-0.5625 -0.33594,-0.75391c-0.21484,-0.19141 -0.50391,-0.28125 -0.78906,-0.24609zM28,2.1875v4.34375c-0.13281,0.27734 -0.13281,0.59766 0,0.875v35.40625c-0.02734,0.13281 -0.02734,0.27344 0,0.40625v4.59375l-26,-4.96875v-35.6875zM30,8h17v34h-17v-5h4v-2h-4v-6h4v-2h-4v-5h4v-2h-4v-5h4v-2h-4zM36,13v2h8v-2zM6.6875,15.6875l5.46875,9.34375l-5.96875,9.34375h5l3.25,-6.03125c0.22656,-0.58203 0.375,-1.02734 0.4375,-1.3125h0.03125c0.12891,0.60938 0.25391,1.02344 0.375,1.25l3.25,6.09375h4.96875l-5.75,-9.4375l5.59375,-9.25h-4.6875l-2.96875,5.53125c-0.28516,0.72266 -0.48828,1.29297 -0.59375,1.65625h-0.03125c-0.16406,-0.60937 -0.35156,-1.15234 -0.5625,-1.59375l-2.6875,-5.59375zM36,20v2h8v-2zM36,27v2h8v-2zM36,35v2h8v-2z">
              </path>
            </g>
          </g>
        </svg>
      </div>
    </div>
    <!-- Tableau Bon Commande -->
    <div class="col-md-12" id="Bon de commande" *ngIf="currentDoc==='Bon de commande'">
      <div class="card mb-4 px-2 py-2 pt-4 rounded-4">
        <div  class="d-grid gap-2 mb-2 d-md-flex justify-content-md-end">
          <button type="button" class="btn ajouter mb-2" data-bs-toggle="modal"
          data-bs-target="#bonCommande">
          Ajouter Bon de commande
        </button>
        </div>
       
        <div class="row sectionEspace ligneReseauSearch mb-3">
          <div class="col-md-5">
            <h3 class="fw-bold">Listes Bon de commande</h3>
          </div>
          <div class="col-md-7">
          </div>
        </div>

        <!-- Le tableau des dévis -->
        <div class="table-responsive">
          <table class="table table-hover mb-4">
            <thead class="mb-2">
              <tr>
                <th scope="col">Numéro </th>
                <th scope="col">Date création </th>
                <th scope="col">Type limite </th>
                <th scope="col">Client </th>
                <th scope="col">TotalHT </th>
                <th scope="col">TotalTTC </th>
                <th scope="col">Statut </th>
                <th scope="col">Action </th>
              </tr>
            </thead>
            <tbody *ngFor="let bonCommande of  getItemsPage()">
              <tr data-bs-toggle="modal" data-bs-target="#detailbonCommande" (click)="detailBonCommande(bonCommande.id)">
                <td>{{bonCommande.num_BonCommande}}</td>
                <td>{{bonCommande.date_BonCommande}}</td>
                <td>{{bonCommande.date_limite}}</td>
                <td>{{bonCommande.prenom_client}} {{bonCommande.nom_client}}</td>
                <td>{{bonCommande.prix_Ht}}</td>
                <td>{{bonCommande.prix_Ttc}}</td>
                <td>{{bonCommande.statut_BonCommande}}</td>
                <td>
                  <i class="bi bi-eye me-2" title="details" (click)="detailBonCommande(bonCommande.id)"
                    data-bs-toggle="modal" data-bs-target="#detailCommande"></i>
                  <i class="bi bi-trash3" title="Supprimer" (click)="deleteBonCommande(bonCommande.id)"></i>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination  -->
        <div *ngIf="getItemsPage().length">
          <div class="d-flex justify-content-end mb-2">
            <button class="border border-0 btnColor  mx-2" [disabled]="pageActuelle === 1"
              (click)="pageActuelle = pageActuelle - 1">
              <i class="bi bi-arrow-left-circle fs-4"></i>
            </button>
            <button class=" rounded-circle mx-2 page" *ngFor="let page of pages" (click)="pageActuelle = page">
              <span class="pageActuelle fs-5" *ngIf="page===pageActuelle">{{page}}</span>
              <span *ngIf="page != pageActuelle">{{page}}</span>
            </button>
            <button class="border border-0 btnColor mx-2" [disabled]="pageActuelle === totalPages"
              (click)="pageActuelle = pageActuelle + 1">
              <i class="bi bi-arrow-right-circle fs-4"></i>
            </button>
          </div>
        </div>
      </div>
      <!-- btn exporter bon de commande -->
      <div (click)="exportBonCommandeExcel()" class="mt-5">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0,0,256,256"
          width="30px" height="30px">
          <g fill-opacity="0.32941" fill="#000000" fill-rule="nonzero" stroke="none" stroke-width="1"
            stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray=""
            stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none"
            style="mix-blend-mode: normal">
            <g transform="scale(5.12,5.12)">
              <path
                d="M28.875,0c-0.01953,0.00781 -0.04297,0.01953 -0.0625,0.03125l-28,5.3125c-0.47656,0.08984 -0.82031,0.51172 -0.8125,1v37.3125c-0.00781,0.48828 0.33594,0.91016 0.8125,1l28,5.3125c0.28906,0.05469 0.58984,-0.01953 0.82031,-0.20703c0.22656,-0.1875 0.36328,-0.46484 0.36719,-0.76172v-5h17c1.09375,0 2,-0.90625 2,-2v-34c0,-1.09375 -0.90625,-2 -2,-2h-17v-5c0.00391,-0.28906 -0.12109,-0.5625 -0.33594,-0.75391c-0.21484,-0.19141 -0.50391,-0.28125 -0.78906,-0.24609zM28,2.1875v4.34375c-0.13281,0.27734 -0.13281,0.59766 0,0.875v35.40625c-0.02734,0.13281 -0.02734,0.27344 0,0.40625v4.59375l-26,-4.96875v-35.6875zM30,8h17v34h-17v-5h4v-2h-4v-6h4v-2h-4v-5h4v-2h-4v-5h4v-2h-4zM36,13v2h8v-2zM6.6875,15.6875l5.46875,9.34375l-5.96875,9.34375h5l3.25,-6.03125c0.22656,-0.58203 0.375,-1.02734 0.4375,-1.3125h0.03125c0.12891,0.60938 0.25391,1.02344 0.375,1.25l3.25,6.09375h4.96875l-5.75,-9.4375l5.59375,-9.25h-4.6875l-2.96875,5.53125c-0.28516,0.72266 -0.48828,1.29297 -0.59375,1.65625h-0.03125c-0.16406,-0.60937 -0.35156,-1.15234 -0.5625,-1.59375l-2.6875,-5.59375zM36,20v2h8v-2zM36,27v2h8v-2zM36,35v2h8v-2z">
              </path>
            </g>
          </g>
        </svg>
      </div>
    </div>
    <!-- Tableau Bon de livraison -->
    <div class="col-md-12" id="Bon de Livraison" *ngIf="currentDoc==='Bon de Livraison'">
      <div class="card mb-4 px-2 py-2 pt-4 rounded-4">
        <div class="d-grid gap-2  mb-4 d-md-flex justify-content-md-end">
          <button type="button" class="btn ajouter mb-2" data-bs-toggle="modal"
          data-bs-target="#livraison">
          Ajouter Bon de Livraison
        </button>
        </div>
       
        <div class="row sectionEspace ligneReseauSearch mb-3">
          <div class="col-md-5">
            <h3 class="fw-bold">Listes Bon de Livraison</h3>
          </div>
          <div class="col-md-7">
          </div>
        </div>

        <!-- Le tableau des Bon de livraison -->
        <div class="table-responsive">
          <table class="table table-hover mb-4">
            <thead class="mb-2">
              <tr>
                <th scope="col">Numéro </th>
                <th scope="col">Date Livraison </th>
                <th scope="col">Client </th>
                <th scope="col">TotalHT </th>
                <th scope="col">TotalTTC </th>
                <th scope="col">Statut </th>
                <th scope="col">Action </th>
              </tr>
            </thead>
            <tbody *ngFor="let livraison of  getItemsPage()">
              <tr data-bs-toggle="modal" data-bs-target="#detailBL"
              (click)="detailLivraison(livraison.id)">
                <td>{{livraison.num_livraison}}</td>
                <td>{{livraison.date_livraison}}</td>
                <td>{{livraison.prenom_client}} {{livraison.nom_client}}</td>
                <td>{{livraison.prix_Ht}}</td>
                <td>{{livraison.prix_Ttc}}</td>
                <td>{{livraison.statut_livraison}}</td>
                <td>
                  <i class="bi bi-eye me-2" title="details" data-bs-toggle="modal" data-bs-target="#detailBL"
                    (click)="detailLivraison(livraison.id)"></i>
                  <i class="bi bi-trash3" title="Supprimer" (click)="deleteBonLivraison(livraison.id)"></i>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination  -->
        <div *ngIf="getItemsPage().length">
          <div class="d-flex justify-content-end mb-2">
            <button class="border border-0 btnColor  mx-2" [disabled]="pageActuelle === 1"
              (click)="pageActuelle = pageActuelle - 1">
              <i class="bi bi-arrow-left-circle fs-4"></i>
            </button>
            <button class=" rounded-circle mx-2 page" *ngFor="let page of pages" (click)="pageActuelle = page">
              <span class="pageActuelle fs-5" *ngIf="page===pageActuelle">{{page}}</span>
              <span *ngIf="page != pageActuelle">{{page}}</span>
            </button>
            <button class="border border-0 btnColor mx-2" [disabled]="pageActuelle === totalPages"
              (click)="pageActuelle = pageActuelle + 1">
              <i class="bi bi-arrow-right-circle fs-4"></i>
            </button>
          </div>
        </div>
      </div>
      <!-- btn exporter bon de livraison -->
      <div (click)="exportBonLivraisonExcel()" class="mt-5">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0,0,256,256"
          width="30px" height="30px">
          <g fill-opacity="0.32941" fill="#000000" fill-rule="nonzero" stroke="none" stroke-width="1"
            stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray=""
            stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none"
            style="mix-blend-mode: normal">
            <g transform="scale(5.12,5.12)">
              <path
                d="M28.875,0c-0.01953,0.00781 -0.04297,0.01953 -0.0625,0.03125l-28,5.3125c-0.47656,0.08984 -0.82031,0.51172 -0.8125,1v37.3125c-0.00781,0.48828 0.33594,0.91016 0.8125,1l28,5.3125c0.28906,0.05469 0.58984,-0.01953 0.82031,-0.20703c0.22656,-0.1875 0.36328,-0.46484 0.36719,-0.76172v-5h17c1.09375,0 2,-0.90625 2,-2v-34c0,-1.09375 -0.90625,-2 -2,-2h-17v-5c0.00391,-0.28906 -0.12109,-0.5625 -0.33594,-0.75391c-0.21484,-0.19141 -0.50391,-0.28125 -0.78906,-0.24609zM28,2.1875v4.34375c-0.13281,0.27734 -0.13281,0.59766 0,0.875v35.40625c-0.02734,0.13281 -0.02734,0.27344 0,0.40625v4.59375l-26,-4.96875v-35.6875zM30,8h17v34h-17v-5h4v-2h-4v-6h4v-2h-4v-5h4v-2h-4v-5h4v-2h-4zM36,13v2h8v-2zM6.6875,15.6875l5.46875,9.34375l-5.96875,9.34375h5l3.25,-6.03125c0.22656,-0.58203 0.375,-1.02734 0.4375,-1.3125h0.03125c0.12891,0.60938 0.25391,1.02344 0.375,1.25l3.25,6.09375h4.96875l-5.75,-9.4375l5.59375,-9.25h-4.6875l-2.96875,5.53125c-0.28516,0.72266 -0.48828,1.29297 -0.59375,1.65625h-0.03125c-0.16406,-0.60937 -0.35156,-1.15234 -0.5625,-1.59375l-2.6875,-5.59375zM36,20v2h8v-2zM36,27v2h8v-2zM36,35v2h8v-2z">
              </path>
            </g>
          </g>
        </svg>
      </div>
    </div>
  </div>
</div>

<!-- les modals -->

<!-- Modal associer étiquette  -->
<div class="modal fade mt-5" id="etiquette" tabindex="-1" aria-labelledby="etiquetteLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-flex">
        <div class="p-3 flex-grow-1">
          <h3 class="modal-title" id="etiquetteLabel">Associer étiquette</h3>
        </div>
        <div class="p-3"> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            (click)="ouvrirModalArticle()"></button>
        </div>
      </div>
      <div class="modal-body">
        <div>
          <div class="couleurs">
            <div *ngFor="let couleur of couleurs" [ngStyle]="{'background-color': couleur}"
              (click)="selectionnerCouleur(couleur)" [class.selected]="couleur === etiquette.couleur" class="couleur">
              <span *ngIf="couleur === etiquette.couleur" class="checkmark">✔</span>
            </div>
          </div>

          <div class="mb-3">
            <label for="nom">Nom de l'étiquette :</label>
            <input class="form-control" type="text" placeholder="non étiquette" id="nom" [(ngModel)]="etiquette.nom"
              name="nom">
          </div>

          <button class=" btn btnAction" data-bs-toggle="modal" data-bs-target="#exampleModal"
            (click)="ajouterEtiquette()">Sauvegarder</button>

          <div *ngIf="etiquettes.length > 0" class="etiquettes">
            <h3>Étiquettes Ajoutées :</h3>
            <div *ngFor="let etiq of etiquettes" [ngStyle]="{'background-color': etiq.couleur}" class="etiquette">
              {{ etiq.nom }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

 <!-- Modal configuration pagination -->
 <div class="modal fade mt-5" id="pagination" tabindex="-1" aria-labelledby="paginationLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content mt-5">
        <div class="d-flex">
          <div class="p-3 flex-grow-1">
            <h3 class="modal-title" id="paginationLabel">Configuration pagination</h3>
          </div>
          <div class="p-3"> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
        </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="exampleFormControlInput1" class="form-label">Résultats / page : </label>
          <select [(ngModel)]="itemsParPage">
            <option value="3"  name="itemsParPage" class="form-control">3</option>
            <option value="5"  name="itemsParPage" class="form-control">5</option>
            <option value="7"  name="itemsParPage" class="form-control">7</option>
          </select>
        </div>
        <button class="btn btnAction d-flex justify-content-start" (click)="changeValue()">Sauvegarder</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal modélé document -->
<div class="modal fade mt-5" id="seeModéle" tabindex="-1" aria-labelledby="seeModéleLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body container">
        <div class="imprimFact">
          <i class="bi bi-printer"></i>
        </div>
        <div class="pdfFact" (click)="generatePdf('print-section-create')">
          <i class="bi bi-file-earmark-pdf"></i>
        </div>
        <div class="colorModéle">
          <input type="color" class="form-control form-control-color " [(ngModel)]="color" (input)="onColorChange()">
        </div>
        <div class="card px-4 py-2 pt-4 shadow rounded-4 container" id="print-section-create">
          <div class="invoice container">
            <div class="row">
              <div class="col-6" *ngIf="InfoSup">
                <!-- <img src="http://127.0.0.1:8000{{InfoSup.logo}}" class="logo" style="width: 125px; height: 125px;"> -->
                <table>
                  <thead class="thead-custom">
                    <tr>
                      <th> Informations entreprise</th>
                    </tr>
                  </thead>
                  <tbody class="bg-secondary text-dark p-5 bg-opacity-25">
                    <p class="me-3 ms-3">Nom de l'entreprise : {{ InfoSup.nom_entreprise }} </p>
                    <p class="me-3 ms-3">Adresse : {{ InfoSup.adress_entreprise}}</p>
                    <p class="me-3 ms-3">Téléphone : {{ InfoSup.tel_entreprise }}</p>
                  </tbody>
                </table>

                <h4>{{ currentDate }}</h4>

              </div>
              <div class="col-6">
                <div class="invoice-number">
                  <h2>{{titre}}</h2>
                  <p class="fw-bold fs-5 row">
                    <label class="col-3">Numéro: </label>
                    <input type="text" id="numero" class="border border-0 col-4" [(ngModel)]="nextNumber"
                      readonly>&nbsp;
                  </p>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-7">
              </div>
              <div class="col-5">
                <table>
                  <thead class="">
                    <tr>
                      <th> Informations client</th>
                    </tr>
                  </thead>
                  <tbody class="bg-secondary text-dark p-5 bg-opacity-25" *ngFor="let clientSelect of currentClient">
                    <p class="me-3 ms-3">Nom : {{clientSelect?.prenom_client}} {{clientSelect?.nom_client}}</p>
                    <p class="me-3 ms-3">Adresse : {{clientSelect?.adress_client}}</p>
                    <p class="me-3 ms-3">Téléphone : {{clientSelect?.tel_client}}</p>
                    <p class="me-3 ms-3">Entreprise : {{clientSelect?.nom_entreprise}}</p>
                  </tbody>
                </table>
              </div>
            </div>
            <br>
            <br>
            <br>
            <table class="table table-bordered">
              <thead class="thead-custom">
                <tr>
                  <th>Description</th>
                  <th>Quantité</th>
                  <th>PU</th>
                  <th>Réduction</th>
                  <th>TVA</th>
                  <th>Total HT</th>
                  <th>Total TTC</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let row of rows; let i = index">
                  <td>
                    <div class="input-group mb-2 me-2">
                      <select class="form-control border border-0" [(ngModel)]="row.selectedProduct"
                        (change)="onProductSelect(row)" (change)="listeGrille(row)" (change)="listePriceByArticle(row)"
                        (input)="verifProduitFonction(row)">
                        <option value="0">Sélectionnez un produit/service</option>
                        <option *ngFor="let product of products" [value]="product.id">{{ product.nom_article }}</option>
                      </select>
                    </div>
                  </td>
                  <td><input class="border border-0" [(ngModel)]="row.quantity" (input)="calculateTotal(row)"
                      (input)="verifProduitFonction(row)" (input)="calculateTotalTva(row)" placeholder="Quantité"></td>
                  <td>
                    <span *ngIf="row.promotionalPrice; else grillePrice">{{ row.promotionalPrice | number:'1.2-2'
                      }}</span>
                    <ng-template #grillePrice>
                      <span *ngIf="row.grillePrice; else regularPrice">{{ row.grillePrice | number:'1.2-2' }}</span>
                      <ng-template #regularPrice>
                        <span>{{ row.unitPrice | number:'1.2-2' }}</span>
                      </ng-template>
                    </ng-template>
                  </td>
                  <td><input class="border border-0" [(ngModel)]="row.reductionArticle" (input)="calculateTotal(row)"
                      (input)="calculateTotalTva(row)" (input)="verifProduitFonction(row)" placeholder="réduction"></td>
                  <td><input class="border border-0" [(ngModel)]="row.tva" (input)="calculateTotalTva(row)"
                      (input)="verifProduitFonction(row)" placeholder="tva"></td>
                  <td><span class="text-right">{{row.total | number:'1.2-2' }}</span></td>
                  <td><span class="text-right">{{row.totalTTC | number:'1.2-2' }}</span></td>
                </tr>
              </tbody>
            </table>
            <div class="row">
              <div class="col-6 mt-5">
                <ng-container *ngIf="naturefacture==='echeance'">
                  <h2>Échéances</h2>
                  <table>
                    <thead>
                      <tr>
                        <th>Prévue le :</th>
                        <th>Montant :</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let item of input; let i = index">
                        <td><input type="date" class="border border-0" id="echeance1" [(ngModel)]="item.date"></td>
                        <td><input type="number" class="border border-0" id="montant1" [(ngModel)]="item.prix"></td>
                      </tr>
                    </tbody>
                  </table>
                </ng-container>

              </div>
              <div class="col-6">
                <br>
                <br>
                <table class="table table-sm text-right">
                  <tr>
                    <td><strong>Total HT</strong></td>
                    <td class="text-right"> <span class="font-weight-bold">{{ total | number:'1.2-2' }}</span> FCfa</td>
                  </tr>
                  <tr>
                    <td><strong>TVA</strong></td>
                    <td class="text-right"> <span class="font-weight-bold">{{ totalTVA | number:'1.2-2' }}</span> FCfa
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Total TTC</strong></td>
                    <td class="text-right"> <span class="font-weight-bold">{{ totalTTC | number:'1.2-2' }}</span> FCfa
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Remise</strong></td>
                    <input class="border border-0" name="remise" [(ngModel)]="remise"
                      (input)="calculateGrandTotalAvecRemise()">
                  </tr>
                  <tr>
                    <td><strong>Total net à payer</strong></td>
                    <td class="text-right"> <span class="font-weight-bold">{{ totalRemise | number:'1.2-2' }}</span>
                      FCfa</td>
                  </tr>
                </table>
              </div>
            </div>
            <div class="row" *ngIf="naturefacture==='facture_Accompt'">
              <table class="table table-bordered">
                <thead class="thead-custom">
                  <tr>
                    <th>Facture Acompte</th>
                    <th>Total</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let acompte of tabAcompte">
                    <td>{{ acompte.titreAccomp }} - Facture N° {{ acompte.num_facture }} (du {{ acompte.dateEcheance }})
                    </td>
                    <td>{{ acompte.montant | number:'1.2-2' }}</td>
                  </tr>
                </tbody>
              </table>
              <p class="total mt-2">Solde: {{totalRemise}}XOF</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal configuration numéro -->
<div class="modal fade mt-5" id="setting" tabindex="-1" aria-labelledby="settingLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="config">
          <h1>Configurer numérotation automatique de ventes</h1>

          <div class="option">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="" id="flexCheckIndeterminate" checked>
              <label class="form-check-label" for="flexCheckIndeterminate">
                Champ numéro modifiable
              </label>
            </div>
          </div>


          <div class="form-check ">
            <input class="form-check-input" type="radio" name="flexRadioDefault" value="par_defaut"
              [(ngModel)]="numerotation" id="flexRadioDefault1" (click)="showNumConfig('sansPrefixes')" checked>
            <label class="form-check-label" for="flexRadioDefault1">
              Numérotation par défaut (incrémentée de façon alphanumérique)
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" value="avec_prefixe"
              [(ngModel)]="numerotation" id="flexRadioDefault2" (click)="showNumConfig('avecPrefixes')">
            <label class="form-check-label" for="flexRadioDefault2">
              Numérotation avec préfixe
            </label>
          </div>

          <div class="option" id="avecPrefixes" *ngIf="currentNumConfig==='avecPrefixes'">
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="custom" (change)="updatePrefix()">
                Préfixe personnalisé :
                <input type="text" [disabled]="selectedPrefix !== 'custom'" [(ngModel)]="customPrefix"
                  (ngModelChange)="updatePrefix()">
              </label>
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="annee" (change)="updatePrefix()">
                Préfixe avec l'année en cours
              </label>
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="annee_mois"
                  (change)="updatePrefix()">
                Préfixe avec l'année et le mois en cours
              </label>
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="annee_mois_jour"
                  (change)="updatePrefix()">
                Préfixe avec l'année, le mois et le jour en cours
              </label>
            </div>
            <div class="next-number">
              <label>Prochain numéro :</label>
              <input type="text" name="nextNumber" [(ngModel)]="nextNumber" readonly>
            </div>
          </div>

          <div id="sansPrefixes" *ngIf="currentNumConfig==='sansPrefixes'">
            <div class="next-number">
              <label>Prochain numéro :</label>
              <input type="text" [(ngModel)]="nextNumber" readonly>
            </div>
          </div>


          <button class="save-btn" data-bs-toggle="modal" data-bs-target="#facture"
            (click)="configurationNumero()">Sauvegarder</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal configuration numéro Dévis -->
<div class="modal fade mt-5" id="settingDevis" tabindex="-1" aria-labelledby="settingLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="config">
          <h1>Configurer numérotation automatique de ventes</h1>

          <div class="option">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="" id="flexCheckIndeterminate" checked>
              <label class="form-check-label" for="flexCheckIndeterminate">
                Champ numéro modifiable
              </label>
            </div>
          </div>


          <div class="form-check ">
            <input class="form-check-input" type="radio" name="flexRadioDefault" value="par_defaut"
              [(ngModel)]="numerotation" id="flexRadioDefault1" (click)="showNumConfig('sansPrefixes')" checked>
            <label class="form-check-label" for="flexRadioDefault1">
              Numérotation par défaut (incrémentée de façon alphanumérique)
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" value="avec_prefixe"
              [(ngModel)]="numerotation" id="flexRadioDefault2" (click)="showNumConfig('avecPrefixes')">
            <label class="form-check-label" for="flexRadioDefault2">
              Numérotation avec préfixe
            </label>
          </div>

          <div class="option" id="avecPrefixes" *ngIf="currentNumConfig==='avecPrefixes'">
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="custom" (change)="updatePrefix()">
                Préfixe personnalisé :
                <input type="text" [disabled]="selectedPrefix !== 'custom'" [(ngModel)]="customPrefix"
                  (ngModelChange)="updatePrefix()">
              </label>
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="annee" (change)="updatePrefix()">
                Préfixe avec l'année en cours
              </label>
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="annee_mois"
                  (change)="updatePrefix()">
                Préfixe avec l'année et le mois en cours
              </label>
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="annee_mois_jour"
                  (change)="updatePrefix()">
                Préfixe avec l'année, le mois et le jour en cours
              </label>
            </div>
            <div class="next-number">
              <label>Prochain numéro :</label>
              <input type="text" name="nextNumberDevis" [(ngModel)]="nextNumberDevis" readonly>
            </div>
          </div>

          <div id="sansPrefixes" *ngIf="currentNumConfig==='sansPrefixes'">
            <div class="next-number">
              <label>Prochain numéro :</label>
              <input type="text" [(ngModel)]="nextNumberDevis" readonly>
            </div>
          </div>


          <button class="save-btn" data-bs-toggle="modal" data-bs-target="#devis"
            (click)="configurationNumeroDevis()">Sauvegarder</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal configuration numéro bon de commande -->
<div class="modal fade mt-5" id="settingBonCommande" tabindex="-1" aria-labelledby="settingLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="config">
          <h1>Configurer numérotation automatique de ventes</h1>

          <div class="option">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="" id="flexCheckIndeterminate" checked>
              <label class="form-check-label" for="flexCheckIndeterminate">
                Champ numéro modifiable
              </label>
            </div>
          </div>


          <div class="form-check ">
            <input class="form-check-input" type="radio" name="flexRadioDefault" value="par_defaut"
              [(ngModel)]="numerotation" id="flexRadioDefault1" (click)="showNumConfig('sansPrefixes')" checked>
            <label class="form-check-label" for="flexRadioDefault1">
              Numérotation par défaut (incrémentée de façon alphanumérique)
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" value="avec_prefixe"
              [(ngModel)]="numerotation" id="flexRadioDefault2" (click)="showNumConfig('avecPrefixes')">
            <label class="form-check-label" for="flexRadioDefault2">
              Numérotation avec préfixe
            </label>
          </div>

          <div class="option" id="avecPrefixes" *ngIf="currentNumConfig==='avecPrefixes'">
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="custom" (change)="updatePrefix()">
                Préfixe personnalisé :
                <input type="text" [disabled]="selectedPrefix !== 'custom'" [(ngModel)]="customPrefix"
                  (ngModelChange)="updatePrefix()">
              </label>
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="annee" (change)="updatePrefix()">
                Préfixe avec l'année en cours
              </label>
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="annee_mois"
                  (change)="updatePrefix()">
                Préfixe avec l'année et le mois en cours
              </label>
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="annee_mois_jour"
                  (change)="updatePrefix()">
                Préfixe avec l'année, le mois et le jour en cours
              </label>
            </div>
            <div class="next-number">
              <label>Prochain numéro :</label>
              <input type="text" name="nextNumberBonCommande" [(ngModel)]="nextNumberBonCommande" readonly>
            </div>
          </div>

          <div id="sansPrefixes" *ngIf="currentNumConfig==='sansPrefixes'">
            <div class="next-number">
              <label>Prochain numéro :</label>
              <input type="text" [(ngModel)]="nextNumberBonCommande" readonly>
            </div>
          </div>


          <button class="save-btn" data-bs-toggle="modal" data-bs-target="#bonCommande"
            (click)="configurationNumeroBonCommande()">Sauvegarder</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal configuration numéro bon de livraison -->
<div class="modal fade mt-5" id="settinglLivraison" tabindex="-1" aria-labelledby="settingLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="config">
          <h1>Configurer numérotation automatique de ventes</h1>

          <div class="option">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="" id="flexCheckIndeterminate" checked>
              <label class="form-check-label" for="flexCheckIndeterminate">
                Champ numéro modifiable
              </label>
            </div>
          </div>


          <div class="form-check ">
            <input class="form-check-input" type="radio" name="flexRadioDefault" value="par_defaut"
              [(ngModel)]="numerotation" id="flexRadioDefault1" (click)="showNumConfig('sansPrefixes')" checked>
            <label class="form-check-label" for="flexRadioDefault1">
              Numérotation par défaut (incrémentée de façon alphanumérique)
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" value="avec_prefixe"
              [(ngModel)]="numerotation" id="flexRadioDefault2" (click)="showNumConfig('avecPrefixes')">
            <label class="form-check-label" for="flexRadioDefault2">
              Numérotation avec préfixe
            </label>
          </div>

          <div class="option" id="avecPrefixes" *ngIf="currentNumConfig==='avecPrefixes'">
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="custom" (change)="updatePrefix()">
                Préfixe personnalisé :
                <input type="text" [disabled]="selectedPrefix !== 'custom'" [(ngModel)]="customPrefix"
                  (ngModelChange)="updatePrefix()">
              </label>
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="annee" (change)="updatePrefix()">
                Préfixe avec l'année en cours
              </label>
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="annee_mois"
                  (change)="updatePrefix()">
                Préfixe avec l'année et le mois en cours
              </label>
              <label class="radio-label">
                <input type="radio" name="prefix" [(ngModel)]="selectedPrefix" value="annee_mois_jour"
                  (change)="updatePrefix()">
                Préfixe avec l'année, le mois et le jour en cours
              </label>
            </div>
            <div class="next-number">
              <label>Prochain numéro :</label>
              <input type="text" name="nextNumberBonLivraison" [(ngModel)]="nextNumberBonLivraison" readonly>
            </div>
          </div>

          <div id="sansPrefixes" *ngIf="currentNumConfig==='sansPrefixes'">
            <div class="next-number">
              <label>Prochain numéro :</label>
              <input type="text" [(ngModel)]="nextNumberBonLivraison" readonly>
            </div>
          </div>


          <button class="save-btn" data-bs-toggle="modal" data-bs-target="#livraison"
            (click)="configurationNumeroBonLivraison()">Sauvegarder</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Associer client -->
<div class="modal fade mt-5" id="client" tabindex="-1" aria-labelledby="clientLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h3>+ Associer un client</h3>
        <div class="input-group mb-5">
          <select class="form-select form-select-lg " id="client-select" [(ngModel)]="selectedClient"
            (change)="onClientSelected()" (input)="verifClientFonction()">
            <option *ngFor="let client of tabClient" [value]="client.id">{{client.prenom_client}} {{client.nom_client}}
            </option>
          </select>
          <button type="button" class="btn ajouter" data-bs-toggle="modal" data-bs-target="#exampleModal">
            Ajouter un client
          </button>
        </div>
        <button class="btnAction mx-auto btn mt-3" data-bs-toggle="modal"
          data-bs-target="#FactureAvoir">Sauvegarder</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Associer client pour bon de commande -->
<div class="modal fade mt-5" id="clientboncommande" tabindex="-1" aria-labelledby="clientboncommandeLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h3>+ Associer un client</h3>
        <div class="input-group mb-5">
          <select class="form-select form-select-lg " id="client-select" [(ngModel)]="selectedClient"
            (change)="onClientSelected()" (input)="verifClientFonction()">
            <option *ngFor="let client of tabClient" [value]="client.id">{{client.prenom_client}} {{client.nom_client}}
            </option>
          </select>
          <button type="button" class="btn ajouter" data-bs-toggle="modal" data-bs-target="#exampleModal">
            Ajouter un client
          </button>
        </div>
        <button class="btnAction mx-auto btn mt-3" data-bs-toggle="modal"
          data-bs-target="#bonCommande">Sauvegarder</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Associer client pour un bon de livraison-->
<div class="modal fade mt-5" id="clientLivraison" tabindex="-1" aria-labelledby="clientLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h3>+ Associer un client</h3>
        <div class="input-group mb-5">
          <select class="form-select form-select-lg " id="client-select" [(ngModel)]="selectedClient"
            (change)="onClientSelected()" (input)="verifClientFonction()">
            <option *ngFor="let client of tabClient" [value]="client.id">{{client.prenom_client}} {{client.nom_client}}
            </option>
          </select>
          <button type="button" class="btn ajouter" data-bs-toggle="modal" data-bs-target="#exampleModal">
            Ajouter un client
          </button>
        </div>
        <button class="btnAction mx-auto btn mt-3" data-bs-toggle="modal"
          data-bs-target="#livraison">Sauvegarder</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal liste facture associer à un client -->
<div class="modal fade mt-5" id="factureClient" tabindex="-1" aria-labelledby="factureClientLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="table-responsive">
          <h3>Associer vente à cette note de crédit</h3>
          <table class="table table-hover mb-4">
            <thead class="mb-2">
              <tr>
                <th scope="col">Numéro </th>
                <th scope="col">Date Facture </th>
                <th scope="col">Client </th>
                <th scope="col">TotalTTC </th>
              </tr>
            </thead>
            <tbody *ngFor="let facture of  tabFactureClient">
              <tr (click)="recupNumeroFacture(facture);details(facture.num_facture)">
                <td>{{facture.num_facture}}</td>
                <td>{{facture.date_creation}}</td>
                <td>{{facture.prenom_client}} {{facture.nom_client}}</td>
                <td>{{facture.prix_TTC}}</td>
              </tr>
            </tbody>
          </table>
          <!-- Pagination  -->
          <div *ngIf="getItemsPage().length">
            <div class="d-flex justify-content-end mb-2">
              <button class="border border-0 btnColor  mx-2" [disabled]="pageActuelle === 1"
                (click)="pageActuelle = pageActuelle - 1">
                <i class="bi bi-arrow-left-circle fs-4"></i>
              </button>
              <button class=" rounded-circle mx-2 page" *ngFor="let page of pages" (click)="pageActuelle = page">
                <span class="pageActuelle fs-5" *ngIf="page===pageActuelle">{{page}}</span>
                <span *ngIf="page != pageActuelle">{{page}}</span>
              </button>
              <button class="border border-0 btnColor mx-2" [disabled]="pageActuelle === totalPages"
                (click)="pageActuelle = pageActuelle + 1">
                <i class="bi bi-arrow-right-circle fs-4"></i>
              </button>
            </div>
          </div>
        </div>
        <button class="btnAction mx-auto btn mt-3" data-bs-toggle="modal"
          data-bs-target="#FactureAvoir">Sauvegarder</button>
      </div>
    </div>
  </div>
</div>


<!-- Modal definition solde pour un client -->
<div class="modal fade mt-5" id="solde" tabindex="-1" aria-labelledby="soldeLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="solde">
          <h3>Ajouter solde en faveur</h3>
          <form>
            <div class="form-group">
              <label for="client">Client :</label>
              <div class="client-input" *ngFor="let clientSelect of currentClient">
                <div class="client-icon">👤</div>
                <input type="text" id="client"
                  [ngModel]="(currentClient[0]?.prenom_client || '') + ' ' + (currentClient[0]?.nom_client || '')"
                  name="clientSolde" (ngModelChange)="clientSolde = $event" readonly>
              </div>
            </div>
            <p class="info-text">Vous pouvez utiliser ce solde en faveur comme moyen de paiement dans une future vente
              pour ce client</p>
            <div class="form-group">
              <label for="montant">Montant :</label>
              <div class="currency-input" *ngIf="detailFacture">
                <input type="text" id="montant" [ngModel]="detailFacture?.prix_TTC" name="montantSolde"
                  (ngModelChange)="montantSolde = $event">
              </div>
            </div>
            <div class="form-group">
              <label for="date">Reçu le :</label>
              <input type="date" id="date" [ngModel]="currentDate" name="dateSolde"
                (ngModelChange)="dateSolde = $event">
            </div>
            <div class="form-group">
              <label for="inputPassword6" class="col-form-label">Moyen de paiement</label>
              <select class="form-select form-select-lg" id="client-select" placeholder="Type de paiement..."
                name="moyenPayement" [(ngModel)]="moyenPayement">
                <option *ngFor="let paye of tabPayement" [value]="paye.id">{{paye.nom_payement}}</option>
              </select>
            </div>
            <div class="form-group">
              <label for="commentaire">Commentaire :</label>
              <textarea id="commentaire" name="commentaireSolde"
                [ngModel]="'Solde en faveur créé à partir de la note de crédit du ' + currentDate"
                (ngModelChange)="commentaireSolde = $event"></textarea>
            </div>
            <div class="button-group">
              <button type="submit" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#FactureAvoir"
                (click)="createSolde()">Ajouter</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Ajout client -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="bgHeader">
        <div class="d-flex justify-content-between p-2">
          <h4 class="modal-title" id="exampleModalLabel">Ajout Client</h4>
          <div><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
        </div>
      </div>
      <div class="modal-body container">
        <form>
          <div class="row">
            <div class="mb-3 col-md-6 ">
              <label for="validationServer01" class="form-label">Prénom</label>
              <input type="text" class="form-control" id="validationServer01" name="prenom" [(ngModel)]="prenom">
            </div>
            <div class="mb-3 col-md-6 ">
              <label for="validationServer02" class="form-label">Nom</label>
              <input type="text" class="form-control" id="validationServer02" name="nom" [(ngModel)]="nom">
            </div>
          </div>
          <div class="row">
            <div class="mb-3 col-md-6 ">
              <label for="validationServer02" class="form-label">Nom Entreprise</label>
              <input type="text" class="form-control" id="validationServer02" name="nom" [(ngModel)]="entreprise">
            </div>
            <div class="mb-3 col-md-6 ">
              <label for="validationServer02" class="form-label">Adresse</label>
              <input type="text" class="form-control" id="validationServer02" name="nom" [(ngModel)]="adress">
            </div>
          </div>
          <div class="row">
            <div class="mb-3 col-md-6 ">
              <label for="validationServer02" class="form-label">Téléphone</label>
              <input type="text" class="form-control" id="validationServer02" name="nom" [(ngModel)]="telephone">
            </div>
            <div class="mb-3 col-md-6 ">
              <label for="validationServer02" class="form-label">Email</label>
              <input type="text" class="form-control" id="validationServer02" name="nom" [(ngModel)]="mail">
            </div>
          </div>
          <div class="mb-3 ">
            <label for="exampleInputPassword1" class="form-label">Catégorie</label>
            <select class="form-select" aria-label="Default select example" name="role" [(ngModel)]="typeClient">
              <option selected disabled>Choisisez un role</option>
              <option *ngFor="let categorie of tabCategorie" [value]="categorie.id">{{categorie.nom_categorie}}</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btnAction" (click)="ajouterUsers()" data-bs-toggle="modal"
          data-bs-target="#facture">Ajouter</button>
        <button type="button" class="btn btnClose" data-bs-dismiss="modal">Annuler</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Ajout article -->
<div class="modal fade" id="produit" tabindex="-1" aria-labelledby="produitLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="bgHeader">
        <div class="d-flex justify-content-between p-2">
          <h4 class="modal-title" id="exampleModalLabel">Ajout Article</h4>
          <div><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
        </div>
      </div>
      <div class="modal-body container">
        <form>
          <div class="row">
            <div class="mb-3 col-6">
              <label for="validationServer01" class="form-label">Nom</label>
              <input type="text" class="form-control" id="validationServer01" name="nom" [(ngModel)]="nom">
            </div>
            <div class="mb-3 col-6">
              <label for="validationServer02" class="form-label">Description</label>
              <input type="text" class="form-control" id="validationServer02" name="desc" [(ngModel)]="desc">
            </div>
          </div>
          <div class="row">
            <div class="mb-3 col-6">
              <label for="validationServer02" class="form-label">Prix d'achat</label>
              <input type="text" class="form-control" id="validationServer02" name="achat" [(ngModel)]="achat">
            </div>
            <div class="mb-3 col-6 ">
              <label for="validationServer02" class="form-label">Prix de vente</label>
              <input type="text" class="form-control" id="validationServer02" name="vente" [(ngModel)]="vente">
            </div>
          </div>
          <div class="row">
            <div class="mb-3 col-6 ">
              <label for="validationServer02" class="form-label">Quantité</label>
              <input type="text" class="form-control" id="validationServer02" name="quantite" [(ngModel)]="quantite">
            </div>
            <div class="mb-3 col-6 ">
              <label for="validationServer02" class="form-label">Quantité Alerte</label>
              <input type="text" class="form-control" id="validationServer02" name="quantiteAlerte"
                [(ngModel)]="quantiteAlerte">
            </div>
          </div>
          <div class="form-check form-check-inline" (click)="afficherChamps()">
            <input class="form-check-input" type="checkbox" id="inlineCheckbox1" value="option1">
            <label class="form-check-label" for="inlineCheckbox1">Ajouter Catégorie</label>
          </div>
          <div class="mb-3" *ngIf="showChamps">
            <label for="exampleInputPassword1" class="form-label">Catégorie article</label>
            <select class="form-select" aria-label="Default select example" name="promo" [(ngModel)]="CategorieArticle">
              <option selected disabled>Choisisez une catégorie</option>
              <option *ngFor="let categorieArticle of tabCategorie" [value]="categorieArticle.id">
                {{categorieArticle.nom_categorie_article}}</option>
            </select>
          </div>

        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btnAction" (click)="ajouterArticle()" data-bs-toggle="modal"
          data-bs-target="#facture">Ajouter</button>
        <button type="button" class="btn btnClose" data-bs-dismiss="modal">Annuler</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Ajout service -->
<div class="modal fade" id="service" tabindex="-1" aria-labelledby="serviceLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="bgHeader">
        <div class="d-flex justify-content-between p-2">
          <h4 class="modal-title" id="exampleModalLabel">Ajout Service</h4>
          <div><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
        </div>
      </div>
      <div class="modal-body container">
        <form>
          <div class="mb-3">
            <label for="validationServer01" class="form-label">Nom</label>
            <input type="text" class="form-control" id="validationServer01" name="nom" [(ngModel)]="nom">
          </div>
          <div class="mb-3">
            <label for="validationServer02" class="form-label">Description</label>
            <input type="text" class="form-control" id="validationServer02" name="desc" [(ngModel)]="desc">
          </div>


          <div class="mb-3">
            <label for="validationServer02" class="form-label">Prix de vente</label>
            <input type="text" class="form-control" id="validationServer02" name="vente" [(ngModel)]="vente">
          </div>

        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btnAction" (click)="ajouterService()" data-bs-toggle="modal"
          data-bs-target="#facture">Ajouter</button>
        <button type="button" class="btn btnClose" data-bs-dismiss="modal">Annuler</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal détail facture -->
<div class="modal fade mt-5" id="detailFacture" tabindex="-1" aria-labelledby="detailFactureLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="bgHeader">
        <div class="d-flex justify-content-between p-2">
          <h4 class="modal-title" id="exampleModalLabel">Consulter Facture</h4>
          <div><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
        </div>
      </div>
      <div class="modal-body">
        <div class="seeFact" data-bs-toggle="modal" data-bs-target="#pdfModel">
          <i class="bi bi-eye"></i>
        </div>
        <div class="header mb-4 d-grid gap-2 d-md-flex justify-content-md-end">
          <ul class="nav">
            <li><a [ngClass]="{'currentItemNav': boutonActif === 1}" (click)="showDetailFacture('Récapitulatif')"
                (click)="boutonActif = 1">Récapitulatif</a></li>
            <li><a [ngClass]="{'currentItemNav': boutonActif === 2}" (click)="showDetailFacture('Réglements')"
                (click)="boutonActif = 2"
                *ngIf="detailFacture && detailFacture.type_paiement!='immediat'">Réglements</a></li>
            <li><a [ngClass]="{'currentItemNav': boutonActif === 3}" (click)="showDetailFacture('Conversations')"
                (click)="boutonActif = 3">Conversations</a></li>
          </ul>
        </div>

        <ng-container *ngIf="detailFacture">
          <div id="Récapitulatif" *ngIf="currentDetail==='Récapitulatif'">
            <div class="header">
              <div>
                <label>Date:</label>
                <span>{{detailFacture.date_creation | date:'yyyy-MM-dd'}}</span>
              </div>
              <div>
                <label>Numéro:</label>
                <span>{{detailFacture.numero_facture}}</span>
              </div>
            </div>


            <div class="section1 border p-3" *ngIf="client">
              <div class="section-title">
                1. À qui je-vends ? <span class="edit-icon">✎</span>
              </div>
              <span>{{client.prenom}} {{client.nom}}</span>
            </div>

            <div class="section1 border p-3"
              *ngIf="detailFacture.type_paiement==='immediat' || detailFacture.type_paiement==='echeance' ">
              <div class="section-title">
                2. Quels produits / services ? <span class="edit-icon">✎</span>
              </div>
              <table class="detailFacture">
                <thead>
                  <tr>
                    <th>Produit / Service</th>
                    <th>Quantité</th>
                    <th>TVA</th>
                    <th>Prix unitaire</th>
                    <th>Prix HT</th>
                    <th>Prix Total TTC</th>
                    <th>Total</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let article of article">
                    <td>{{article.nom_article}}</td>
                    <td>{{article.quantite_article}}</td>
                    <td>{{article.TVA}}</td>
                    <td>{{article.prix_unitaire_article}}</td>
                    <td>{{article.prix_total_article}}</td>
                    <td>{{article.prix_total_tva_article}}</td>
                    <td>{{detailFacture.prix_TTC}}</td>
                  </tr>
                </tbody>
              </table>
              <p class="total mt-2">Total: {{detailFacture.prix_TTC}} XOF</p>
            </div>
            <div class="section1 border p-3"
              *ngIf="detailFacture.type_paiement==='facture_Accompt' || detailFacture.type==='avoir'">
              <div class="section-title">
                2. Quels produits / services ?
                <span class="edit-icon">✎</span>
              </div>

              <table class="acompteTab">
                <thead>
                  <tr>
                    <th>Produit / Service</th>
                    <th>Quantité</th>
                    <th>TVA</th>
                    <th>Prix unitaire</th>
                    <th>Prix HT</th>
                    <th>Prix Total TTC</th>
                    <th>Total</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let article of article">
                    <td>{{article.nom_article}}</td>
                    <td>{{article.quantite_article}}</td>
                    <td>{{article.TVA}}</td>
                    <td>{{article.prix_unitaire_article}}</td>
                    <td>{{article.prix_total_article}}</td>
                    <td>{{article.prix_total_tva_article}}</td>
                    <td>{{detailFacture.prix_TTC}}</td>
                  </tr>
                  <tr *ngFor="let acompte of acompteFacture">
                    <td colspan="5">{{acompte.titreAccomp}} - Facture N° {{detailFacture.numero_facture}} (du
                      {{acompte.dateEcheance}})</td>
                    <td>{{acompte.montant}}</td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr class="total-row">
                    <td colspan="5" style="text-align: right;">Total</td>
                    <td>45 000,00 XOF</td>
                  </tr>
                </tfoot>
              </table>
            </div>

            <div class="section1 border p-3" *ngIf="detailFacture.type_paiement==='immediat' ">
              <div class="section-title">
                3. Quand serai-je payé ? <span class="edit-icon">✎</span>
              </div>
              <div class="payment-schedule">
                <p>
                  <span>Type de paiement : {{detailFacture.type_paiement}} </span> <br>
                  <span>Moyen de paiement : {{detailFacture.moyen_paiement}}</span>
                </p>
              </div>
            </div>
            <div class="section1 border p-3" *ngIf="detailFacture.type_paiement==='echeance' ">
              <div class="section-title">
                3. Quand serai-je payé ? <span class="edit-icon">✎</span>
              </div>
              <div class="payment-schedule">
                <p>
                  <span>Combien d'échéances : </span>
                  <span>{{detailFacture.nombre_echeance}}</span>
                </p>
                <p *ngFor="let echeance of echeance; let i = index">
                  <span>Échéance {{i+1}}:</span>
                  <span>{{echeance.date_pay_echeance}}</span>
                  <span>{{echeance.montant_echeance}}</span>
                </p>
              </div>
            </div>
            <div class="section1 border p-3" *ngIf="detailFacture.type_paiement==='facture_Accompt'">
              <div class="section-title">
                3. Quand serai-je payé ?
                <span class="edit-icon">✎</span>
              </div>

              <h3>Factures d'acompte :</h3>
              <table class="acompteTab">
                <thead>
                  <tr>
                    <th>Numéro</th>
                    <th>Date</th>
                    <th>Montant</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let acompte of acompteFacture">
                    <td>000001</td>
                    <td>{{acompte.dateEcheance}}</td>
                    <td>{{acompte.montant}} XOF</td>
                    <td>
                      <span class="status-icon" style="color: red;">⚠</span>
                      <span class="status-icon" style="color: green;">✓</span>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div class="solde-section">
                <div class="row">
                  <div class="col-2">
                    <label for="solde-date">Solde :</label>
                  </div>
                  <div class="col-5">
                    <input type="date" id="solde-date" value="2024-07-15">
                  </div>
                  <div class="col-5">
                    <input type="number" value="45000.00" step="0.01">
                  </div>
                </div>
              </div>
            </div>
            <div class="section1 border p-3" *ngIf="detailFacture.type==='avoir'">
              <div class="section-title">
                3. Quand serai-je payé ?
                <span class="edit-icon">✎</span>
              </div>
              <h3>Factures d'échèance :</h3>
              <div class="payment-schedule">
                <p>
                  <span>Combien d'échéances : </span>
                  <span>{{detailFacture.nombre_echeance}}</span>
                </p>
                <p *ngFor="let echeance of echeance; let i = index">
                  <span>Échéance {{i+1}}:</span>
                  <span>{{echeance.date_pay_echeance}}</span>
                  <span>{{echeance.montant_echeance}}</span>
                </p>
              </div>
              <hr>

              <h3>Factures d'acompte :</h3>
              <table class="acompteTab">
                <thead>
                  <tr>
                    <th>Numéro</th>
                    <th>Date</th>
                    <th>Montant</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let acompte of acompteFacture">
                    <td>000001</td>
                    <td>{{acompte.dateEcheance}}</td>
                    <td>{{acompte.montant}} XOF</td>
                    <td>
                      <span class="status-icon" style="color: red;">⚠</span>
                      <span class="status-icon" style="color: green;">✓</span>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div class="solde-section">
                <div class="row">
                  <div class="col-2">
                    <label for="solde-date">Solde :</label>
                  </div>
                  <div class="col-5">
                    <input type="date" id="solde-date" value="2024-07-15">
                  </div>
                  <div class="col-5">
                    <input type="number" value="45000.00" step="0.01">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
        <ng-container>
          <div id="Réglements" *ngIf="currentDetail==='Réglements'">
            <div class="totalRéglements">
              Total: {{detailFacture.prix_TTC}}XOF
            </div>

            <div class="payment-section">
              <div class="received-payments ">
                <h3>Paiements reçus</h3>
                <table>
                  <thead>
                    <tr>
                      <th>Numéro</th>
                      <th>Date</th>
                      <th>Montant</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let paiement of tabPaiementFacture">
                      <td>{{paiement.num_paiement}}</td>
                      <td>{{paiement.date_recu}}</td>
                      <td>{{paiement.montant}}</td>
                      <td class="text-center"> <i class="bi bi-reply" title="transformer en échèance"
                          (click)="paymentRecuEnecheance(paiement.id)"></i></td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="pending-payments">
                <h3>Échéances en attente</h3>
                <table>
                  <thead>
                    <tr>
                      <th>Prévu</th>
                      <th>Montant</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let echeance of tabEcheanceFacture">
                      <td>{{echeance.date_pay_echeance}}</td>
                      <td>{{echeance.montant_echeance}}</td>
                      <td class="text-center"> <i class="bi bi-wallet-fill" title="Ajouter payement"
                          (click)="chargerInfosEcheance(echeance)" data-bs-toggle="modal"
                          data-bs-target="#EncheanceEnPayement"></i></td>
                    </tr>
                  </tbody>
                </table>
                <a href="#" class="add-link">+ Ajouter une échéance</a>
              </div>
            </div>

            <div class="reminders">
              <span>⚙</span> Relances automatiques (désactivé)
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="currentDetail==='Conversations'">
          <div class="d-grid gap-2  mb-3 d-md-flex justify-content-md-end">
            <button class="btn btnAction" type="button" data-bs-toggle="modal" data-bs-target="#conversation">Ajouter
              Conversation</button>
          </div>
          <div class="border p-3 mb-3">
            <div class="d-flex">
              <span class="me-3">Filtrer par :</span>
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                <label class="form-check-label" for="flexRadioDefault1">
                  <i class="bi bi-check-lg text-success" title="Terminer"></i>
                </label>
              </div>
              <div class="form-check me-3">
                <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2">
                <label class="form-check-label" for="flexRadioDefault2">
                  <i class="bi bi-exclamation-octagon text-danger" title="En attente"></i>
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault3">
                <label class="form-check-label" for="flexRadioDefault3">
                  <i class="bi bi-emoji-neutral text-secondary" title="courrier electronique rebondi"></i>
                </label>
              </div>
            </div>
          </div>
          <div class="contenu text-center">
            <i class="bi bi-emoji-frown-fill"></i>
            <h5>- 0 Résultats -</h5>
          </div>
        </ng-container>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btnClose" data-bs-dismiss="modal">Fermer</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal pour télécharger facture -->
<div class="modal fade mt-5" id="pdfModel" tabindex="-1" aria-labelledby="pdfModelLabel" aria-hidden="true"
  *ngIf="detailFacture">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body container">
        <div class="imprimFact">
          <button class="btn"
                  [printStyle]="{img: {'width':'2.5cm'}}"
                  [useExistingCss]="true"
                  styleSheetFile="../facture/facture.component.css"
                  printSectionId="print-section-details"
                  ngxPrint>
            <i class="bi bi-printer"></i>
          </button>
        </div>
        
        <div class="pdfFact" (click)="generatePdf('print-section-details')">
          <i class="bi bi-file-earmark-pdf"></i>
        </div>
        <div class="colorModéle">
          <input type="color" class="form-control form-control-color " [(ngModel)]="color" (input)="onColorChange()">
        </div>
        <div class="card px-4 py-2 pt-4 shadow rounded-4 container" id="print-section-details">
          <div class="invoice container">
            <div class="row">
              <div class="col-7" *ngIf="InfoSup">
                <img src="http://127.0.0.1:8000{{InfoSup.logo}}" class="logo" style="width: 125px; height: 125px;">
                <table>
                  <thead class="thead-custom">
                    <tr>
                      <th> Informations entreprise</th>
                    </tr>
                  </thead>
                  <tbody class="bg-secondary text-dark p-5 bg-opacity-25">
                    <p class="me-3 ms-3">Nom de l'entreprise : {{ InfoSup.nom_entreprise }} </p>
                    <p class="me-3 ms-3">Adresse : {{ InfoSup.adress_entreprise}}</p>
                    <p class="me-3 ms-3">Téléphone : {{ InfoSup.tel_entreprise }}</p>
                  </tbody>
                </table>

                <h4 class="mt-5"><span>{{detailFacture.date_creation | date:'yyyy-MM-dd'}}</span></h4>

              </div>
              <div class="col-5">
                <div class="invoice-number">
                  <h2>{{titre}}</h2>
                  <p class="fw-bold fs-5 row">
                    <label class="col-3">Numéro: </label>
                    <span>{{detailFacture.numero_facture}}</span>&nbsp;
                  </p>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-7">
              </div>
              <div class="col-5">
                <table>
                  <thead class="">
                    <tr>
                      <th> Informations client</th>
                    </tr>
                  </thead>
                  <tbody class="bg-secondary text-dark p-5 bg-opacity-25" *ngIf="client">
                    <span>{{client.prenom}} {{client.nom}}</span><br>
                    <span>{{client.nom_entreprise}}</span><br>
                    <span>{{client.telephone}}</span><br>
                    <span>{{client.adresse}}</span>
                  </tbody>
                </table>
              </div>
            </div>
            <br>
            <br>
            <br>
            <ng-container *ngIf="detailFacture.type_paiement==='immediat' || detailFacture.type_paiement==='echeance' ">
              <table class="detailFacture">
                <thead>
                  <tr>
                    <th>Produit / Service</th>
                    <th>Quantité</th>
                    <th>TVA</th>
                    <th>Prix unitaire</th>
                    <th>Prix Total TTC</th>
                    <th>Total</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let article of article">
                    <td>{{article.nom_article}}</td>
                    <td>{{article.quantite_article}}</td>
                    <td>{{article.prix_achat}}</td>
                    <td>{{article.prix_unitaire_article}}</td>
                    <td>{{article.prix_total_tva_article}}</td>
                    <td>{{detailFacture.prix_TTC}}</td>
                  </tr>
                </tbody>
              </table>
              <p class="total mt-2">Total: {{detailFacture.prix_TTC}} XOF</p>
            </ng-container>
            <ng-container *ngIf="detailFacture.type_paiement==='facture_Accompt'">
              <table class="acompteTab">
                <thead>
                  <tr>
                    <th>Produit / Service</th>
                    <th>Quantité</th>
                    <th>TVA</th>
                    <th>Prix unitaire</th>
                    <th>Prix Total TTC</th>
                    <th>Total</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let article of article">
                    <td>{{article.nom_article}}</td>
                    <td>{{article.quantite_article}}</td>
                    <td>{{article.prix_achat}}</td>
                    <td>{{article.prix_unitaire_article}}</td>
                    <td>{{article.prix_total_tva_article}}</td>
                    <td>{{detailFacture.prix_TTC}}</td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr class="total-row">
                    <td colspan="5" style="text-align: right;">Total</td>
                    <td>{{detailFacture.prix_TTC}} XOF</td>
                  </tr>
                </tfoot>
              </table>
            </ng-container>
            <div class="row">
              <div class="col-6 mt-5">
                <ng-container *ngIf="detailFacture.type_paiement==='echeance'">
                  <h2>Échéances</h2>
                  <table>
                    <thead>
                      <tr>
                        <th>Numéro</th>
                        <th>Prévue le :</th>
                        <th>Montant :</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let echeance of echeance; let i = index">
                        <td>{{detailFacture.numero_facture}}-{{i+1}}</td>
                        <td>{{echeance.date_pay_echeance}}</td>
                        <td>{{echeance.montant_echeance}}</td>
                      </tr>
                    </tbody>
                  </table>
                </ng-container>

              </div>
              <div class="col-6">
              </div>
            </div>
            <div class="row" *ngIf="detailFacture.type_paiement==='facture_Accompt'">
              <table class="table table-bordered">
                <thead class="thead-custom">
                  <tr>
                    <th>Facture Acompte</th>
                    <th>Total</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let acompte of acompteFacture">
                    <td>{{acompte.titreAccomp}} - Facture N° {{detailFacture.numero_facture}} (du
                      {{acompte.dateEcheance}})</td>
                    <td>{{acompte.montant}}</td>
                  </tr>
                </tbody>
              </table>
              <p class="total mt-2">Solde: {{totalRemise}}XOF</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal facture d'accompte -->
<div class="modal fade" id="echeance" tabindex="-1" aria-labelledby="echeanceLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="bgHeader">
        <div class="d-flex justify-content-between p-2">
          <h4 class="modal-title" id="exampleModalLabel">Facture d'acompte</h4>
          <div><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
        </div>
      </div>
      <div class="modal-body p-2">
        <h2>Ajouter facture d'acompte</h2>
        <form>
          <div class="form-group">
            <label for="intitule">Intitulé :</label>
            <input type="text" id="intitule" name="intitule" name="acompte" [(ngModel)]="acompte"
              placeholder="Acompte 1">
          </div>
          <div class="row">
            <div class="col-6">
              <label for="dateDebut">Date début:</label>
              <input type="date" id="dateDebut" name="dateDebut" [(ngModel)]="dateDebut">
            </div>
            <div class="col-6">
              <label for="dateFin">Date fin:</label>
              <input type="date" id="dateFin" name="dateFin" [(ngModel)]="dateFin">
            </div>
          </div>
          <div class="row">
            <div class="col-6">
              <label for="totalHT">Total HT de la vente :</label>
              <div class="currency-input">
                <input type="number" id="totalHT" name="totalAcompte" [(ngModel)]="totalRemise" step="0.01">
              </div>
            </div>
            <div class="col-6">
              <label for="montant">Montant de l'acompte:</label>
              <div class="currency-input">
                <input type="number" id="montant" name="montantAcompte" [(ngModel)]="montantAcompte" step="0.01">
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="commentaire">Commentaire (affiché dans la facture) :</label>
            <textarea id="commentaire" name="commentaire" [(ngModel)]="commentaire" rows="4"></textarea>
          </div>

        </form>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btnAction" data-bs-toggle="modal" data-bs-target="#facture"
          (click)="createAcompte()">Ajouter acompte</button>
        <button type="button" class="btn btnClose" data-bs-dismiss="modal">Annuler</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Echeance en payement -->
<div class="modal fade mt-5" id="EncheanceEnPayement" tabindex="-1" aria-labelledby="EncheanceEnPayementLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      <div class="modal-body">
        <div class="containerEcheance">
          <h3>Transformer en paiement reçu</h3>
          <form>
            <div class="row">
              <div class="form-group col-6">
                <label for="prevu">Prévu :</label>
                <input type="date" id="prevu" name="datePrevu" [(ngModel)]="datePrevu">
              </div>
              <div class="form-group col-6">
                <label for="recu">Reçu le :</label>
                <input type="date" id="recu" name="dateRecu" [(ngModel)]="dateRecu">
              </div>
            </div>
            <div class="row">
              <div class="form-group">
                <label for="montant">Montant :</label>
                <div class="currency-input">
                  <input type="number" id="montant" step="0.01" name="montantEcheance" [(ngModel)]="montantEcheance">
                </div>
              </div>
              <div class="form-group">
                <label for="moyen">Moyen paiement :</label>
                <select id="moyen" name="moyen" [(ngModel)]="moyen">
                  <option *ngFor="let paye of tabPayement" [value]="paye.id">{{paye.nom_payement}}</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="commentaire">Commentaire (affiché dans le reçu) :</label>
              <textarea id="commentaire" rows="3" name="noteEcheance" [(ngModel)]="noteEcheance"></textarea>
            </div>
            <button *ngIf="detailFacture && detailFacture.type_paiement==='echeance'" type="submit" class="submit-btn"
              (click)="echeanceEnPayementRecu()" data-bs-toggle="modal" data-bs-target="#detailFacture">Transformer en
              paiement reçu</button>
            <button *ngIf="detailFacture && detailFacture.type_paiement==='facture_Accompt'" type="submit"
              class="submit-btn" (click)="echeanceEnPayementRecu()" data-bs-toggle="modal"
              data-bs-target="#detailFacture">Transformer acompte en paiement reçu</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Associer une echèance à un devis -->
<div class="modal fade" id="echanceDevis" tabindex="-1" aria-labelledby="echanceDevisLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered ">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h3>+ Associer un échéancier </h3>
        <div class="section Échéance text-center  mx-auto p-2">
          <span class="font-weight-bold"> <strong>Total net à payer</strong> {{ totalRemise | number:'1.2-2' }}</span>
          FCfa <br>
          <div class="row">
            <ng-container class="mb-2" *ngFor="let item of input; let i = index">
              <div class="col-3"><label for="echeance1" class="me-1">Échéance {{i+1}}: </label></div>
              <div class="col-4"><input type="date" id="echeance1" class="me-2" value="" [(ngModel)]="item.date"></div>
              <div class="col-3"><input type="number" id="montant1" class="me-2" value="" [(ngModel)]="item.prix">
              </div>
              <div class="col-2"><i class="bi bi-x-lg" style="color: red; cursor: pointer;"
                  (click)="deleteInput(i)"></i></div>
            </ng-container>
            <span (click)="addInput()" style="cursor: pointer;"><i class="bi bi-plus-circle me-2"></i>ajouter</span>
          </div>
        </div>
        <button class="btnAction mx-auto btn mt-3" data-bs-toggle="modal" data-bs-target="#devis">Sauvegarder</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Associer une echèance à un bon de commande -->
<div class="modal fade" id="echanceBonCommande" tabindex="-1" aria-labelledby="echanceBonCommandeLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered ">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h3>+ Associer un échéancier </h3>
        <div class="section Échéance text-center  mx-auto p-2">
          <span class="font-weight-bold"> <strong>Total net à payer</strong> {{ totalRemise | number:'1.2-2' }}</span>
          FCfa <br>
          <div class="row">
            <ng-container class="mb-2" *ngFor="let item of input; let i = index">
              <div class="col-3"><label for="echeance1" class="me-1">Échéance {{i+1}}: </label></div>
              <div class="col-4"><input type="date" id="echeance1" class="me-2" value="" [(ngModel)]="item.date"></div>
              <div class="col-3"><input type="number" id="montant1" class="me-2" value="" [(ngModel)]="item.prix">
              </div>
              <div class="col-2"><i class="bi bi-x-lg" style="color: red; cursor: pointer;"
                  (click)="deleteInput(i)"></i></div>
            </ng-container>
            <span (click)="addInput()" style="cursor: pointer;"><i class="bi bi-plus-circle me-2"></i>ajouter</span>
          </div>
        </div>
        <button class="btnAction mx-auto btn mt-3" data-bs-toggle="modal"
          data-bs-target="#bonCommande">Sauvegarder</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Associer facture d'accompte à un devis -->
<div class="modal fade mt-5" id="acoompteDevis" tabindex="-1" aria-labelledby="echeanceLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-grid gap-2 p-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-5">
        <h2>Ajouter facture d'acompte</h2>
        <form>
          <div class="form-group">
            <label for="intitule">Intitulé :</label>
            <input type="text" id="intitule" name="intitule" name="acompte" [(ngModel)]="acompte"
              placeholder="Acompte 1">
          </div>
          <div class="row">
            <div class="col-6">
              <label for="dateDebut">Date début:</label>
              <input type="date" id="dateDebut" name="dateDebut" [(ngModel)]="dateDebut">
            </div>
            <div class="col-6">
              <label for="dateFin">Date fin:</label>
              <input type="date" id="dateFin" name="dateFin" [(ngModel)]="dateFin">
            </div>
          </div>
          <div class="row">
            <div class="col-6">
              <label for="totalHT">Total HT de la vente :</label>
              <div class="currency-input">
                <input type="number" id="totalHT" name="totalAcompte" [(ngModel)]="totalRemise" step="0.01">
              </div>
            </div>
            <div class="col-6">
              <label for="montant">Montant de l'acompte:</label>
              <div class="currency-input">
                <input type="number" id="montant" name="montantAcompte" [(ngModel)]="montantAcompte" step="0.01">
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="commentaire">Commentaire (affiché dans la facture) :</label>
            <textarea id="commentaire" name="commentaire" [(ngModel)]="commentaire" rows="4"></textarea>
          </div>

        </form>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btnAction" data-bs-toggle="modal" data-bs-target="#devis"
          (click)="createAcompte()">Ajouter acompte</button>
        <button type="button" class="btn btnClose" data-bs-dismiss="modal">Annuler</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal détail devis -->
<div class="modal fade mt-5" id="detailDevis" tabindex="-1" aria-labelledby="detailDevisLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="bgHeader">
        <div class="d-flex justify-content-between p-2">
          <h4 class="modal-title" id="exampleModalLabel">Consulter Devis</h4>
          <div><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
        </div>
      </div>
      <div class="modal-body">
        <div class="seeFact" data-bs-toggle="modal" data-bs-target="#pdfModel">
          <i class="bi bi-eye"></i>
        </div>


        <ng-container *ngIf="detailDevi">
          <div>
            <div class="header">
              <div>
                <label>Date création:</label>
                <span>{{detailDevi.date_creation | date:'yyyy-MM-dd'}}</span>
                <label>Date limite:</label>
                <span>{{detailDevi.date_limite | date:'yyyy-MM-dd'}}</span>
              </div>
              <div>
                <label>Numéro:</label>
                <span>{{detailDevi.numero_devi}}</span>
              </div>
            </div>

            <div class="section border p-3" *ngIf="clientDevi">
              <div class="section-title">
                1. À qui je-vends ? <span class="edit-icon">✎</span>
              </div>
              <span>{{clientDevi.prenom}} {{clientDevi.nom}}</span>
            </div>

            <div class="section border p-3">
              <div class="section-title">
                2. Quels produits / services ? <span class="edit-icon">✎</span>
              </div>
              <table class="detailFacture">
                <thead>
                  <tr>
                    <th>Produit / Service</th>
                    <th>Quantité</th>
                    <th>TVA</th>
                    <th>Prix unitaire</th>
                    <th>Prix Total TTC</th>
                    <th>Total</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let article of articleDevi">
                    <td>{{article.nom_article}}</td>
                    <td>{{article.quantite_article}}</td>
                    <td>{{article.prix_achat}}</td>
                    <td>{{article.prix_unitaire_article}}</td>
                    <td>{{article.prix_total_tva_article}}</td>
                    <td>{{detailDevi.prix_TTC}}</td>
                  </tr>
                  <tr *ngFor="let acompte of acompteFacture">
                    <td colspan="5">{{acompte.titreAccomp}} - Facture N° {{detailDevi.numero_facture}} (du
                      {{acompte.dateEcheance}})</td>
                    <td>{{acompte.montant}}</td>
                  </tr>
                </tbody>
                <!-- <tfoot>
                  <tr class="total-row">
                      <td colspan="5" style="text-align: right;">Total</td>
                      <td>45 000,00 XOF</td>
                  </tr>
              </tfoot> -->
              </table>
              <p class="total mt-2">Total: {{detailDevi.prix_TTC}} XOF</p>
            </div>
          </div>
        </ng-container>
      </div>
      <div class="buttons p-3" *ngIf="detailDevi">
        <button class="btn btn-success" (click)="devisEnVente(detailDevi.id_devi)"
          *ngIf="detailDevi.statut_devi!='transformer' && detailDevi.statut_devi!='annuler'">Transformer en
          vente</button>
        <button class="btn btn-secondary" (click)=" devisEnCommande(detailDevi.id_devi)"
          *ngIf="detailDevi.statut_devi!='transformer' && detailDevi.statut_devi!='annuler'">Transformer en
          commande</button>
        <button class="btn btn-Annuler" (click)="annulerDevis(detailDevi.id_devi)"
          *ngIf="detailDevi.statut_devi!='annuler'">Annuler ce devis</button>
        <button class="btn btn-success" *ngIf="detailDevi.statut_devi=='annuler'">reprendre</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal détail bon de commande -->
<div class="modal fade mt-5" id="detailCommande" tabindex="-1" aria-labelledby="detailCommandeLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="bgHeader">
        <div class="d-flex justify-content-between p-2">
          <h4 class="modal-title" id="exampleModalLabel">Consulter Bon de commande</h4>
          <div><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
        </div>
      </div>
      <div class="modal-body">
        <div class="seeFact" data-bs-toggle="modal" data-bs-target="#pdfModel">
          <i class="bi bi-eye"></i>
        </div>

        <ng-container *ngIf="bonCommande">
          <div>

            <div class="headerFacture row">
              <div class="date-inputs col-7">
                <div class="date-input">
                  <label for="date-devis">Date commande :</label>
                  <span>{{bonCommande.date_creation | date:'yyyy-MM-dd'}}</span>
                </div>
                <div class="date-input">
                  <label for="date-validite">Date livraison :</label>
                  <span>{{bonCommande.date_limite | date:'yyyy-MM-dd'}}</span>
                </div>
              </div>
              <div class="numero-input col-5">
                <label for="numero">Numéro :&nbsp;</label>
                <span>{{bonCommande.numero_bonCommande}}</span>
              </div>
            </div>

            <div class="section border p-3" *ngIf="clientCommande">
              <div class="section-title">
                1. À qui je-vends ? <span class="edit-icon">✎</span>
              </div>
              <span>{{clientCommande?.prenom}} {{clientCommande?.nom}}</span> <br>
              <span>{{clientCommande?.nom_entreprise}} {{clientCommande?.nom}}</span> <br>
              <span>{{clientCommande?.adresse}} </span> <br>
              <span>{{clientCommande?.telephone}} </span>
            </div>

            <div class="section border p-3">
              <div class="section-title">
                2. Quels produits / services ? <span class="edit-icon">✎</span>
              </div>
              <table class="bonCommande">
                <thead>
                  <tr>
                    <th>Produit / Service</th>
                    <th>Quantité</th>
                    <th>TVA</th>
                    <th>Prix unitaire</th>
                    <th>Prix Total TTC</th>
                    <th>Total</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let article of articlesCommande">
                    <td>{{article.nom_article}}</td>
                    <td>{{article.quantite_article}}</td>
                    <td>{{article.prix_achat}}</td>
                    <td>{{article.prix_unitaire_article}}</td>
                    <td>{{article.prix_total_tva_article}}</td>
                    <td>{{article.prix_total_tva_article}}</td>
                  </tr>
                </tbody>
              </table>
              <p class="total mt-2">Total: {{bonCommande.prix_TTC}} XOF</p>
            </div>


            <div class="section border p-3">
              <div class="section-title">
                3. Quand serai-je payé ? <span class="edit-icon">✎</span>
              </div>
              <div class="payment-schedule">
                <p>
                  <span>Combien d'échéances : </span>
                  <span>{{echeancesCommande.length}}</span>
                </p>
                <p *ngFor="let echeance of echeancesCommande; let i = index">
                  <span>Échéance {{i+1}}:</span>
                  <span>{{echeancesCommande[i].date_pay_echeance}}</span>
                  <span>{{echeancesCommande[i].montant_echeance}}</span>
                </p>
              </div>
            </div>
          </div>
        </ng-container>

      </div>
      <div class="buttons p-3" *ngIf="bonCommande">
        <button class="btn btn-success" (click)="commandeEnVente(bonCommande.id_bonCommande)"
          *ngIf="bonCommande.statut_bonCommande!='annuler' && bonCommande.statut_bonCommande!='transformer' ">Transformer
          en vente</button>
        <button class="btn btn-Annuler" (click)="annulerBonCommande(bonCommande.id_bonCommande)"
          *ngIf="bonCommande.statut_bonCommande!='annuler'">Annuler ce devis</button>
        <button class="btn btn-success" *ngIf="bonCommande.statut_bonCommande=='annuler'">reprendre</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal détail bon de livraison -->
<div class="modal fade mt-5" id="detailBL" tabindex="-1" aria-labelledby="detailBLLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="bgHeader">
        <div class="d-flex justify-content-between p-2">
          <h4 class="modal-title" id="exampleModalLabel">Consulter Bon de livraison</h4>
          <div><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
        </div>
      </div>
      <div class="modal-body">
        <div class="seeFact" data-bs-toggle="modal" data-bs-target="#pdfModel">
          <i class="bi bi-eye"></i>
        </div>

        <ng-container *ngIf="detailBonLivraison">
          <div>

            <div class="headerFacture row">
              <div class="date-inputs col-7">
                <div class="date-input">
                  <label for="date-validite">Date livraison :</label>
                  <span>{{detailBonLivraison.date_livraison | date:'yyyy-MM-dd'}}</span>
                </div>
              </div>
              <div class="numero-input col-5">
                <label for="numero">Numéro :&nbsp;</label>
                <span>{{detailBonLivraison.numero_detailBonLivraison}}</span>
              </div>
            </div>

            <div class="section border p-3" *ngIf="cientBonLivraison">
              <div class="section-title">
                1. À qui je-vends ? <span class="edit-icon">✎</span>
              </div>
              <span>{{cientBonLivraison?.prenom}} {{cientBonLivraison?.nom}}</span> <br>
              <span>{{cientBonLivraison?.nom_entreprise}} {{cientBonLivraison?.nom}}</span> <br>
              <span>{{cientBonLivraison?.adresse}} </span> <br>
              <span>{{cientBonLivraison?.telephone}} </span>
            </div>

            <div class="section border p-3">
              <div class="section-title">
                2. Quels produits / services ? <span class="edit-icon">✎</span>
              </div>
              <table class="detailBonLivraison">
                <thead>
                  <tr>
                    <th>Produit / Service</th>
                    <th>Quantité</th>
                    <th>TVA</th>
                    <th>Prix unitaire</th>
                    <th>Prix Total TTC</th>
                    <th>Total</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let article of articlesLivraison">
                    <td>{{article.nom_article}}</td>
                    <td>{{article.quantite_article}}</td>
                    <td>{{article.prix_achat}}</td>
                    <td>{{article.prix_unitaire_article}}</td>
                    <td>{{article.prix_total_tva_article}}</td>
                    <td>{{article.prix_total_tva_article}}</td>
                  </tr>
                </tbody>
              </table>
              <p class="total mt-2">Total: {{detailBonLivraison.prix_TTC}} XOF</p>
            </div>
          </div>
        </ng-container>

      </div>
      <ng-container *ngIf="detailBonLivraison">
        <div class="buttons p-3" *ngIf="detailBonLivraison.statut_livraison=='brouillon'">
          <button class="btn btn-success" (click)="preparerBonLivraison(detailBonLivraison.id_livraison)">Livraison en
            préparation</button>
          <button class="btn btn-Annuler" (click)="planifierBonLivraison(detailBonLivraison.id_livraison)">Livraison
            planifiée</button>
          <button class="btn btn-success" (click)="realiserBonLivraison(detailBonLivraison.id_livraison)">Livraison
            réalisée</button>
        </div>
        <div class="buttons p-3" *ngIf="detailBonLivraison.statut_livraison=='preparer'">
          <button class="btn btn-success" (click)="planifierBonLivraison(detailBonLivraison.id_livraison)">Livraison
            planifiée</button>
          <button class="btn btn-success" (click)="realiserBonLivraison(detailBonLivraison.id_livraison)">Livraison
            réalisée</button>
          <button class="btn btn-Annuler">Annuler livraison</button>
        </div>
        <div class="buttons p-3" *ngIf="detailBonLivraison.statut_livraison=='planifier'">
          <button class="btn btn-success" (click)="realiserBonLivraison(detailBonLivraison.id_livraison)">Livraison
            réalisée</button>
          <button class="btn btn-success" (click)="livraisonEnVente(detailBonLivraison.id_livraison)">Transformer en
            vente</button>
          <button class="btn btn-danger">Annuler livraison</button>
        </div>
        <div class="buttons p-3" *ngIf="detailBonLivraison.statut_livraison=='livrer'">
          <button class="btn btn-danger">Annuler livraison</button>
        </div>
      </ng-container>

    </div>
  </div>
</div>

<!-- Modal creation facture -->
<div class="modal fade mt-5" id="facture" tabindex="-1" aria-labelledby="factureLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered  modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="bgHeader">
        <div class="d-flex justify-content-between p-2">
          <h4 class="modal-title" id="exampleModalLabel">{{titre}}</h4>
          <div><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
        </div>
      </div>
      <div class="modal-body ">
        <div class="seeFact" data-bs-toggle="modal" data-bs-target="#seeModéle">
          <i class="bi bi-eye"></i>
        </div>
        <div class="containerFacture">
          <div class="d-flex mb-2">
            <div class="p-3 flex-grow-1">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                <label class="form-check-label" for="flexSwitchCheckDefault">Actif</label>
              </div>
            </div>
            <ng-container *ngIf="etiquettes.length > 0; else associerEtiquetteBlock" class="etiquettes">
              <span *ngFor="let etiq of etiquettes; let i = index" [ngStyle]="{'background-color': etiq.couleur}"
                class="etiquette me-2">
                {{ etiq.nom }}
                <i class="bi bi-x-lg text-light" (click)="supprimerEtiquette(i)"></i>
              </span>
              <i class="bi bi-plus-circle-dotted" data-bs-toggle="modal" data-bs-target="#etiquette"></i>
            </ng-container>

            <ng-template #associerEtiquetteBlock>
              <span class="me-2" data-bs-toggle="modal" data-bs-target="#etiquette" style="cursor: pointer;">
                Associer étiquette
              </span>
              <i class="bi bi-plus-circle-dotted" data-bs-toggle="modal" data-bs-target="#etiquette"></i>
            </ng-template>
          </div>
          <div class="headerFacture">
            <div class="date-input">
              <label for="date">Date:&nbsp;</label>
              <input type="date" id="date" name="date" [(ngModel)]="date">
            </div>
            <div class="numero-input">
              <label for="numero">Numéro :&nbsp;</label>
              <input type="text" id="numero" name="nextNumber" [(ngModel)]="nextNumber" readonly>&nbsp;
              <i class="bi bi-gear" data-bs-toggle="modal" data-bs-target="#setting"></i>
            </div>
          </div>

          <div class="section" [class.visible]="currentStep >= 1">
            <div class="section-title">1. À qui je-vends ?</div>
            <label class="checkbox-label">
              <input type="checkbox">&nbsp; Ne pas associer un client à cette vente
            </label>
            <div class="input-group mb-5">
              <select class="form-select form-select-lg " id="client-select" [(ngModel)]="selectedClient"
                (change)="onClientSelected()" (input)="verifClientFonction()">
                <option *ngFor="let client of tabClient" [value]="client.id">{{client.prenom_client}}
                  {{client.nom_client}}</option>
              </select>
              <button type="button" class="btn ajouter" data-bs-toggle="modal" data-bs-target="#exampleModal">
                Ajouter un client
              </button>
            </div>
            <button class="suivant-btn btn mt-3" [disabled]="!exactClient" (click)="showStep(2)">Suivant ▼</button>
          </div>

          <div class="section" [class.visible]="currentStep >= 2">
            <div class="section-title">2. Quels produits / services ?</div>
            <div class="stepTwo" id="data">
              <div class="factureAssocier mb-5" *ngIf="numDevi">
                <input type="text" class="border border-0 mx-auto p-2 ms-3 mt-2" placeholder="Titre" name="titre"
                  [(ngModel)]="titre">
                <hr>
                <span class="p-2"> Vente provenant du devis N° {{numDevi}}</span>
              </div>
              <table class="table table-bordered border-light">
                <thead class="thead-custom">
                  <tr>
                    <th>Description</th>
                    <th>Quantité</th>
                    <th>PU</th>
                    <th>Réduction</th>
                    <th>TVA</th>
                    <th>Total HT</th>
                    <th>Total TTC</th>
                    <th *ngIf="!isPreview"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let row of rows; let i = index">
                    <td>
                      <div class="input-group mb-2 me-2">
                        <select class="form-control" [(ngModel)]="row.selectedProduct" (change)="onProductSelect(row)"
                          (change)="listeGrille(row)" (change)="listePriceByArticle(row)"
                          (input)="verifProduitFonction(row)">
                          <option value="0">Sélectionnez un produit/service</option>
                          <option *ngFor="let product of products" [value]="product.id">{{ product.nom_article }}
                          </option>
                        </select>
                        <div class="dropdown">
                          <button class="btn ajouter text-white dropdown-toggle" type="button" data-bs-toggle="dropdown"
                            aria-expanded="false">Ajouter</button>
                          <ul class="dropdown-menu">
                            <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#produit">Produit</a>
                            </li>
                            <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#service">Service</a>
                            </li>
                          </ul>
                        </div>
                      </div>
                    </td>
                    <td><input type="number" class="form-control" [(ngModel)]="row.quantity"
                        (input)="calculateTotal(row)" (input)="verifProduitFonction(row)"
                        (input)="calculateTotalTva(row)" placeholder="Quantité"></td>
                    <td>
                      <span *ngIf="row.promotionalPrice; else grillePrice">{{ row.promotionalPrice | number:'1.2-2'
                        }}</span>
                      <ng-template #grillePrice>
                        <span *ngIf="row.grillePrice; else regularPrice">{{ row.grillePrice | number:'1.2-2' }}</span>
                        <ng-template #regularPrice>
                          <span>{{ row.unitPrice | number:'1.2-2' }}</span>
                        </ng-template>
                      </ng-template>
                    </td>
                    <td><input type="number" class="form-control" [(ngModel)]="row.reductionArticle"
                        (input)="calculateTotal(row)" (input)="calculateTotalTva(row)"
                        (input)="verifProduitFonction(row)" placeholder="réduction"></td>
                    <td><input type="number" class="form-control" [(ngModel)]="row.tva" (input)="calculateTotalTva(row)"
                        (input)="verifProduitFonction(row)" placeholder="tva"></td>
                    <td><span class="text-right">{{row.total | number:'1.2-2' }}</span></td>
                    <td><span class="text-right">{{row.totalTTC | number:'1.2-2' }}</span></td>
                    <td *ngIf="!isPreview"><button class="btn btn-danger btnDelete btn-sm" (click)="deleteRow(i)"><i
                          class="bi bi-trash"></i></button></td>
                  </tr>
                  <!-- liste acompte du factute -->
                  <tr *ngFor="let acompte of tabAcompte" class="mt-3">
                    <td colspan="6">{{ acompte.titreAccomp }} - Facture N° {{ acompte.num_facture }} (du {{
                      acompte.dateEcheance }})</td>
                    <td>{{ acompte.montant | number:'1.2-2' }}</td>
                  </tr>
                </tbody>
              </table>
              <button class="btn " (click)="addRow()" *ngIf="!isPreview"><i class="bi bi-plus-circle me-1"></i> Ajouter
                une ligne
              </button>
              <div class="row mb-5">
                <div class="col-4 mt-5">
                  <div class="form-floating">
                    <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea2"
                      style="height: 100px" name="noteFacture" [(ngModel)]="noteFacture"></textarea>
                    <label for="floatingTextarea2">note</label>
                  </div>
                </div>
                <div class="col-8">
                  <br>
                  <br>
                  <table class="table table-sm text-right">
                    <tr>
                      <td><strong>Total HT</strong></td>
                      <td class="text-right"> <span class="font-weight-bold">{{ total | number:'1.2-2' }}</span> FCfa
                      </td>
                    </tr>
                    <tr>
                      <td><strong>TVA</strong></td>
                      <td class="text-right"> <span class="font-weight-bold">{{ totalTVA | number:'1.2-2' }}</span> FCfa
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Total TTC</strong></td>
                      <td class="text-right"> <span class="font-weight-bold">{{ totalTTC | number:'1.2-2' }}</span> FCfa
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Remise</strong></td>
                      <input type="number" name="remise" [(ngModel)]="remise" (input)="calculateGrandTotalAvecRemise()">
                    </tr>
                    <tr>
                      <td><strong>Total net à payer</strong></td>
                      <td class="text-right"> <span class="font-weight-bold">{{ totalRemise | number:'1.2-2' }}</span>
                        FCfa</td>
                    </tr>
                  </table>
                </div>
              </div>
              <button class="suivant-btn btn mt-3" type="button" [disabled]="!exactData" (click)="showStep(3)">Suivant
                ▼</button>
              <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button class="btn btnClose me-md-2" type="button" (click)="showStep(1)">Précédent ▲ </button>
              </div>
            </div>
          </div>

          <div class="section" [class.visible]="currentStep >= 3">
            <div class="section-title">3. Quand serai-je payé ?</div>
            <div class="stepThree" id="prix">
              <div class=" mx-auto mb-5">
                <div class="section-content radio-group">
                  <div class="-title">Type de paiement :</div>
                  <label><input type="radio" name="type-paiement" (click)="showComponant('factOne')" value="immediat"
                      [(ngModel)]="typePaiement"> Immediat</label>
                  <label><input type="radio" name="type-paiement" (click)="showComponant('factTwo')" value="echeance"
                      [(ngModel)]="typePaiement"> Une ou plusieurs échéances</label>
                  <label><input type="radio" name="type-paiement" (click)="showComponant('factThree')"
                      value="facture_Accompt" [(ngModel)]="typePaiement"> Une ou plusieurs factures d'acompte</label>
                </div>
                <div class=" factures" id="factOne" *ngIf="currentContent==='factOne'">
                  <div class="row g-3 align-items-center">
                    <div class="col-auto">
                      <label for="inputPassword6" class="col-form-label">Moyen de paiement</label>
                      <select class="form-select form-select-lg" id="client-select" placeholder="Type de paiement..."
                        [(ngModel)]="moyenPayement">
                        <option *ngFor="let paye of tabPayement" [value]="paye.id">{{paye.nom_payement}}</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class=" Échéance text-center w-75 mx-auto p-2" id="factTwo" *ngIf="currentContent==='factTwo'">
                  <span class="font-weight-bold"> <strong>Total net à payer</strong> {{ totalRemise | number:'1.2-2'
                    }}</span> FCfa <br>
                  <div class="row">
                    <ng-container class="mb-2" *ngFor="let item of input; let i = index">
                      <div class="col-2"><label for="echeance1" class="me-1">Échéance {{i+1}}: </label></div>
                      <div class="col-4"><input type="date" id="echeance1" class="me-2" value=""
                          [(ngModel)]="item.date"></div>
                      <div class="col-4"><input type="number" id="montant1" class="me-2" value=""
                          [(ngModel)]="item.prix"> </div>
                      <div class="col-2"><i class="bi bi-x-lg" style="color: red; cursor: pointer;"
                          (click)="deleteInput(i)"></i></div>
                    </ng-container>
                    <span (click)="addInput()" style="cursor: pointer;"><i
                        class="bi bi-plus-circle me-2"></i>ajouter</span>
                  </div>
                </div>
                <div class=" factures w-75 mx-auto p-2" id="factThree" *ngIf="currentContent==='factThree'">
                  <div class="section-title">Factures d'acompte :</div>
                  <table>
                    <tr>
                      <th>Numéro</th>
                      <th>Date</th>
                      <th>Montant</th>
                    </tr>
                    <tr *ngFor="let acompte of tabAcompte" class="mt-3">
                      <td>{{ acompte.titreAccomp }} - Facture N° {{ acompte.num_facture }} (du {{ acompte.dateEcheance
                        }})</td>
                      <td>{{ acompte.dateEcheance }}</td>
                      <td>{{ acompte.montant | number:'1.2-2' }}</td>
                    </tr>
                  </table>
                  <div class="section-content mt-2 mb-2">
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btnSecond" data-bs-toggle="modal" data-bs-target="#echeance">
                      Ajouter Facture d'accompte
                    </button>
                  </div>
                </div>
              </div>
              <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button class="btn btnClose me-md-2" type="button" (click)="showStep(2)">Précédent ▲ </button>
                <button class="btn btnAction" type="button" (click)="createFacture()">Sauvegarder</button>
                <!-- [disabled]="!exactData"  -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal facture d'avoir -->
<div class="modal fade mt-5" id="FactureAvoir" tabindex="-1" aria-labelledby="FactureAvoirLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
    <div class="modal-content">
      <div class="bgHeader">
        <div class="d-flex justify-content-between p-2">
          <h4 class="modal-title" id="exampleModalLabel">Facture d'avoir</h4>
          <div><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
        </div>
      </div>
      <div class="modal-body">
        <div class="invoice-form containerFacture">
          <div class="d-flex mb-2">
            <div class="p-3 flex-grow-1">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                <label class="form-check-label" for="flexSwitchCheckDefault">Actif</label>
              </div>
            </div>
            <ng-container *ngIf="etiquettes.length > 0; else associerEtiquetteBlock" class="etiquettes">
              <span *ngFor="let etiq of etiquettes; let i = index" [ngStyle]="{'background-color': etiq.couleur}"
                class="etiquette me-2">
                {{ etiq.nom }}
                <i class="bi bi-x-lg text-light" (click)="supprimerEtiquette(i)"></i>
              </span>
              <i class="bi bi-plus-circle-dotted" data-bs-toggle="modal" data-bs-target="#etiquette"></i>
            </ng-container>

            <ng-template #associerEtiquetteBlock>
              <span class="me-2" data-bs-toggle="modal" data-bs-target="#etiquette" style="cursor: pointer;">
                Associer étiquette
              </span>
              <i class="bi bi-plus-circle-dotted" data-bs-toggle="modal" data-bs-target="#etiquette"></i>
            </ng-template>
          </div>
          <div class="headerFacture">
            <div class="date-input">
              <label for="date">Date:&nbsp;</label>
              <input type="date" id="date" name="date" [(ngModel)]="date">
            </div>
            <div class="numero-input">
              <label for="numero">Numéro :&nbsp;</label>
              <input type="text" id="numero" name="nextNumber" [(ngModel)]="nextNumber" readonly>&nbsp;
              <i class="bi bi-gear" data-bs-toggle="modal" data-bs-target="#setting"></i>
            </div>
          </div>

          <div class="client-section">
            <button class="associate-client" data-bs-toggle="modal" data-bs-target="#client" *ngIf="!currentClient">+
              Associer Client</button>

            <div class="client-info" *ngFor="let clientSelect of currentClient">
              <input type="text" value="{{clientSelect?.prenom_client}} {{clientSelect?.nom_client}}" readonly>
              <div class="client-details">
                <p class="me-3 ms-3">Adresse : {{clientSelect?.adress_client}}</p>
                <p class="me-3 ms-3">Téléphone : {{clientSelect?.tel_client}}</p>
                <p class="me-3 ms-3">Entreprise : {{clientSelect?.nom_entreprise}}</p>
              </div>
            </div>
          </div>

          <div class="title-section" data-bs-toggle="modal" data-bs-target="#factureClient"
            *ngIf="!numeroFacture && currentClient ">
            <a style="cursor:pointer;" (click)='listeFactureClient()'>+ Associer une vente de ce client à cette note de
              crédit</a>
          </div>

          <div class="factureAssocier mb-5" *ngIf="numeroFacture">
            <input type="text" class="border border-0 mx-auto p-2 ms-3 mt-2" placeholder="Titre" name="titre"
              [(ngModel)]="titre">
            <hr>
            <span class="p-2">Note de crédit associée à la Vente/Facture N° {{numeroFacture}}</span>
          </div>

          <table class="table table-bordered border-light">
            <thead class="thead-custom">
              <tr>
                <th>Description</th>
                <th>Quantité</th>
                <th>PU</th>
                <th>Réduction</th>
                <th>TVA</th>
                <th>Total HT</th>
                <th>Total TTC</th>
                <th *ngIf="!isPreview"></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let article of article; let i = index">
                <td>{{article.nom_article}}</td>
                <td>
                  <input [(ngModel)]="article.quantite_article" (ngModelChange)="recalculerPrix(i)" type="number"
                    min="0">
                </td>
                <td>{{article.prix_unitaire_article}}</td>
                <td>{{article.remise || 0}}</td>
                <td>{{article.TVA || 0}}</td>
                <td *ngIf="detailFacture">{{-detailFacture.prix_HT | number:'1.2-2'}}</td>
                <td>{{-article.prix_total_tva_article | number:'1.2-2'}}</td>
              </tr>

            </tbody>
          </table>


          <div class="total-section">
            <span>Total</span>
            <span *ngIf="detailFacture">{{-detailFacture.prix_TTC | number:'1.2-2' }} FCfa</span>
          </div>

          <div class="comment-section">
            <textarea placeholder="Commentaire (affiché dans la facture) :" name="commentaire"
              [(ngModel)]="commentaire"></textarea>
            <textarea placeholder="Note interne :"></textarea>
          </div>

          <a style="cursor:pointer;" data-bs-toggle="modal" data-bs-target="#solde"> + Créer un solde en faveur du
            client correspondant à cette note de crédit</a>

        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btnAction" (click)="createFactureAvoir()">Ajouter</button>
        <button type="button" class="btn btnClose" data-bs-dismiss="modal">Annuler</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal facture recurrente -->
<div class="modal fade mt-5" id="FactureRecurrente" tabindex="-1" aria-labelledby="FactureRecurrenteLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
    <div class="modal-content">
      <div class="bgHeader">
        <div class="d-flex justify-content-between p-2">
          <h4 class="modal-title" id="exampleModalLabel">Facture Recurrente</h4>
          <div><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
        </div>
      </div>
      <div class="modal-body">
        <div class="containerFacture">
          <div class="d-flex mb-2">
            <div class="p-3 flex-grow-1">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                <label class="form-check-label" for="flexSwitchCheckDefault">Actif</label>
              </div>
            </div>
            <ng-container *ngIf="etiquettes.length > 0; else associerEtiquetteBlock" class="etiquettes">
              <span *ngFor="let etiq of etiquettes; let i = index" [ngStyle]="{'background-color': etiq.couleur}"
                class="etiquette me-2">
                {{ etiq.nom }}
                <i class="bi bi-x-lg text-light" (click)="supprimerEtiquette(i)"></i>
              </span>
              <i class="bi bi-plus-circle-dotted" data-bs-toggle="modal" data-bs-target="#etiquette"></i>
            </ng-container>

            <ng-template #associerEtiquetteBlock>
              <span class="me-2" data-bs-toggle="modal" data-bs-target="#etiquette" style="cursor: pointer;">
                Associer étiquette
              </span>
              <i class="bi bi-plus-circle-dotted" data-bs-toggle="modal" data-bs-target="#etiquette"></i>
            </ng-template>
          </div>
          <div class="popup-vente mb-5">
            <span class="txt-title">Ces ventes doivent être crées:</span>
            <div class="checkbox1">
              <div class="vente">
                <div>
                  <label class="checkbox-wrapper">
                    <input checked="" type="checkbox" id="check" hidden="">
                    <label for="check" class="checkmark"></label>
                  </label>
                </div>
                <div>
                  <p>Une vente tous les jours</p>
                </div>

              </div>
              <div class="duree">
                <input class="check1" type="number" name="periode" [(ngModel)]="periode">
                <select name="" id="" name="durePeriode" class="check2" [(ngModel)]="durePeriode">
                  <option value="jour">Jour</option>
                  <option value="semaine">Semaine</option>
                  <option value="mois">Mois</option>
                </select>
              </div>
            </div>
            <div class="date">
              <span>A partir du:&nbsp;&nbsp;</span>
              <input type="date" name="date" [(ngModel)]="date">
            </div>
            <br>
            <!-- checkbox 2 -->
            <div class="form-check">
              <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2"
                value="creer_brouillon" name="brouillon" [(ngModel)]="brouillon" checked>
              <label class="form-check-label" for="flexRadioDefault2">
                Créer ces ventes à l'état BROUILLON
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1"
                value="envoyer_email" name="mail" [(ngModel)]="brouillon">
              <label class="form-check-label" for="flexRadioDefault1">
                Envoyer automatiquement au mail du client
              </label>
            </div>
          </div>

          <div class="section" [class.visible]="currentStep >= 1">
            <div class="section-title">1. À qui je-vends ?</div>
            <label class="checkbox-label">
              <input type="checkbox">&nbsp; Ne pas associer un client à cette vente
            </label>
            <div class="input-group mb-5">
              <select class="form-select form-select-lg " id="client-select" [(ngModel)]="selectedClient"
                (change)="onClientSelected()" (input)="verifClientFonction()">
                <option *ngFor="let client of tabClient" [value]="client.id">{{client.prenom_client}}
                  {{client.nom_client}}</option>
              </select>
              <button type="button" class="btn ajouter" data-bs-toggle="modal" data-bs-target="#exampleModal">
                Ajouter un client
              </button>
            </div>
            <button class="suivant-btn btn mt-3" [disabled]="!exactClient" (click)="showStep(2)">Suivant ▼</button>
          </div>

          <div class="section">
            <div class="section-title">2. Quels produits / services ?</div>
            <div class="stepTwo" id="data" [class.visible]="currentStep >= 2">
              <table class="table table-bordered border-light">
                <thead class="thead-custom">
                  <tr>
                    <th>Description</th>
                    <th>Quantité</th>
                    <th>PU</th>
                    <th>Réduction</th>
                    <th>TVA</th>
                    <th>Total HT</th>
                    <th>Total TTC</th>
                    <th *ngIf="!isPreview"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let row of rows; let i = index">
                    <td>
                      <div class="input-group mb-2 me-2">
                        <select class="form-control" [(ngModel)]="row.selectedProduct" (change)="onProductSelect(row)"
                          (change)="listeGrille(row)" (change)="listePriceByArticle(row)"
                          (input)="verifProduitFonction(row)">
                          <option value="0">Sélectionnez un produit/service</option>
                          <option *ngFor="let product of products" [value]="product.id">{{ product.nom_article }}
                          </option>
                        </select>
                        <div class="dropdown">
                          <button class="btn ajouter text-white dropdown-toggle" type="button" data-bs-toggle="dropdown"
                            aria-expanded="false">Ajouter</button>
                          <ul class="dropdown-menu">
                            <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#produit">Produit</a>
                            </li>
                            <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#service">Service</a>
                            </li>
                          </ul>
                        </div>
                      </div>
                    </td>
                    <td><input type="number" class="form-control" [(ngModel)]="row.quantity"
                        (input)="calculateTotal(row)" (input)="verifProduitFonction(row)"
                        (input)="calculateTotalTva(row)" placeholder="Quantité"></td>
                    <td>
                      <span *ngIf="row.promotionalPrice; else grillePrice">{{ row.promotionalPrice | number:'1.2-2'
                        }}</span>
                      <ng-template #grillePrice>
                        <span *ngIf="row.grillePrice; else regularPrice">{{ row.grillePrice | number:'1.2-2' }}</span>
                        <ng-template #regularPrice>
                          <span>{{ row.unitPrice | number:'1.2-2' }}</span>
                        </ng-template>
                      </ng-template>
                    </td>
                    <td><input type="number" class="form-control" [(ngModel)]="row.reductionArticle"
                        (input)="calculateTotal(row)" (input)="calculateTotalTva(row)"
                        (input)="verifProduitFonction(row)" placeholder="réduction"></td>
                    <td><input type="number" class="form-control" [(ngModel)]="row.tva" (input)="calculateTotalTva(row)"
                        (input)="verifProduitFonction(row)" placeholder="tva"></td>
                    <td><span class="text-right">{{row.total | number:'1.2-2' }}</span></td>
                    <td><span class="text-right">{{row.totalTTC | number:'1.2-2' }}</span></td>
                    <td *ngIf="!isPreview"><button class="btn btn-danger btnDelete btn-sm" (click)="deleteRow(i)"><i
                          class="bi bi-trash"></i></button></td>
                  </tr>
                  <!-- liste acompte du factute -->
                  <tr *ngFor="let acompte of tabAcompte" class="mt-3">
                    <td colspan="6">{{ acompte.titreAccomp }} - Facture N° {{ acompte.num_facture }} (du {{
                      acompte.dateEcheance }})</td>
                    <td>{{ acompte.montant | number:'1.2-2' }}</td>
                  </tr>
                </tbody>
              </table>
              <button class="btn " (click)="addRow()" *ngIf="!isPreview"><i class="bi bi-plus-circle me-1"></i> Ajouter
                une ligne
              </button>
              <div class="row mb-5">
                <div class="col-4 mt-5">
                  <!-- <div class="form-floating">
                      <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px"
                        name="noteFacture" [(ngModel)]="noteFacture"></textarea>
                      <label for="floatingTextarea2">note</label>
                    </div> -->
                </div>
                <div class="col-8">
                  <br>
                  <br>
                  <table class="table table-sm text-right">
                    <tr>
                      <td><strong>Total HT</strong></td>
                      <td class="text-right"> <span class="font-weight-bold">{{ total | number:'1.2-2' }}</span> FCfa
                      </td>
                    </tr>
                    <tr>
                      <td><strong>TVA</strong></td>
                      <td class="text-right"> <span class="font-weight-bold">{{ totalTVA | number:'1.2-2' }}</span> FCfa
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Total TTC</strong></td>
                      <td class="text-right"> <span class="font-weight-bold">{{ totalTTC | number:'1.2-2' }}</span> FCfa
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Remise</strong></td>
                      <input type="number" name="remise" [(ngModel)]="remise" (input)="calculateGrandTotalAvecRemise()">
                    </tr>
                    <tr>
                      <td><strong>Total net à payer</strong></td>
                      <td class="text-right"> <span class="font-weight-bold">{{ totalRemise | number:'1.2-2' }}</span>
                        FCfa</td>
                    </tr>
                  </table>
                </div>
                <div class="comment-section">
                  <textarea placeholder="Commentaire (affiché dans la facture) :" name="commentaire"
                    [(ngModel)]="commentaire"></textarea>
                  <textarea placeholder="Note interne :" name="note" [(ngModel)]="note"></textarea>
                </div>
                <p class="stock-info">Ce document peut modifier le stock de vos produits</p>
              </div>
              <button class="suivant-btn btn mt-3" type="button" [disabled]="!exactData" (click)="showStep(3)">Suivant
                ▼</button>
              <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button class="btn btnClose me-md-2" type="button" (click)="showStep(1)">Précédent ▲ </button>
              </div>
            </div>

          </div>


        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btnAction" (click)="createFactureRecurrente()">Ajouter</button>
        <button type="button" class="btn btnClose" data-bs-dismiss="modal">Annuler</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal creation Dévis -->
<div class="modal fade mt-5" id="devis" tabindex="-1" aria-labelledby="devisLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered  modal-xl">
    <div class="modal-content">
      <div class="bgHeader">
        <div class="d-flex justify-content-between p-2">
          <h4 class="modal-title" id="exampleModalLabel">{{titre}}</h4>
          <div><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
        </div>
      </div>
      <div class="modal-body ">
        <div class="seeFact" data-bs-toggle="modal" data-bs-target="#seeModéle">
          <i class="bi bi-eye"></i>
        </div>
        <div class="containerFacture">
          <div class="d-flex mb-2">
            <div class="p-3 flex-grow-1">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                <label class="form-check-label" for="flexSwitchCheckDefault">Actif</label>
              </div>
            </div>
            <ng-container *ngIf="etiquettes.length > 0; else associerEtiquetteBlock" class="etiquettes">
              <span *ngFor="let etiq of etiquettes; let i = index" [ngStyle]="{'background-color': etiq.couleur}"
                class="etiquette me-2">
                {{ etiq.nom }}
                <i class="bi bi-x-lg text-light" (click)="supprimerEtiquette(i)"></i>
              </span>
              <i class="bi bi-plus-circle-dotted" data-bs-toggle="modal" data-bs-target="#etiquette"></i>
            </ng-container>

            <ng-template #associerEtiquetteBlock>
              <span class="me-2" data-bs-toggle="modal" data-bs-target="#etiquette" style="cursor: pointer;">
                Associer étiquette
              </span>
              <i class="bi bi-plus-circle-dotted" data-bs-toggle="modal" data-bs-target="#etiquette"></i>
            </ng-template>
          </div>
          <div class="headerFacture">
            <div class="date-inputs">
              <div class="date-input">
                <label for="date-devis">Date du devis :</label>
                <input type="date" id="date-devis" name=datedevis [(ngModel)]="datedevis">
              </div>
              <div class="date-input">
                <label for="date-validite">Valable jusqu'au :</label>
                <input type="date" id="date-validite" name="datevaliditeDevis" [(ngModel)]="datevaliditeDevis">
              </div>
            </div>
            <div class="numero-input">
              <label for="numero">Numéro :&nbsp;</label>
              <input type="text" id="numero" [(ngModel)]="nextNumberDevis" readonly>&nbsp;
              <i class="bi bi-gear" data-bs-toggle="modal" data-bs-target="#settingDevis"></i>
            </div>
          </div>

          <div class="section" [class.visible]="currentStep >= 1">
            <div class="section-title">1. À qui je-vends ?</div>
            <label class="checkbox-label">
              <input type="checkbox">&nbsp; Ne pas associer un client à cette vente
            </label>
            <div class="input-group mb-5">
              <select class="form-select form-select-lg " id="client-select" [(ngModel)]="selectedClient"
                (change)="onClientSelected()" (input)="verifClientFonction()">
                <option *ngFor="let client of tabClient" [value]="client.id">{{client.prenom_client}}
                  {{client.nom_client}}</option>
              </select>
              <button type="button" class="btn ajouter" data-bs-toggle="modal" data-bs-target="#exampleModal">
                Ajouter un client
              </button>
            </div>
            <button class="suivant-btn btn mt-3" [disabled]="!exactClient" (click)="showStep(2)">Suivant ▼</button>
          </div>

          <div class="section" [class.visible]="currentStep >= 2">
            <div class="section-title">2. Quels produits / services ?</div>
            <div class="stepTwo" id="data">
              <table class="table table-bordered border-light">
                <thead class="thead-custom">
                  <tr>
                    <th>Description</th>
                    <th>Quantité</th>
                    <th>PU</th>
                    <th>Réduction</th>
                    <th>TVA</th>
                    <th>Total HT</th>
                    <th>Total TTC</th>
                    <th *ngIf="!isPreview"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let row of rows; let i = index">
                    <td>
                      <div class="input-group mb-2 me-2">
                        <select class="form-control" [(ngModel)]="row.selectedProduct" (change)="onProductSelect(row)"
                          (change)="listeGrille(row)" (change)="listePriceByArticle(row)"
                          (input)="verifProduitFonction(row)">
                          <option value="0">Sélectionnez un produit/service</option>
                          <option *ngFor="let product of products" [value]="product.id">{{ product.nom_article }}
                          </option>
                        </select>
                        <div class="dropdown">
                          <button class="btn ajouter text-white dropdown-toggle" type="button" data-bs-toggle="dropdown"
                            aria-expanded="false">Ajouter</button>
                          <ul class="dropdown-menu">
                            <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#produit">Produit</a>
                            </li>
                            <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#service">Service</a>
                            </li>
                          </ul>
                        </div>
                      </div>
                    </td>
                    <td><input type="number" class="form-control" [(ngModel)]="row.quantity"
                        (input)="calculateTotal(row)" (input)="verifProduitFonction(row)"
                        (input)="calculateTotalTva(row)" placeholder="Quantité"></td>
                    <td>
                      <span *ngIf="row.promotionalPrice; else grillePrice">{{ row.promotionalPrice | number:'1.2-2'
                        }}</span>
                      <ng-template #grillePrice>
                        <span *ngIf="row.grillePrice; else regularPrice">{{ row.grillePrice | number:'1.2-2' }}</span>
                        <ng-template #regularPrice>
                          <span>{{ row.unitPrice | number:'1.2-2' }}</span>
                        </ng-template>
                      </ng-template>
                    </td>
                    <td><input type="number" class="form-control" [(ngModel)]="row.reductionArticle"
                        (input)="calculateTotal(row)" (input)="calculateTotalTva(row)"
                        (input)="verifProduitFonction(row)" placeholder="réduction"></td>
                    <td><input type="number" class="form-control" [(ngModel)]="row.tva" (input)="calculateTotalTva(row)"
                        (input)="verifProduitFonction(row)" placeholder="tva"></td>
                    <td><span class="text-right">{{row.total | number:'1.2-2' }}</span></td>
                    <td><span class="text-right">{{row.totalTTC | number:'1.2-2' }}</span></td>
                    <td *ngIf="!isPreview"><button class="btn btn-danger btnDelete btn-sm" (click)="deleteRow(i)"><i
                          class="bi bi-trash"></i></button></td>
                  </tr>
                  <!-- liste acompte du factute -->
                  <tr *ngFor="let acompte of tabAcompte" class="mt-3">
                    <td colspan="6">{{ acompte.titreAccomp }} - Facture N° {{ acompte.num_facture }} (du {{
                      acompte.dateEcheance }})</td>
                    <td>{{ acompte.montant | number:'1.2-2' }}</td>
                  </tr>
                </tbody>
              </table>
              <button class="btn " (click)="addRow()" *ngIf="!isPreview"><i class="bi bi-plus-circle me-1"></i> Ajouter
                une ligne
              </button>
              <div class="row mb-5">
                <div class="col-4 mt-5">
                  <div class="form-floating">
                    <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea2"
                      style="height: 100px" name="noteFacture" [(ngModel)]="noteFacture"></textarea>
                    <label for="floatingTextarea2">note</label>
                  </div>
                </div>
                <div class="col-8">
                  <br>
                  <br>
                  <table class="table table-sm text-right">
                    <tr>
                      <td><strong>Total HT</strong></td>
                      <td class="text-right"> <span class="font-weight-bold">{{ total | number:'1.2-2' }}</span> FCfa
                      </td>
                    </tr>
                    <tr>
                      <td><strong>TVA</strong></td>
                      <td class="text-right"> <span class="font-weight-bold">{{ totalTVA | number:'1.2-2' }}</span> FCfa
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Total TTC</strong></td>
                      <td class="text-right"> <span class="font-weight-bold">{{ totalTTC | number:'1.2-2' }}</span> FCfa
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Remise</strong></td>
                      <input type="number" name="remise" [(ngModel)]="remise" (input)="calculateGrandTotalAvecRemise()">
                    </tr>
                    <tr>
                      <td><strong>Total net à payer</strong></td>
                      <td class="text-right"> <span class="font-weight-bold">{{ totalRemise | number:'1.2-2' }}</span>
                        FCfa</td>
                    </tr>
                  </table>
                </div>
              </div>
              <button class="suivant-btn btn mt-3" type="button" [disabled]="!exactData" (click)="showStep(3)">Suivant
                ▼</button>
              <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button class="btn btnClose me-md-2" type="button" (click)="showStep(1)">Précédent ▲ </button>
              </div>
            </div>
          </div>

          <div class="section" id="prix" [class.visible]="currentStep >= 3">
            <div class="actions">
              <a href="#" data-bs-toggle="modal" data-bs-target="#echanceDevis">Associer un échéancier</a>
              <a href="#" data-bs-toggle="modal" data-bs-target="#acoompteDevis">Associer une facture d'acompte</a>
            </div>
            <div class="buttons">
              <button class="btn btn-primary" (click)=" createDevis()">Valider devis</button>
            </div>
            <button class="btn suivant-btn mt-3" type="button" (click)="showStep(2)">Précédent ▲ </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal creation Bon de commande -->
<div class="modal fade mt-5" id="bonCommande" tabindex="-1" aria-labelledby="bonCommandeLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered  modal-xl">
    <div class="modal-content">
      <div class="bgHeader">
        <div class="d-flex justify-content-between p-2">
          <h4 class="modal-title" id="exampleModalLabel">{{titre}}</h4>
          <div><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
        </div>
      </div>
      <div class="modal-body ">
        <div class="seeFact" data-bs-toggle="modal" data-bs-target="#seeModéle">
          <i class="bi bi-eye"></i>
        </div>
        <div class="containerBonCommande containerFacture">
          <div class="d-flex mb-2">
            <div class="p-3 flex-grow-1">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                <label class="form-check-label" for="flexSwitchCheckDefault">Actif</label>
              </div>
            </div>
            <ng-container *ngIf="etiquettes.length > 0; else associerEtiquetteBlock" class="etiquettes">
              <span *ngFor="let etiq of etiquettes; let i = index" [ngStyle]="{'background-color': etiq.couleur}"
                class="etiquette me-2">
                {{ etiq.nom }}
                <i class="bi bi-x-lg text-light" (click)="supprimerEtiquette(i)"></i>
              </span>
              <i class="bi bi-plus-circle-dotted" data-bs-toggle="modal" data-bs-target="#etiquette"></i>
            </ng-container>

            <ng-template #associerEtiquetteBlock>
              <span class="me-2" data-bs-toggle="modal" data-bs-target="#etiquette" style="cursor: pointer;">
                Associer étiquette
              </span>
              <i class="bi bi-plus-circle-dotted" data-bs-toggle="modal" data-bs-target="#etiquette"></i>
            </ng-template>
          </div>
          <div class="headerFacture">
            <div class="date-inputs">
              <div class="date-input">
                <label for="date-devis">Date commande :</label>
                <input type="date" id="date-devis" name=datedevis [(ngModel)]="datedevis">
              </div>
              <div class="date-input">
                <label for="date-validite">Date livraison :</label>
                <input type="date" id="date-validite" name="datevaliditeDevis" [(ngModel)]="datevaliditeDevis">
              </div>
            </div>
            <div class="numero-input">
              <label for="numero">Numéro :&nbsp;</label>
              <input type="text" id="numero" [(ngModel)]="nextNumberBonCommande" readonly>&nbsp;
              <i class="bi bi-gear" data-bs-toggle="modal" data-bs-target="#settingBonCommande"></i>
            </div>
          </div>

          <div class="client-section w-50">
            <button class="associate-client" data-bs-toggle="modal" data-bs-target="#clientboncommande"
              *ngIf="!currentClient">+ Associer Client</button>

            <div class="client-info" *ngFor="let clientSelect of currentClient">
              <input type="text" value="{{clientSelect?.prenom_client}} {{clientSelect?.nom_client}}" readonly>
              <div class="client-details">
                <p class="me-3 ms-3">Adresse : {{clientSelect?.adress_client}}</p>
                <p class="me-3 ms-3">Téléphone : {{clientSelect?.tel_client}}</p>
                <p class="me-3 ms-3">Entreprise : {{clientSelect?.nom_entreprise}}</p>
              </div>
            </div>
          </div>

          <table>
            <thead>
              <tr>
                <th>Description</th>
                <th>Quantité</th>
                <th>PU</th>
                <th>TVA</th>
                <th>Total HT</th>
                <th>Total TTC</th>
                <th *ngIf="!isPreview"></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of rows; let i = index">
                <td>
                  <div class="input-group mb-2 me-2">
                    <select class="form-control" [(ngModel)]="row.selectedProduct" (change)="onProductSelect(row)"
                      (change)="listeGrille(row)" (change)="listePriceByArticle(row)"
                      (input)="verifProduitFonction(row)">
                      <option value="0">Sélectionnez un produit/service</option>
                      <option *ngFor="let product of products" [value]="product.id">{{ product.nom_article }}</option>
                    </select>
                    <div class="dropdown">
                      <button class="btn ajouter text-white dropdown-toggle" type="button" data-bs-toggle="dropdown"
                        aria-expanded="false">Ajouter</button>
                      <ul class="dropdown-menu">
                        <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#produit">Produit</a></li>
                        <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#service">Service</a></li>
                      </ul>
                    </div>
                  </div>
                </td>
                <td><input type="number" class="form-control" [(ngModel)]="row.quantity" (input)="calculateTotal(row)"
                    (input)="verifProduitFonction(row)" (input)="calculateTotalTva(row)" placeholder="Quantité"></td>
                <td>
                  <span *ngIf="row.promotionalPrice; else grillePrice">{{ row.promotionalPrice | number:'1.2-2'
                    }}</span>
                  <ng-template #grillePrice>
                    <span *ngIf="row.grillePrice; else regularPrice">{{ row.grillePrice | number:'1.2-2' }}</span>
                    <ng-template #regularPrice>
                      <span>{{ row.unitPrice | number:'1.2-2' }}</span>
                    </ng-template>
                  </ng-template>
                </td>
                <td><input type="number" class="form-control" [(ngModel)]="row.tva" (input)="calculateTotalTva(row)"
                    (input)="verifProduitFonction(row)" placeholder="tva"></td>
                <td><span class="text-right">{{row.total | number:'1.2-2' }}</span></td>
                <td><span class="text-right">{{row.totalTTC | number:'1.2-2' }}</span></td>
                <td *ngIf="!isPreview"><button class="btn btn-danger btnDelete btn-sm" (click)="deleteRow(i)"><i
                      class="bi bi-trash"></i></button></td>
              </tr>
            </tbody>
          </table>

          <div class="add-line" (click)="addRow()">
            + Nouvelle ligne
          </div>

          <div class="row">
            <div class="form-group col-4">
              <label for="commentaire">Commentaire:</label>
              <textarea id="commentaire" class="comment-box" name="noteFacture" [(ngModel)]="noteFacture"></textarea>
            </div>
            <div class="col-8">
              <br>
              <br>
              <table class="table table-sm text-right">
                <tr>
                  <td><strong>Total HT</strong></td>
                  <td class="text-right"> <span class="font-weight-bold">{{ total | number:'1.2-2' }}</span> FCfa</td>
                </tr>
                <tr>
                  <td><strong>TVA</strong></td>
                  <td class="text-right"> <span class="font-weight-bold">{{ totalTVA | number:'1.2-2' }}</span> FCfa
                  </td>
                </tr>
                <tr>
                  <td><strong>Total TTC</strong></td>
                  <td class="text-right"> <span class="font-weight-bold">{{ totalTTC | number:'1.2-2' }}</span> FCfa
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="actions">
            <a href="#" data-bs-toggle="modal" data-bs-target="#echanceBonCommande">Associer un échéancier</a>
          </div>
          <button class="button" (click)=" createBonCommande()">Commande réalisée</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal creation Bon de livraison -->
<div class="modal fade mt-5" id="livraison" tabindex="-1" aria-labelledby="livraisonLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered  modal-xl">
    <div class="modal-content">
      <div class="bgHeader">
        <div class="d-flex justify-content-between p-2">
          <h4 class="modal-title" id="exampleModalLabel">{{titre}}</h4>
          <div><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
        </div>
      </div>
      <div class="modal-body ">
        <div class="seeFact" data-bs-toggle="modal" data-bs-target="#seeModéle">
          <i class="bi bi-eye"></i>
        </div>
        <div class="containerBonCommande containerFacture">
          <div class="d-flex mb-2">
            <div class="p-3 flex-grow-1">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                <label class="form-check-label" for="flexSwitchCheckDefault">Actif</label>
              </div>
            </div>
            <ng-container *ngIf="etiquettes.length > 0; else associerEtiquetteBlock" class="etiquettes">
              <span *ngFor="let etiq of etiquettes; let i = index" [ngStyle]="{'background-color': etiq.couleur}"
                class="etiquette me-2">
                {{ etiq.nom }}
                <i class="bi bi-x-lg text-light" (click)="supprimerEtiquette(i)"></i>
              </span>
              <i class="bi bi-plus-circle-dotted" data-bs-toggle="modal" data-bs-target="#etiquette"></i>
            </ng-container>

            <ng-template #associerEtiquetteBlock>
              <span class="me-2" data-bs-toggle="modal" data-bs-target="#etiquette" style="cursor: pointer;">
                Associer étiquette
              </span>
              <i class="bi bi-plus-circle-dotted" data-bs-toggle="modal" data-bs-target="#etiquette"></i>
            </ng-template>
          </div>
          <div class="headerFacture">
            <div class="date-inputs">
              <div class="date-input">
                <label for="date-devis">Date livraison :</label>
                <input type="date" id="date-devis" name=datedevis [(ngModel)]="datedevis">
              </div>
            </div>
            <div class="numero-input">
              <label for="numero">Numéro :&nbsp;</label>
              <input type="text" id="numero" [(ngModel)]="nextNumberBonLivraison" readonly>&nbsp;
              <i class="bi bi-gear" data-bs-toggle="modal" data-bs-target="#settinglLivraison"></i>
            </div>
          </div>


          <div class="d-md-flex">
            <div class="client-section w-50 me-2">
              <button class="associate-client" data-bs-toggle="modal" data-bs-target="#clientLivraison"
                *ngIf="!currentClient">+ Associer Client</button>

              <div class="client-info" *ngFor="let clientSelect of currentClient">
                <input type="text" value="{{clientSelect?.prenom_client}} {{clientSelect?.nom_client}}" readonly>
                <div class="client-details">
                  <p class="me-3 ms-3">Adresse : {{clientSelect?.adress_client}}</p>
                  <p class="me-3 ms-3">Téléphone : {{clientSelect?.tel_client}}</p>
                  <p class="me-3 ms-3">Entreprise : {{clientSelect?.nom_entreprise}}</p>
                </div>
              </div>
            </div>

            <!-- <div class="client-section w-50">
              <button class="associate-client"  *ngIf="!currentClient">+ Associer Transporteur</button>
  
              <div class="client-info"  *ngFor="let clientSelect of currentClient">
                <input type="text" value="{{clientSelect?.prenom_client}} {{clientSelect?.nom_client}}"  readonly>
                <div class="client-details">
                  <p class="me-3 ms-3">Adresse : {{clientSelect?.adress_client}}</p>
                  <p class="me-3 ms-3">Téléphone : {{clientSelect?.tel_client}}</p>
                  <p class="me-3 ms-3">Entreprise : {{clientSelect?.nom_entreprise}}</p>
                </div>
              </div>
            </div> -->
          </div>

          <table>
            <thead>
              <tr>
                <th>Description</th>
                <th>Quantité</th>
                <th>PU</th>
                <th>TVA</th>
                <th>Total HT</th>
                <th>Total TTC</th>
                <th *ngIf="!isPreview"></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of rows; let i = index">
                <td>
                  <div class="input-group mb-2 me-2">
                    <select class="form-control" [(ngModel)]="row.selectedProduct" (change)="onProductSelect(row)"
                      (change)="listeGrille(row)" (change)="listePriceByArticle(row)"
                      (input)="verifProduitFonction(row)">
                      <option value="0">Sélectionnez un produit/service</option>
                      <option *ngFor="let product of products" [value]="product.id">{{ product.nom_article }}</option>
                    </select>
                    <div class="dropdown">
                      <button class="btn ajouter text-white dropdown-toggle" type="button" data-bs-toggle="dropdown"
                        aria-expanded="false">Ajouter</button>
                      <ul class="dropdown-menu">
                        <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#produit">Produit</a></li>
                        <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#service">Service</a></li>
                      </ul>
                    </div>
                  </div>
                </td>
                <td><input type="number" class="form-control" [(ngModel)]="row.quantity" (input)="calculateTotal(row)"
                    (input)="verifProduitFonction(row)" (input)="calculateTotalTva(row)" placeholder="Quantité"></td>
                <td>
                  <span *ngIf="row.promotionalPrice; else grillePrice">{{ row.promotionalPrice | number:'1.2-2'
                    }}</span>
                  <ng-template #grillePrice>
                    <span *ngIf="row.grillePrice; else regularPrice">{{ row.grillePrice | number:'1.2-2' }}</span>
                    <ng-template #regularPrice>
                      <span>{{ row.unitPrice | number:'1.2-2' }}</span>
                    </ng-template>
                  </ng-template>
                </td>
                <td><input type="number" class="form-control" [(ngModel)]="row.tva" (input)="calculateTotalTva(row)"
                    (input)="verifProduitFonction(row)" placeholder="tva"></td>
                <td><span class="text-right">{{row.total | number:'1.2-2' }}</span></td>
                <td><span class="text-right">{{row.totalTTC | number:'1.2-2' }}</span></td>
                <td *ngIf="!isPreview"><button class="btn btn-danger btnDelete btn-sm" (click)="deleteRow(i)"><i
                      class="bi bi-trash"></i></button></td>
              </tr>
            </tbody>
          </table>

          <div class="add-line" (click)="addRow()">
            + Nouvelle ligne
          </div>

          <div class="row">
            <div class="form-group col-4">
              <label for="commentaire">Commentaire:</label>
              <textarea id="commentaire" class="comment-box" name="noteFacture" [(ngModel)]="noteFacture"></textarea>
            </div>
            <div class="col-8">
              <br>
              <br>
              <table class="table table-sm text-right">
                <tr>
                  <td><strong>Total HT</strong></td>
                  <td class="text-right"> <span class="font-weight-bold">{{ total | number:'1.2-2' }}</span> FCfa</td>
                </tr>
                <tr>
                  <td><strong>TVA</strong></td>
                  <td class="text-right"> <span class="font-weight-bold">{{ totalTVA | number:'1.2-2' }}</span> FCfa
                  </td>
                </tr>
                <tr>
                  <td><strong>Total TTC</strong></td>
                  <td class="text-right"> <span class="font-weight-bold">{{ totalTTC | number:'1.2-2' }}</span> FCfa
                  </td>
                </tr>
              </table>
            </div>
          </div>

          <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <button class="btn btnAction" type="button" (click)="createBonLivraison()">Ajouter bon livraison</button>
            <button type="button" class="btn btnClose" data-bs-dismiss="modal">Annuler</button>
          </div>
          <!-- <div class="button-group">
            <button class="button">Livraison en préparation</button>
            <button class="button">Livraison planifiée</button>
            <button class="button">Livraison réalisée</button>
        </div> -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal ajout conversation  -->
<div class="modal fade mt-5" id="conversation" tabindex="-1" aria-labelledby="conversationLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="d-flex">
        <div class="p-3 flex-grow-1">
          <h3 class="modal-title" id="conversationLabel">Ajout Conversation</h3>
        </div>
        <div class="p-3"> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
      </div>
      <div class="modal-body">
        <div>
          <h6>Type : </h6>
          <div class="btn-group mb-3" role="group" aria-label="Basic example">
            <button type="button" class="btn btn-secondary" title="Personnellement"><i
                class="bi bi-people-fill text-ligth"></i></button>
            <button type="button" class="btn btn-secondary" title="Adresse mail"><i
                class="bi bi-envelope text-light"></i></button>
            <button type="button" class="btn btn-secondary" title="Message"><i
                class="bi bi-chat text-light"></i></button>
            <button type="button" class="btn btn-secondary" title="Telephone"><i
                class="bi bi-telephone text-light"></i></button>
            <button type="button" class="btn btn-secondary" title="Courrier postal"><i
                class="bi bi-mailbox-flag text-light"></i></button>
          </div>
          <form>
            <div class="form-floating mb-3">
              <input type="date" class="form-control" id="floatingInput">
              <label for="floatingInput">Date</label>
            </div>
            <div class="form-floating mb-2">
              <input type="test" class="form-control" id="floatingPassword">
              <label for="floatingPassword">Interlocuteur</label>
            </div>
            <div class="form-floating mb-3">
              <input type="test" class="form-control" id="floatingPassword">
              <label for="floatingPassword">Object</label>
            </div>
            <div class="form-floating mb-3">
              <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea2"
                style="height: 100px"></textarea>
              <label for="floatingTextarea2">Conversation</label>
            </div>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
              <label class="form-check-label" for="flexSwitchCheckDefault">En attente</label>
            </div>
          </form>
          <div class="d-grid gap-2  mb-3 d-md-flex justify-content-md-end">
            <button class=" btn btnAction" data-bs-toggle="modal" data-bs-target="#detailClient">Sauvegarder</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>